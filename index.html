<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<meta name="author" content="VinÃ­cius dos Santos Oliveira &lt;vini.ipsmaker@gmail.com&gt;">
<title>Boost.Http</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Boost.Http</h1>
<div class="details">
<span id="author" class="author">VinÃ­cius dos Santos Oliveira &lt;vini.ipsmaker@gmail.com&gt;</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_using">1. Using</a>
<ul class="sectlevel2">
<li><a href="#_requirements">1.1. Requirements</a></li>
</ul>
</li>
<li><a href="#_tutorial">2. Tutorial</a>
<ul class="sectlevel2">
<li><a href="#_http">2.1. HTTP</a></li>
<li><a href="#_accepting_new_connections">2.2. Accepting new connections</a></li>
<li><a href="#_receiving_requests">2.3. Receiving requests</a></li>
<li><a href="#_using_chunked_messages">2.4. Using chunked messages</a></li>
<li><a href="#_runtime_based_polymorphic_abstractions">2.5. Runtime-based polymorphic abstractions</a></li>
<li><a href="#_next_steps">2.6. Next steps</a></li>
</ul>
</li>
<li><a href="#design_choices">3. Design choices</a>
<ul class="sectlevel2">
<li><a href="#_faq">3.1. FAQ</a></li>
<li><a href="#_design_choices">3.2. Design choices</a></li>
<li><a href="#_roadmap">3.3. Roadmap</a></li>
</ul>
</li>
<li><a href="#_reference">4. Reference</a>
<ul class="sectlevel2">
<li><a href="#_summary">4.1. Summary</a></li>
<li><a href="#_detailed">4.2. Detailed</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Distributed under the Boost Software License, Version 1.0. (See accompanying
file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" class="bare">http://www.boost.org/LICENSE_1_0.txt</a>)</p>
</div>
<div class="paragraph">
<p>This library can be used to create applications that need to expose services
through HTTP (e.g. embeddable ReST services).</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
This is not an official Boost C++ library. It wasn&#8217;t reviewed and can&#8217;t
be downloaded from
www.boost.org. <a href="http://www.boost.org/community/review_schedule.html">This library
will be reviewed eventually</a>.
</td>
</tr>
</table>
</div>
<hr>
<div class="paragraph">
<p>Conceptually Boost.Http is a Boost.Asio socket for HTTP, which means can
leverage Boost.Asio features such as SSL and coroutines, and it integrates
seemlessly with other Boost.Asio sockets.</p>
</div>
<div class="paragraph">
<p>Among its features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Support for modern HTTP features.</p>
<div class="ulist">
<ul>
<li>
<p>Pipelining and persistent connection, where the same connection can be used
to serve HTTP multiple requests.</p>
</li>
<li>
<p>Chunking, where the HTTP body can be split into smaller pieces that are sent
one by one. This is useful for building event listeners.</p>
</li>
<li>
<p>Upgrading, where the HTTP protocol can be changed into another protocol such
as WebSockets.</p>
</li>
<li>
<p>Security, where SSL is used to encrypt the traffic.</p>
</li>
<li>
<p><code>100-continue</code> status.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Lean API that unifies HTTP messages and HTTP chunking.</p>
<div class="ulist">
<ul>
<li>
<p>You can handle the request as soon as the metadata is available (request line
plus header section).</p>
</li>
<li>
<p>There is only one API to acquire the request body. This API allows
progressive downloading.</p>
</li>
<li>
<p>The response body can be be generated wholesale for normal HTTP responses, or
be split into smaller pieces using HTTP chunking.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Extensible asynchronous design inherited from ASIO.</p>
<div class="ulist">
<ul>
<li>
<p>Interaction via futures, coroutines, or callbacks.</p>
</li>
<li>
<p>Various HTTP server architectures are possible, whether multi-threaded
servers (one thread per request, either with or without a thread-pool), one
coroutine per request, or completely single-threaded.</p>
</li>
<li>
<p>Seamless integration with other non-HTTP ASIO services.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Boost.Http also provides a couple of special-purpose server classes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Lightweight standalone server.</p>
<div class="ulist">
<ul>
<li>
<p>The underlying socket type is customizable, so you can also use a
<code>queue_socket</code> <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</sup><sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnote_2" title="View footnote.">2</a>]</sup>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Flexible static file server with support for conditional requests, partial
download and ETag recognition.</p>
<div class="ulist">
<ul>
<li>
<p>You can use the default file resolver or provide one yourself.</p>
</li>
<li>
<p>You can adapt the default resolver.</p>
</li>
<li>
<p>You can add a last hook to customize the response message before the file is
served.</p>
</li>
<li>
<p>Stateless abstractions, relying on OS capabilities to provide cache.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Boost.Http has been designed for multiple backends, such HTTP/2, and FastGCI,
which can be added in the future. You can choose between compile-time and
runtime polymorphism. Adapters are provided.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using">1. Using</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_requirements">1.1. Requirements</h3>
<div class="paragraph">
<p>This library is written in C++11 and requires a C++11 supporting compiler.</p>
</div>
<div class="paragraph">
<p>This library tries to reuse standard library components when possible, but this
is not always the case. <code>std::error_code</code>, for instance, cannot be transparently
replaced by <code>boost::system::error_code</code> within ASIO-using code.</p>
</div>
<div class="paragraph">
<p>The full list of dependencies is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CMake 3.1.0 or more recent <sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnote_3" title="View footnote.">3</a>]</sup>. You can skip this requirement
if you don&#8217;t intend to run the tests.</p>
</li>
<li>
<p>Boost 1.57 or more recent.</p>
<div class="ulist">
<ul>
<li>
<p>algorithm, container, string_ref, ASIO, date_time and system <sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnote_4" title="View footnote.">4</a>]</sup>.</p>
</li>
<li>
<p>unit_test_framework <sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnote_5" title="View footnote.">5</a>]</sup>.</p>
</li>
<li>
<p>context and coroutine <sup class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnote_6" title="View footnote.">6</a>]</sup>.</p>
</li>
<li>
<p>filesystem <sup class="footnote">[<a id="_footnoteref_7" class="footnote" href="#_footnote_7" title="View footnote.">7</a>]</sup>.</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="http://asciidoctor.org/">asciidoctor</a> <sup class="footnote">[<a id="_footnoteref_8" class="footnote" href="#_footnote_8" title="View footnote.">8</a>]</sup>. You&#8217;ll
also need <a href="http://pandoc.org/">pandoc</a> if you want to generate the ePUB output.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial">2. Tutorial</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this tutorial, you&#8217;ll have a small and fast introduction to HTTP (if you&#8217;re
already familiar with HTTP, you can skip the associated section and it&#8217;s more
likely you&#8217;ll deeply understand Boost.Http faster). You&#8217;ll also learn
incrementally how to build a proper handling of HTTP requests using Boost.Http.</p>
</div>
<div class="paragraph">
<p>A second step would be how to organize your application and make an useful
application, but this second step is left for the user to tackle alone.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
This tutorial assumes you&#8217;re already familiar with ASIO!
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This tutorial will make use of coroutines, to increase readability like
nothing else could do. You might be interested in the use of alternative
asynchronous models to achieve lower memory usage or something else. When C++
adds proper support for coroutines, this will not only be the most readable way,
but also the most performant.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_http">2.1. HTTP</h3>
<div class="paragraph">
<p>HTTP is a protocol that shines in extensibility. Its <code>1.1</code> version has been used
unchanged since 1997 and has been able to power very creative applications to
this date. An <code>HTTP/2.0</code> standard has been released, but most of the
differencies are related to efficient connection management and the only feature
that can affect higher-level layers of an application making use of HTTP is the
HTTP push, which is used to speculatively send data to a client that the server
anticipates the client will need.</p>
</div>
<div class="paragraph">
<p>HTTP also provides means to upgrade a protocol for a running connection and the
WebSocket protocol is gaining importance where HTTP is used the most, in the
web.</p>
</div>
<div class="paragraph">
<p>HTTP is a protocol that is oriented to exchange of request and reply
messages. Each request is independent, hence the stateless nature of the
protocol. Each request has an associated verb and path, used to tell <strong>what</strong> do
to <strong>who</strong>. Every HTTP message has a body (a payload of binary data) and
associated metadata (i.e. a <code>multimap&lt;string, string&gt;</code>). The HTTP response also
has a status code associated which is used to indicate success of the requested
action.</p>
</div>
<div class="paragraph">
<p>The metadata carried in every HTTP message is named as HTTP headers. The HTTP
headers carry information on how to handle the data payload, with info such as
the mime type, language and more. HTTP request messages can contain a token
which is used to associate multiple different requests with the same client, so
the user doesn&#8217;t need to type username and password for every page request.</p>
</div>
<div class="paragraph">
<p>GET is the most common HTTP verb and it has the simple semantic to retrieve the
resource.</p>
</div>
<div class="paragraph">
<p>If you just want to expose a bunch of files from the local filesystem, you may
be interested in <a href="#async_response_transmit_dir"><code>async_response_transmit_dir</code></a>,
which will take several responsibilities from you (e.g. partial download and a
few basic mechanisms to avoid corrupt files).</p>
</div>
<div class="paragraph">
<p>The usual setup for an HTTP application is to parse the request URL and choose
an appropriate handler based on the path component. Optional middleware handlers
can do some ACL based on authentication, resource usage and so on. An auxiliar
database is almost always used.</p>
</div>
</div>
<div class="sect2">
<h3 id="_accepting_new_connections">2.2. Accepting new connections</h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Remember, the journey of a thousand miles begins with the first step.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>First, we&#8217;re going to write the boilerplate code Asio require us to write if we
want use stackful coroutines to handle a non predetermined number of concurrent
connections.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;iostream&gt;</span><span class="tok-cp"></span>

<span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/asio/spawn.hpp&gt;</span><span class="tok-cp"></span>
<span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/buffered_socket.hpp&gt;</span><span class="tok-cp"></span>

<span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">std</span><span class="tok-p">;</span>
<span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">boost</span><span class="tok-p">;</span>

<span class="tok-k">class</span> <span class="tok-nc">connection</span><span class="tok-o">:</span> <span class="tok-k">public</span> <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">enable_shared_from_this</span><span class="tok-o">&lt;</span><span class="tok-n">connection</span><span class="tok-o">&gt;</span>
<span class="tok-p">{</span>
<span class="tok-k">public</span><span class="tok-o">:</span>
    <span class="tok-kt">void</span> <span class="tok-k">operator</span><span class="tok-p">()(</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">yield_context</span> <span class="tok-n">yield</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-k">auto</span> <span class="tok-n">self</span> <span class="tok-o">=</span> <span class="tok-n">shared_from_this</span><span class="tok-p">();</span>
        <span class="tok-k">try</span> <span class="tok-p">{</span>
            <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;--</span><span class="tok-se">\n</span><span class="tok-s">[&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">counter</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;] Socket ready&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
            <span class="tok-c1">// &gt;&gt;&gt; OUR CODE GOES HERE &lt;&lt;&lt;</span>
        <span class="tok-p">}</span> <span class="tok-k">catch</span> <span class="tok-p">(</span><span class="tok-n">system</span><span class="tok-o">::</span><span class="tok-n">system_error</span> <span class="tok-o">&amp;</span><span class="tok-n">e</span><span class="tok-p">)</span> <span class="tok-p">{</span>
            <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">e</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">()</span> <span class="tok-o">!=</span> <span class="tok-n">system</span><span class="tok-o">::</span><span class="tok-n">error_code</span><span class="tok-p">{</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">error</span><span class="tok-o">::</span><span class="tok-n">eof</span><span class="tok-p">})</span> <span class="tok-p">{</span>
                <span class="tok-n">cerr</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-sc">&#39;[&#39;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">counter</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;] Aborting on exception: &quot;</span>
                     <span class="tok-o">&lt;&lt;</span> <span class="tok-n">e</span><span class="tok-p">.</span><span class="tok-n">what</span><span class="tok-p">()</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
                <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">exit</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">);</span>
            <span class="tok-p">}</span>

            <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-sc">&#39;[&#39;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">counter</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;] Error: &quot;</span>
                 <span class="tok-o">&lt;&lt;</span> <span class="tok-n">e</span><span class="tok-p">.</span><span class="tok-n">what</span><span class="tok-p">()</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
        <span class="tok-p">}</span> <span class="tok-k">catch</span> <span class="tok-p">(</span><span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">exception</span> <span class="tok-o">&amp;</span><span class="tok-n">e</span><span class="tok-p">)</span> <span class="tok-p">{</span>
            <span class="tok-n">cerr</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-sc">&#39;[&#39;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">counter</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;] Aborting on exception: &quot;</span>
                 <span class="tok-o">&lt;&lt;</span> <span class="tok-n">e</span><span class="tok-p">.</span><span class="tok-n">what</span><span class="tok-p">()</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
            <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">exit</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">);</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>

    <span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">ip</span><span class="tok-o">::</span><span class="tok-n">tcp</span><span class="tok-o">::</span><span class="tok-n">socket</span> <span class="tok-o">&amp;</span><span class="tok-n">tcp_layer</span><span class="tok-p">()</span>
    <span class="tok-p">{</span>
        <span class="tok-k">return</span> <span class="tok-n">socket</span><span class="tok-p">.</span><span class="tok-n">next_layer</span><span class="tok-p">();</span>
    <span class="tok-p">}</span>

    <span class="tok-k">static</span> <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">shared_ptr</span><span class="tok-o">&lt;</span><span class="tok-n">connection</span><span class="tok-o">&gt;</span> <span class="tok-n">make_connection</span><span class="tok-p">(</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">io_service</span> <span class="tok-o">&amp;</span><span class="tok-n">ios</span><span class="tok-p">,</span>
                                                       <span class="tok-kt">int</span> <span class="tok-n">counter</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-k">return</span> <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">shared_ptr</span><span class="tok-o">&lt;</span><span class="tok-n">connection</span><span class="tok-o">&gt;</span><span class="tok-p">{</span><span class="tok-k">new</span> <span class="tok-n">connection</span><span class="tok-p">{</span><span class="tok-n">ios</span><span class="tok-p">,</span> <span class="tok-n">counter</span><span class="tok-p">}};</span>
    <span class="tok-p">}</span>

<span class="tok-k">private</span><span class="tok-o">:</span>
    <span class="tok-n">connection</span><span class="tok-p">(</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">io_service</span> <span class="tok-o">&amp;</span><span class="tok-n">ios</span><span class="tok-p">,</span> <span class="tok-kt">int</span> <span class="tok-n">counter</span><span class="tok-p">)</span>
        <span class="tok-o">:</span> <span class="tok-n">socket</span><span class="tok-p">(</span><span class="tok-n">ios</span><span class="tok-p">)</span>
        <span class="tok-p">,</span> <span class="tok-n">counter</span><span class="tok-p">(</span><span class="tok-n">counter</span><span class="tok-p">)</span>
    <span class="tok-p">{}</span>

    <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">buffered_socket</span> <span class="tok-n">socket</span><span class="tok-p">;</span>
    <span class="tok-kt">int</span> <span class="tok-n">counter</span><span class="tok-p">;</span>
<span class="tok-p">};</span>

<span class="tok-kt">int</span> <span class="tok-nf">main</span><span class="tok-p">()</span>
<span class="tok-p">{</span>
    <span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">io_service</span> <span class="tok-n">ios</span><span class="tok-p">;</span>
    <span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">ip</span><span class="tok-o">::</span><span class="tok-n">tcp</span><span class="tok-o">::</span><span class="tok-n">acceptor</span> <span class="tok-n">acceptor</span><span class="tok-p">(</span><span class="tok-n">ios</span><span class="tok-p">,</span>
                                     <span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">ip</span><span class="tok-o">::</span><span class="tok-n">tcp</span>
                                     <span class="tok-o">::</span><span class="tok-n">endpoint</span><span class="tok-p">(</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">ip</span><span class="tok-o">::</span><span class="tok-n">tcp</span><span class="tok-o">::</span><span class="tok-n">v6</span><span class="tok-p">(),</span> <span class="tok-mi">8080</span><span class="tok-p">));</span>

    <span class="tok-k">auto</span> <span class="tok-n">do_accept</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-o">&amp;</span><span class="tok-n">acceptor</span><span class="tok-p">](</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">yield_context</span> <span class="tok-n">yield</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-kt">int</span> <span class="tok-n">counter</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
        <span class="tok-k">for</span> <span class="tok-p">(</span> <span class="tok-p">;</span> <span class="tok-nb">true</span> <span class="tok-p">;</span> <span class="tok-o">++</span><span class="tok-n">counter</span> <span class="tok-p">)</span> <span class="tok-p">{</span>
            <span class="tok-k">try</span> <span class="tok-p">{</span>
                <span class="tok-k">auto</span> <span class="tok-n">connection</span>
                    <span class="tok-o">=</span> <span class="tok-n">connection</span><span class="tok-o">::</span><span class="tok-n">make_connection</span><span class="tok-p">(</span><span class="tok-n">acceptor</span><span class="tok-p">.</span><span class="tok-n">get_io_service</span><span class="tok-p">(),</span>
                                                  <span class="tok-n">counter</span><span class="tok-p">);</span>
                <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;About to accept a new connection&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
                <span class="tok-n">acceptor</span><span class="tok-p">.</span><span class="tok-n">async_accept</span><span class="tok-p">(</span><span class="tok-n">connection</span><span class="tok-o">-&gt;</span><span class="tok-n">tcp_layer</span><span class="tok-p">(),</span> <span class="tok-n">yield</span><span class="tok-p">);</span>

                <span class="tok-k">auto</span> <span class="tok-n">handle_connection</span>
                    <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-n">connection</span><span class="tok-p">](</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">yield_context</span> <span class="tok-n">yield</span><span class="tok-p">)</span> <span class="tok-k">mutable</span> <span class="tok-p">{</span>
                    <span class="tok-p">(</span><span class="tok-o">*</span><span class="tok-n">connection</span><span class="tok-p">)(</span><span class="tok-n">yield</span><span class="tok-p">);</span>
                <span class="tok-p">};</span>
                <span class="tok-n">spawn</span><span class="tok-p">(</span><span class="tok-n">acceptor</span><span class="tok-p">.</span><span class="tok-n">get_io_service</span><span class="tok-p">(),</span> <span class="tok-n">handle_connection</span><span class="tok-p">);</span>
            <span class="tok-p">}</span> <span class="tok-k">catch</span> <span class="tok-p">(</span><span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">exception</span> <span class="tok-o">&amp;</span><span class="tok-n">e</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-n">cerr</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;Aborting on exception: &quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">e</span><span class="tok-p">.</span><span class="tok-n">what</span><span class="tok-p">()</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
                <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">exit</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">);</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
    <span class="tok-p">};</span>

    <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;About to schedule new connections acceptance&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
    <span class="tok-n">spawn</span><span class="tok-p">(</span><span class="tok-n">ios</span><span class="tok-p">,</span> <span class="tok-n">do_accept</span><span class="tok-p">);</span>

    <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;About to run the I/O scheduler/executor&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
    <span class="tok-n">ios</span><span class="tok-p">.</span><span class="tok-n">run</span><span class="tok-p">();</span>

    <span class="tok-k">return</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Summarizing, we make use of <code>shared_ptr</code> to alloc object and ensure it&#8217;ll stay
alive as long as there is some reference to it and we spawn an acceptor
algorithm who will create a <code>shared_ptr</code> for every connection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">ip</span><span class="tok-o">::</span><span class="tok-n">tcp</span><span class="tok-o">::</span><span class="tok-n">socket</span> <span class="tok-o">&amp;</span><span class="tok-n">connection</span><span class="tok-o">::</span><span class="tok-n">tcp_layer</span><span class="tok-p">()</span>
<span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-n">socket</span><span class="tok-p">.</span><span class="tok-n">next_layer</span><span class="tok-p">();</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>basic_buffered_socket&lt;T&gt;::next_layer()</code> member-function will return the
internal T object. The <code>buffered_socket</code> typedef uses <code>asio::ip::tcp::socket</code> as
<code>T</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-n">spawn</span><span class="tok-p">(</span><span class="tok-n">acceptor</span><span class="tok-p">.</span><span class="tok-n">get_io_service</span><span class="tok-p">(),</span> <span class="tok-n">handle_connection</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We spawn a new handler for every connection, so we&#8217;ll be able to handle them all
concurrently.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">auto</span> <span class="tok-n">self</span> <span class="tok-o">=</span> <span class="tok-n">shared_from_this</span><span class="tok-p">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We must create a reference to the <code>shared_ptr</code> before calling any asynchronous
function to ensure the object will be live as long as the coroutine.</p>
</div>
</div>
<div class="sect2">
<h3 id="_receiving_requests">2.3. Receiving requests</h3>
<div class="paragraph">
<p>You can find the whole code at the end of the secion. For now, we build upon the
code from the previous code (just replace the âour code goesâ here comment with
the code we&#8217;ll build in this section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">while</span> <span class="tok-p">(</span><span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">socket</span><span class="tok-p">.</span><span class="tok-n">is_open</span><span class="tok-p">())</span> <span class="tok-p">{</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So, the first thing you should do is loop while the socket is open, so the whole
pipelining of requests will be handled. If the connection closes ungracefully,
an error code will be generated (converted to exceptions by the coroutine
completion token) during one of the operations. If the connection closes
gracefully, the loop will eventually stop by <code>is_open()</code> returning <code>false</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">socket</span><span class="tok-p">.</span><span class="tok-n">async_read_request</span><span class="tok-p">(</span><span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">request</span><span class="tok-p">,</span> <span class="tok-n">yield</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So, the first part to actually handle is to ask for the request message. You&#8217;ll
get the full method and path by the time the completion handler is called (in
the case of coroutines, this means the next line of code). You must not touch
any of these variables while the operation is in progress (hard to get it wrong
if you&#8217;re using coroutines). <code>self&#8594;request&#8594;headers()</code> will also be filled and
whatever part of the body that has already been received.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">while</span> <span class="tok-p">(</span><span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">socket</span><span class="tok-p">.</span><span class="tok-n">read_state</span><span class="tok-p">()</span> <span class="tok-o">!=</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">read_state</span><span class="tok-o">::</span><span class="tok-n">empty</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-c1">// ...</span>
    <span class="tok-k">switch</span> <span class="tok-p">(</span><span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">socket</span><span class="tok-p">.</span><span class="tok-n">read_state</span><span class="tok-p">())</span> <span class="tok-p">{</span>
    <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">read_state</span><span class="tok-o">::</span><span class="tok-nl">message_ready</span><span class="tok-p">:</span>
        <span class="tok-c1">// ...</span>
        <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">socket</span><span class="tok-p">.</span><span class="tok-n">async_read_some</span><span class="tok-p">(</span><span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">request</span><span class="tok-p">,</span> <span class="tok-n">yield</span><span class="tok-p">);</span>
        <span class="tok-k">break</span><span class="tok-p">;</span>
    <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">read_state</span><span class="tok-o">::</span><span class="tok-nl">body_ready</span><span class="tok-p">:</span>
        <span class="tok-c1">// ...</span>
        <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">socket</span><span class="tok-p">.</span><span class="tok-n">async_read_trailers</span><span class="tok-p">(</span><span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">request</span><span class="tok-p">,</span> <span class="tok-n">yield</span><span class="tok-p">);</span>
        <span class="tok-k">break</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use <code>self&#8594;socket.read_state()</code> to know which part of the request is
still missing and ask for the rest.</p>
</div>
<div class="paragraph">
<p>But there is a little gotcha. You should send a <code>100-continue</code> to ask for the
rest of the body if required. This feature appeared first in <code>HTTP/1.1</code> as a
mean to better use network traffic, by allowing you to reject requests sooner.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">request_continue_required</span><span class="tok-p">(</span><span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">request</span><span class="tok-p">))</span> <span class="tok-p">{</span>
    <span class="tok-c1">// ...</span>
    <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">socket</span><span class="tok-p">.</span><span class="tok-n">async_write_response_continue</span><span class="tok-p">(</span><span class="tok-n">yield</span><span class="tok-p">);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is how we check if we should send <code>100-continue</code>. It must be done after
<code>async_read_request</code> and before <code>async_read_some</code>.</p>
</div>
<div class="paragraph">
<p>By this time, we have already fully received the request and we can do something
with it. Pretty easy, see?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">response</span> <span class="tok-n">reply</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The response message we&#8217;re about to send.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">string</span> <span class="tok-n">body</span><span class="tok-p">{</span><span class="tok-s">&quot;Hello World from </span><span class="tok-se">\&quot;</span><span class="tok-s">&quot;</span><span class="tok-p">};</span>
<span class="tok-n">body</span> <span class="tok-o">+=</span> <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">request</span><span class="tok-p">.</span><span class="tok-n">target</span><span class="tok-p">();</span>
<span class="tok-n">body</span> <span class="tok-o">+=</span> <span class="tok-s">&quot;</span><span class="tok-se">\&quot;\n</span><span class="tok-s">&quot;</span><span class="tok-p">;</span>
<span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">copy</span><span class="tok-p">(</span><span class="tok-n">body</span><span class="tok-p">.</span><span class="tok-n">begin</span><span class="tok-p">(),</span> <span class="tok-n">body</span><span class="tok-p">.</span><span class="tok-n">end</span><span class="tok-p">(),</span>
          <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">back_inserter</span><span class="tok-p">(</span><span class="tok-n">reply</span><span class="tok-p">.</span><span class="tok-n">body</span><span class="tok-p">()));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We feed some bytes to the body.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-n">reply</span><span class="tok-p">.</span><span class="tok-n">status_code</span><span class="tok-p">()</span> <span class="tok-o">=</span> <span class="tok-mi">200</span><span class="tok-p">;</span>
<span class="tok-n">reply</span><span class="tok-p">.</span><span class="tok-n">reason_phrase</span><span class="tok-p">()</span> <span class="tok-o">=</span> <span class="tok-s">&quot;OK&quot;</span><span class="tok-p">;</span>
<span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">socket</span><span class="tok-p">.</span><span class="tok-n">async_write_response</span><span class="tok-p">(</span><span class="tok-n">reply</span><span class="tok-p">,</span> <span class="tok-n">yield</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And then we send the response. Our application is complete.</p>
</div>
<div class="paragraph">
<p>There is a gotcha here. If you use pure <code>asio::ip::tcp::socket</code>, you&#8217;re subject
to Asio composed operations restrictions and you should not schedule any
operation while the previous one is in progress. You can wrap
<code>asio::ip::tcp::socket</code> into some queuing socket <sup class="footnote">[<a id="_footnoteref_9" class="footnote" href="#_footnote_9" title="View footnote.">9</a>]</sup> to work around this bug and Boost.Http will give you the
required customization points to allow you to use it. We don&#8217;t worry about this
problem here, because with coroutines we&#8217;re done.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">we_are_halting</span><span class="tok-p">())</span>
    <span class="tok-n">reply</span><span class="tok-p">.</span><span class="tok-n">headers</span><span class="tok-p">().</span><span class="tok-n">emplace</span><span class="tok-p">(</span><span class="tok-s">&quot;connection&quot;</span><span class="tok-p">,</span> <span class="tok-s">&quot;close&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we&#8217;re going to halt the server and want to gracefully close current
connections, this code can be used to close the HTTP pipeline after the current
response end. You should pay attention to safe and idempotent methods if you
want to learn more about HTTP pipelining and HTTP in general.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">request</span><span class="tok-p">.</span><span class="tok-n">body</span><span class="tok-p">().</span><span class="tok-n">clear</span><span class="tok-p">();</span> <span class="tok-c1">// free unused resources</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Given we&#8217;re consuming the body, it&#8217;s a good idea to free unused resources. We
don&#8217;t use C++11&#8217;s <code>shrink_to_fit</code> because it could trigger another reallocation
in the next piece of body received. The idea is to reuse a small allocated
buffer instead. You could also create your own message type to discard feeded
bytes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-n">acceptor</span><span class="tok-p">.</span><span class="tok-n">async_accept</span><span class="tok-p">(</span><span class="tok-n">connection</span><span class="tok-o">-&gt;</span><span class="tok-n">tcp_layer</span><span class="tok-p">(),</span> <span class="tok-n">yield</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>HTTP doesn&#8217;t require you to handle protocol negotiation separately from the
remaining protocol or any super special handshaking flow. Therefore, we use a
ânakedâ acceptor to fuel an usable HTTP socket. Other HTTP backends may have
different usage.</p>
</div>
<div class="paragraph">
<p>And, like I promised, here is the complete code (with a lot of print statements
and a few lines to demonstrate more usage):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;iostream&gt;</span><span class="tok-cp"></span>

<span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/asio/spawn.hpp&gt;</span><span class="tok-cp"></span>
<span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/buffered_socket.hpp&gt;</span><span class="tok-cp"></span>
<span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/algorithm/query.hpp&gt;</span><span class="tok-cp"></span>
<span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/request.hpp&gt;</span><span class="tok-cp"></span>
<span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/response.hpp&gt;</span><span class="tok-cp"></span>

<span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">std</span><span class="tok-p">;</span>
<span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">boost</span><span class="tok-p">;</span>

<span class="tok-kt">bool</span> <span class="tok-nf">we_are_halting</span><span class="tok-p">()</span>
<span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-nb">false</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-k">class</span> <span class="tok-nc">connection</span><span class="tok-o">:</span> <span class="tok-k">public</span> <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">enable_shared_from_this</span><span class="tok-o">&lt;</span><span class="tok-n">connection</span><span class="tok-o">&gt;</span>
<span class="tok-p">{</span>
<span class="tok-k">public</span><span class="tok-o">:</span>
    <span class="tok-kt">void</span> <span class="tok-k">operator</span><span class="tok-p">()(</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">yield_context</span> <span class="tok-n">yield</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-k">auto</span> <span class="tok-n">self</span> <span class="tok-o">=</span> <span class="tok-n">shared_from_this</span><span class="tok-p">();</span>
        <span class="tok-k">try</span> <span class="tok-p">{</span>
            <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;[&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">counter</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;] Socket ready&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
            <span class="tok-k">while</span> <span class="tok-p">(</span><span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">socket</span><span class="tok-p">.</span><span class="tok-n">is_open</span><span class="tok-p">())</span> <span class="tok-p">{</span>
                <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;--</span><span class="tok-se">\n</span><span class="tok-s">[&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">counter</span>
                     <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;] About to receive a new message&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
                <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">socket</span><span class="tok-p">.</span><span class="tok-n">async_read_request</span><span class="tok-p">(</span><span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">request</span><span class="tok-p">,</span> <span class="tok-n">yield</span><span class="tok-p">);</span>
                <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">request</span><span class="tok-p">.</span><span class="tok-n">body</span><span class="tok-p">().</span><span class="tok-n">clear</span><span class="tok-p">();</span> <span class="tok-c1">// free unused resources</span>

                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">request_continue_required</span><span class="tok-p">(</span><span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">request</span><span class="tok-p">))</span> <span class="tok-p">{</span>
                    <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-sc">&#39;[&#39;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">counter</span>
                         <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;] Continue required. About to send&quot;</span>
                        <span class="tok-s">&quot; </span><span class="tok-se">\&quot;</span><span class="tok-s">100-continue</span><span class="tok-se">\&quot;</span><span class="tok-s">&quot;</span>
                         <span class="tok-o">&lt;&lt;</span> <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">endl</span><span class="tok-p">;</span>
                    <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">socket</span><span class="tok-p">.</span><span class="tok-n">async_write_response_continue</span><span class="tok-p">(</span><span class="tok-n">yield</span><span class="tok-p">);</span>
                <span class="tok-p">}</span>

                <span class="tok-k">while</span> <span class="tok-p">(</span><span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">socket</span><span class="tok-p">.</span><span class="tok-n">read_state</span><span class="tok-p">()</span> <span class="tok-o">!=</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">read_state</span><span class="tok-o">::</span><span class="tok-n">empty</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                    <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-sc">&#39;[&#39;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">counter</span>
                         <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;] Message not fully received&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
                    <span class="tok-k">switch</span> <span class="tok-p">(</span><span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">socket</span><span class="tok-p">.</span><span class="tok-n">read_state</span><span class="tok-p">())</span> <span class="tok-p">{</span>
                    <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">read_state</span><span class="tok-o">::</span><span class="tok-nl">message_ready</span><span class="tok-p">:</span>
                        <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-sc">&#39;[&#39;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">counter</span>
                             <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;] About to receive some body&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
                        <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">socket</span><span class="tok-p">.</span><span class="tok-n">async_read_some</span><span class="tok-p">(</span><span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">request</span><span class="tok-p">,</span> <span class="tok-n">yield</span><span class="tok-p">);</span>
                        <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">request</span><span class="tok-p">.</span><span class="tok-n">body</span><span class="tok-p">().</span><span class="tok-n">clear</span><span class="tok-p">();</span> <span class="tok-c1">// free unused resources</span>
                        <span class="tok-k">break</span><span class="tok-p">;</span>
                    <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">read_state</span><span class="tok-o">::</span><span class="tok-nl">body_ready</span><span class="tok-p">:</span>
                        <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-sc">&#39;[&#39;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">counter</span>
                             <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;] About to receive trailers&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
                        <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">socket</span><span class="tok-p">.</span><span class="tok-n">async_read_trailers</span><span class="tok-p">(</span><span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">request</span><span class="tok-p">,</span> <span class="tok-n">yield</span><span class="tok-p">);</span>
                        <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">request</span><span class="tok-p">.</span><span class="tok-n">body</span><span class="tok-p">().</span><span class="tok-n">clear</span><span class="tok-p">();</span> <span class="tok-c1">// free unused resources</span>
                        <span class="tok-k">break</span><span class="tok-p">;</span>
                    <span class="tok-k">default</span><span class="tok-o">:</span><span class="tok-p">;</span>
                    <span class="tok-p">}</span>
                <span class="tok-p">}</span>

                <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-sc">&#39;[&#39;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">counter</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;] Message received. State = &quot;</span>
                     <span class="tok-o">&lt;&lt;</span> <span class="tok-kt">int</span><span class="tok-p">(</span><span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">socket</span><span class="tok-p">.</span><span class="tok-n">read_state</span><span class="tok-p">())</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
                <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-sc">&#39;[&#39;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">counter</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;] Method: &quot;</span>
                     <span class="tok-o">&lt;&lt;</span> <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">request</span><span class="tok-p">.</span><span class="tok-n">method</span><span class="tok-p">()</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
                <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-sc">&#39;[&#39;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">counter</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;] Path: &quot;</span>
                     <span class="tok-o">&lt;&lt;</span> <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">request</span><span class="tok-p">.</span><span class="tok-n">target</span><span class="tok-p">()</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
                <span class="tok-p">{</span>
                    <span class="tok-k">auto</span> <span class="tok-n">host</span> <span class="tok-o">=</span> <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">request</span><span class="tok-p">.</span><span class="tok-n">headers</span><span class="tok-p">().</span><span class="tok-n">find</span><span class="tok-p">(</span><span class="tok-s">&quot;host&quot;</span><span class="tok-p">);</span>
                    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">host</span> <span class="tok-o">!=</span> <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">request</span><span class="tok-p">.</span><span class="tok-n">headers</span><span class="tok-p">().</span><span class="tok-n">end</span><span class="tok-p">())</span>
                        <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-sc">&#39;[&#39;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">counter</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;] Host header: &quot;</span>
                             <span class="tok-o">&lt;&lt;</span> <span class="tok-n">host</span><span class="tok-o">-&gt;</span><span class="tok-n">second</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
                <span class="tok-p">}</span>

                <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-sc">&#39;[&#39;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">counter</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;] Write state = &quot;</span>
                          <span class="tok-o">&lt;&lt;</span> <span class="tok-kt">int</span><span class="tok-p">(</span><span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">socket</span><span class="tok-p">.</span><span class="tok-n">write_state</span><span class="tok-p">())</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">endl</span><span class="tok-p">;</span>

                <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-sc">&#39;[&#39;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">counter</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;] About to send a reply&quot;</span>
                     <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>

                <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">response</span> <span class="tok-n">reply</span><span class="tok-p">;</span>

                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">we_are_halting</span><span class="tok-p">())</span>
                    <span class="tok-n">reply</span><span class="tok-p">.</span><span class="tok-n">headers</span><span class="tok-p">().</span><span class="tok-n">emplace</span><span class="tok-p">(</span><span class="tok-s">&quot;connection&quot;</span><span class="tok-p">,</span> <span class="tok-s">&quot;close&quot;</span><span class="tok-p">);</span>

                <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">string</span> <span class="tok-n">body</span><span class="tok-p">{</span><span class="tok-s">&quot;Hello World from </span><span class="tok-se">\&quot;</span><span class="tok-s">&quot;</span><span class="tok-p">};</span>
                <span class="tok-n">body</span> <span class="tok-o">+=</span> <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">request</span><span class="tok-p">.</span><span class="tok-n">target</span><span class="tok-p">();</span>
                <span class="tok-n">body</span> <span class="tok-o">+=</span> <span class="tok-s">&quot;</span><span class="tok-se">\&quot;\n</span><span class="tok-s">&quot;</span><span class="tok-p">;</span>
                <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">copy</span><span class="tok-p">(</span><span class="tok-n">body</span><span class="tok-p">.</span><span class="tok-n">begin</span><span class="tok-p">(),</span> <span class="tok-n">body</span><span class="tok-p">.</span><span class="tok-n">end</span><span class="tok-p">(),</span>
                          <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">back_inserter</span><span class="tok-p">(</span><span class="tok-n">reply</span><span class="tok-p">.</span><span class="tok-n">body</span><span class="tok-p">()));</span>

                <span class="tok-n">reply</span><span class="tok-p">.</span><span class="tok-n">status_code</span><span class="tok-p">()</span> <span class="tok-o">=</span> <span class="tok-mi">200</span><span class="tok-p">;</span>
                <span class="tok-n">reply</span><span class="tok-p">.</span><span class="tok-n">reason_phrase</span><span class="tok-p">()</span> <span class="tok-o">=</span> <span class="tok-s">&quot;OK&quot;</span><span class="tok-p">;</span>
                <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">socket</span><span class="tok-p">.</span><span class="tok-n">async_write_response</span><span class="tok-p">(</span><span class="tok-n">reply</span><span class="tok-p">,</span> <span class="tok-n">yield</span><span class="tok-p">);</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span> <span class="tok-k">catch</span> <span class="tok-p">(</span><span class="tok-n">system</span><span class="tok-o">::</span><span class="tok-n">system_error</span> <span class="tok-o">&amp;</span><span class="tok-n">e</span><span class="tok-p">)</span> <span class="tok-p">{</span>
            <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">e</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">()</span> <span class="tok-o">!=</span> <span class="tok-n">system</span><span class="tok-o">::</span><span class="tok-n">error_code</span><span class="tok-p">{</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">error</span><span class="tok-o">::</span><span class="tok-n">eof</span><span class="tok-p">})</span> <span class="tok-p">{</span>
                <span class="tok-n">cerr</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-sc">&#39;[&#39;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">counter</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;] Aborting on exception: &quot;</span>
                     <span class="tok-o">&lt;&lt;</span> <span class="tok-n">e</span><span class="tok-p">.</span><span class="tok-n">what</span><span class="tok-p">()</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
                <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">exit</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">);</span>
            <span class="tok-p">}</span>

            <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-sc">&#39;[&#39;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">counter</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;] Error: &quot;</span>
                 <span class="tok-o">&lt;&lt;</span> <span class="tok-n">e</span><span class="tok-p">.</span><span class="tok-n">what</span><span class="tok-p">()</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
        <span class="tok-p">}</span> <span class="tok-k">catch</span> <span class="tok-p">(</span><span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">exception</span> <span class="tok-o">&amp;</span><span class="tok-n">e</span><span class="tok-p">)</span> <span class="tok-p">{</span>
            <span class="tok-n">cerr</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-sc">&#39;[&#39;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">self</span><span class="tok-o">-&gt;</span><span class="tok-n">counter</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;] Aborting on exception: &quot;</span>
                 <span class="tok-o">&lt;&lt;</span> <span class="tok-n">e</span><span class="tok-p">.</span><span class="tok-n">what</span><span class="tok-p">()</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
            <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">exit</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">);</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>

    <span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">ip</span><span class="tok-o">::</span><span class="tok-n">tcp</span><span class="tok-o">::</span><span class="tok-n">socket</span> <span class="tok-o">&amp;</span><span class="tok-n">tcp_layer</span><span class="tok-p">()</span>
    <span class="tok-p">{</span>
        <span class="tok-k">return</span> <span class="tok-n">socket</span><span class="tok-p">.</span><span class="tok-n">next_layer</span><span class="tok-p">();</span>
    <span class="tok-p">}</span>

    <span class="tok-k">static</span> <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">shared_ptr</span><span class="tok-o">&lt;</span><span class="tok-n">connection</span><span class="tok-o">&gt;</span> <span class="tok-n">make_connection</span><span class="tok-p">(</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">io_service</span> <span class="tok-o">&amp;</span><span class="tok-n">ios</span><span class="tok-p">,</span>
                                                       <span class="tok-kt">int</span> <span class="tok-n">counter</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-k">return</span> <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">shared_ptr</span><span class="tok-o">&lt;</span><span class="tok-n">connection</span><span class="tok-o">&gt;</span><span class="tok-p">{</span><span class="tok-k">new</span> <span class="tok-n">connection</span><span class="tok-p">{</span><span class="tok-n">ios</span><span class="tok-p">,</span> <span class="tok-n">counter</span><span class="tok-p">}};</span>
    <span class="tok-p">}</span>

<span class="tok-k">private</span><span class="tok-o">:</span>
    <span class="tok-n">connection</span><span class="tok-p">(</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">io_service</span> <span class="tok-o">&amp;</span><span class="tok-n">ios</span><span class="tok-p">,</span> <span class="tok-kt">int</span> <span class="tok-n">counter</span><span class="tok-p">)</span>
        <span class="tok-o">:</span> <span class="tok-n">socket</span><span class="tok-p">(</span><span class="tok-n">ios</span><span class="tok-p">)</span>
        <span class="tok-p">,</span> <span class="tok-n">counter</span><span class="tok-p">(</span><span class="tok-n">counter</span><span class="tok-p">)</span>
    <span class="tok-p">{}</span>

    <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">buffered_socket</span> <span class="tok-n">socket</span><span class="tok-p">;</span>
    <span class="tok-kt">int</span> <span class="tok-n">counter</span><span class="tok-p">;</span>

    <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">request</span> <span class="tok-n">request</span><span class="tok-p">;</span>
<span class="tok-p">};</span>

<span class="tok-kt">int</span> <span class="tok-nf">main</span><span class="tok-p">()</span>
<span class="tok-p">{</span>
    <span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">io_service</span> <span class="tok-n">ios</span><span class="tok-p">;</span>
    <span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">ip</span><span class="tok-o">::</span><span class="tok-n">tcp</span><span class="tok-o">::</span><span class="tok-n">acceptor</span> <span class="tok-n">acceptor</span><span class="tok-p">(</span><span class="tok-n">ios</span><span class="tok-p">,</span>
                                     <span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">ip</span><span class="tok-o">::</span><span class="tok-n">tcp</span>
                                     <span class="tok-o">::</span><span class="tok-n">endpoint</span><span class="tok-p">(</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">ip</span><span class="tok-o">::</span><span class="tok-n">tcp</span><span class="tok-o">::</span><span class="tok-n">v6</span><span class="tok-p">(),</span> <span class="tok-mi">8080</span><span class="tok-p">));</span>

    <span class="tok-k">auto</span> <span class="tok-n">do_accept</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-o">&amp;</span><span class="tok-n">acceptor</span><span class="tok-p">](</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">yield_context</span> <span class="tok-n">yield</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-kt">int</span> <span class="tok-n">counter</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
        <span class="tok-k">for</span> <span class="tok-p">(</span> <span class="tok-p">;</span> <span class="tok-nb">true</span> <span class="tok-p">;</span> <span class="tok-o">++</span><span class="tok-n">counter</span> <span class="tok-p">)</span> <span class="tok-p">{</span>
            <span class="tok-k">try</span> <span class="tok-p">{</span>
                <span class="tok-k">auto</span> <span class="tok-n">connection</span>
                    <span class="tok-o">=</span> <span class="tok-n">connection</span><span class="tok-o">::</span><span class="tok-n">make_connection</span><span class="tok-p">(</span><span class="tok-n">acceptor</span><span class="tok-p">.</span><span class="tok-n">get_io_service</span><span class="tok-p">(),</span>
                                                  <span class="tok-n">counter</span><span class="tok-p">);</span>
                <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;About to accept a new connection&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
                <span class="tok-n">acceptor</span><span class="tok-p">.</span><span class="tok-n">async_accept</span><span class="tok-p">(</span><span class="tok-n">connection</span><span class="tok-o">-&gt;</span><span class="tok-n">tcp_layer</span><span class="tok-p">(),</span> <span class="tok-n">yield</span><span class="tok-p">);</span>

                <span class="tok-k">auto</span> <span class="tok-n">handle_connection</span>
                    <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-n">connection</span><span class="tok-p">](</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">yield_context</span> <span class="tok-n">yield</span><span class="tok-p">)</span> <span class="tok-k">mutable</span> <span class="tok-p">{</span>
                    <span class="tok-p">(</span><span class="tok-o">*</span><span class="tok-n">connection</span><span class="tok-p">)(</span><span class="tok-n">yield</span><span class="tok-p">);</span>
                <span class="tok-p">};</span>
                <span class="tok-n">spawn</span><span class="tok-p">(</span><span class="tok-n">acceptor</span><span class="tok-p">.</span><span class="tok-n">get_io_service</span><span class="tok-p">(),</span> <span class="tok-n">handle_connection</span><span class="tok-p">);</span>
            <span class="tok-p">}</span> <span class="tok-k">catch</span> <span class="tok-p">(</span><span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">exception</span> <span class="tok-o">&amp;</span><span class="tok-n">e</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-n">cerr</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;Aborting on exception: &quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">e</span><span class="tok-p">.</span><span class="tok-n">what</span><span class="tok-p">()</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
                <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">exit</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">);</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
    <span class="tok-p">};</span>

    <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;About to schedule new connections acceptance&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
    <span class="tok-n">spawn</span><span class="tok-p">(</span><span class="tok-n">ios</span><span class="tok-p">,</span> <span class="tok-n">do_accept</span><span class="tok-p">);</span>

    <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;About to run the I/O scheduler/executor&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
    <span class="tok-n">ios</span><span class="tok-p">.</span><span class="tok-n">run</span><span class="tok-p">();</span>

    <span class="tok-k">return</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_chunked_messages">2.4. Using chunked messages</h3>
<div class="paragraph">
<p>In the previous example, we used atomic messages to respond the request. But
this is limiting when we&#8217;re trying to achieve certain kind of tasks, like
serving a live video stream. A second option for us is to use chunked messages
to respond the request.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Chunked messages are not always available and you must check if you can
use chunked messages for every request with the <code>write_response_native_stream()</code>
socket member-function.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If chunked messages are available, you can use the following sequence of actions
to respond the request:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>async_write_response_metadata</code> once.</p>
</li>
<li>
<p><code>async_write</code> zero or more times.</p>
</li>
<li>
<p><code>async_write_trailers</code> or <code>async_write_end_of_message</code>, once.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_runtime_based_polymorphic_abstractions">2.5. Runtime-based polymorphic abstractions</h3>
<div class="paragraph">
<p>If you want to create a function that will handle requests originated from
different HTTP backends, you have three choices:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Rewrite the handler for every HTTP backend.</p>
</li>
<li>
<p>Write generic handlers.</p>
</li>
<li>
<p>Type-erase the HTTP backends.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Boost.Http provide some abstractions to type erase the HTTP backends (playing a
similar role to <code>std::function</code>). The starting point to learn about it is the
<a href="#server_socket_adaptor"><code>server_socket_adaptor</code> page</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-kt">void</span> <span class="tok-nf">handler</span><span class="tok-p">(</span><span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">polymorphic_server_socket</span> <span class="tok-o">&amp;</span><span class="tok-n">socket</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
    <span class="tok-c1">// ...</span>
<span class="tok-p">}</span>

<span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">server_socket_adaptor</span><span class="tok-o">&lt;</span><span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">buffered_socket</span><span class="tok-o">&gt;</span>
    <span class="tok-n">socket</span><span class="tok-p">(</span><span class="tok-n">acceptor</span><span class="tok-p">.</span><span class="tok-n">get_io_service</span><span class="tok-p">());</span>
<span class="tok-n">handler</span><span class="tok-p">(</span><span class="tok-n">socket</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_next_steps">2.6. Next steps</h3>
<div class="paragraph">
<p>Jump into <a href="#design_choices">design choices</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="design_choices">3. Design choices</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_faq">3.1. FAQ</h3>
<div class="qlist qanda">
<ol>
<li>
<p><em>Why build on top of Boost.Asio?</em></p>
<p>One of the requirements of Boost.Http is scalable performance. Scalable
performance requires an asynchronous design. Asio is expected to become the
future C++ standard for sockets. So, Asio it is.</p>
<div class="paragraph">
<p>Also, reuse existing std or Boost components is nice and Asio is the Boost
solution for asynchronous socket I/O.</p>
</div>
</li>
<li>
<p><em>Why C++11?</em></p>
<p>Asynchronous code can be largely simplified with language support for
lambdas. To speed up the development (and decrease bugs), C++11 was chosen,
but interface-wise, the only real C++11 feature is enum classes, which can
be emulated in C++98 easily.</p>
<div class="paragraph">
<p>C++98 support might be added later. The priority is to prove the core set of
abstractions is correct. Then I can move on the task to fatten the library. The
proof comes in the act of passing the Boost review process.</p>
</div>
<div class="paragraph">
<p>To be fair, I also depend on the C++11 definition of <code>multimap</code>, but Boost
containers can do the job easily.</p>
</div>
</li>
<li>
<p><em>Have you considered contribute to <em>project X/Y</em>?</em></p>
<p><a href="https://github.com/vinipsmaker/gsoc2014-boost/blob/master/other_frameworks.md">Yes,
I have</a>.</p>
<div class="paragraph">
<p>But current Boost.Http is not like what I was expecting when I started to
writing it. Boost.Http is better. The gap between Boost.Http and other projects
became even larger. My previous research won&#8217;t mention every difference.</p>
</div>
<div class="paragraph">
<p>Boost.Http supports pipelining. Pion has separate functions for
chunking. Boost.Http is designed for multiple backends. POCO, QtHttp and
Casablanca aren&#8217;t build on top of Asio. Pion and cpp-netlib will use their own
thread-pool, instead adhering to Asio threading model.</p>
</div>
</li>
<li>
<p><em>Why is it only server-side?</em></p>
<p>Server-side and client-side are of interest to different
applications. Initially, the focus was to provide a library just to
server-side, but with the time spent on research and development, it became
apparent that many of the proposed abstractions are also useful for
client-side.</p>
<div class="paragraph">
<p>After this fact, a lot of caution was devoted to design the interface to retain
the usefulness in client-side, where it makes sense. But this is not enough. A
lot of time was spent on research just to get the server-side right and I expect
that much time (or more) to also get the client-side right.</p>
</div>
<div class="paragraph">
<p>Before any serious effort is spent on client-side, I want to focus on
server-side, where the application load may be way higher and C++ may be way
more desired. And just as the server-side interface development was driven by a
strict set of guidelines (multiple backends, modularity with specific use
cases&#8230;&#8203;), we need to define what we want to achieve with the client-side
abstraction. What kind of usage will be appropriate with such design.</p>
</div>
</li>
<li>
<p><em>Why isn&#8217;t a router available?</em></p>
<p>Advocates of tree-based routers tend to ignore the middleware-based approach
and the other way around is also true. It happens that some even only know one
way and don&#8217;t even stop to consider that their approach isn&#8217;t appropriate for
every project. This subject will affect the life of the users <strong>a lot</strong> and can
be rather polemic.</p>
<div class="paragraph">
<p>I just provide the building blocks and you can create the router any way you
want. Actually, I intend to implement them later, because implementing them now
will just distract the attention of the reviewers and it&#8217;d be a waste of time if
the review proves the core set of abstractions is wrong.</p>
</div>
<div class="paragraph">
<p>Most of the designs I see propose dynamic routers, where you can change the
routing rules at runtime, but this feature is rarely needed. Wouldn&#8217;t be
wonderful if you could use great syntax sugars to declare routers that receive
as much optimization as possible at compile-time? Wouldn&#8217;t be wonderful to use
nested routers? Wouldn&#8217;t be wonderful if you could collaborate the tree-based
and middleware-based approach very easily? Maybe even some kind of collaboration
between the statically declared routers and dynamic routers? I hope this will be
rather polemic and will require a lot of iterations to get it right, maybe with
a mini-review for acceptance.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_design_choices">3.2. Design choices</h3>
<div class="paragraph">
<p>To convince you about the solution, I&#8217;ll start the text highlighting some
problems and requirements. If you understand the problem, you&#8217;ll understand why
the solution was proposed like that.</p>
</div>
<div class="paragraph">
<p>One of the wanted features for this library since the very beginning was to make
it possible to make a small change in code to expose the HTTP service through a
different communication mechanism. Like, change from embedded HTTP server to
FastCGI-exposed server.</p>
</div>
<div class="paragraph">
<p>There are several libraries who will provide some object you can use to consume
HTTP traffic from the world and will act as a request-reply door to create web
applications. Libraries who will expose a request object you can use to consume
TCP traffic and will export url and headers properties. The problem with this
approach is the coupling between HTTP messages and HTTP communication channels.</p>
</div>
<div class="paragraph">
<p>In Boost.Http, HTTP messages and HTTP communication channels are decoupled, so
it is easier to replace the communication channel later. You could easily use an
unprotected embedded HTTP server on development environment to tests and replace
it in favor of a full-blow solution during production.</p>
</div>
<div class="paragraph">
<p>Boost.Http defines some type requirements to abstract communication channels and
provide some polymorphic adapters who will type erase them. The abstraction was
specified carefully to allow robust applications. Your application will not hang
trying to live stream a video because the request was done from an <code>HTTP/1.0</code>
client. Also, your handler won&#8217;t know what HTTP version (if any) the HTTP
request was made with.</p>
</div>
<div class="paragraph">
<p>Also among the wanted features was to retain the usefulness of the library
whether you&#8217;re using it to power an application intended to run from an low-end
embedded device or an application intended to run on a cluster with plenty of
resources to be made use of. An embdeded device may not have the luxury to host
a pool or a cache layer, but a cluster may even demand these layers to properly
handle thousands of requests every second. With this use case in mind,
modularity was achieved.</p>
</div>
<div class="paragraph">
<p>The plan to finish such ambitious project was âto expose an HTTP abstraction
able to make use of the HTTP power (chunking/streaming, pipelining, upgrade for
supporting channels and multiplexing for supporting channels), at the same time
that a complete separation of communication channels and HTTP messages is
achievedâ.</p>
</div>
<div class="paragraph">
<p>With the separation of HTTP messages and HTTP communication channels, alongside
the use of an active model (you ask by the next request instead providing a
handler and waiting for them), several of the requirements became very easy to
fulfill, such as HTTP pipelining, custom memory allocation, buffers, cache
layers and pools of objects.</p>
</div>
<div class="paragraph">
<p>With such very generalized abstractions, you may be worried about the need to
type too much to get something done. This is being solved by providing higher
level flexible abstractions, such as the file server you can already find.</p>
</div>
<div class="sect3">
<h4 id="_the_what">3.2.1. The what</h4>
<div class="imageblock">
<div class="content">
<img src="request_handling.svg" alt="request handling">
</div>
</div>
<div class="paragraph">
<p>The above image shows an overview of how to build HTTP servers using Boost.Http.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s assume you&#8217;re going to use the provided <code>http::socket</code>, suitable for
embedding HTTP servers in your application.</p>
</div>
<div class="paragraph">
<p>You must instantiate a TCP socket acceptor and accept new connections. You
should handle all connections concurrently.</p>
</div>
<div class="paragraph">
<p>Each connection you handle is a pipeline of request-reply pair. To receive the
full request, your action may be required at several points. First, you should
receive the request metadata, then it may be necessary to issue a 100-continue
response. Then you need to issue reads for the body and the trailers until the
whole request has been received.</p>
</div>
<div class="paragraph">
<p>You&#8217;re finally able to send the reply. You have two options, atomic messages or
chunked messages. Chunked messages are not always available and must check if
they can be used for each request you receive, using
<code>write_response_native_stream()</code>.</p>
</div>
<div class="paragraph">
<p>If you spread the handling logic among several functions, a good approach would
be to always share the triplet
<code>&lt;communication channel, request message, response message&gt;</code> around.</p>
</div>
<div class="paragraph">
<p>Still missing is URL parsing and request routing, so you must do this yourself,
possibly managing pools of message and socket objects.</p>
</div>
<div class="paragraph">
<p>This system allows you to implement powerful schedulers doing fair share of
resources over different IPs, whether the requests originate from HTTP or HTTPS,
using all cores of your CPU and deferring new work when the work load is too
high. You should be able to do all fine-grained tuning you need and also easily
create higher level that are suitable for your application. Not only that, this
library could become an interoperability layer for all higher-level that web
application developers create.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="request.svg" alt="request">
</div>
</div>
<div class="paragraph">
<p>Also, if you pay attention, you&#8217;ll realize that this proposal just expose HTTP
with a message oriented abstraction. All procedures in the diagram are related
to HTTP events and actions. And this is a modern API and you can use pretty much
every modern HTTP feature (persistent streams &amp; HTTP pipelining, chunked
entities, 100-continue status, &#8230;&#8203;). And you won&#8217;t handle any parsing or
low-level detail at all. It&#8217;s abstracted enough to allow alternative backends.</p>
</div>
<div class="paragraph">
<p>However, this can easily become a callback hell, and futures wouldn&#8217;t help much,
given the need to use <code>while</code>-constructs. If you use coroutines, there is hope
your code will be readable. Boost.Http follows Asio extensible asynchronous
model and you&#8217;re free to use callbacks, futures, coroutines or others.</p>
</div>
</div>
<div class="sect3">
<h4 id="_asio_familiarity">3.2.2. ASIO familiarity</h4>
<div class="paragraph">
<p>This library may be very pleasant to use for any ASIO-centered mind.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Completion tokens received as the last argument for aync functions.</p>
</li>
<li>
<p>Async operations have the <code>async_</code> prefix.</p>
</li>
<li>
<p>User control the bufferring mechanism, passing the opaque <code>asio::buffer</code> type.</p>
</li>
<li>
<p>User provides <em>output</em> arguments as references and they&#8217;ll be âfilledâ by the
time the operation completes.</p>
</li>
<li>
<p>Memory management is left for the user.</p>
</li>
<li>
<p>An active model is presented.</p>
</li>
<li>
<p>Similar nomenclature.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>The ASIO way</em> saved us from many problems that otherwise would force us to
propose solutions to already know problems such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Object pools.</p>
</li>
<li>
<p>Deferring acceptance to later on high load scenarios.</p>
</li>
<li>
<p>HTTP pipelining problems.</p>
</li>
<li>
<p>Partially filling response objects from different layers of abstractions.</p>
</li>
<li>
<p>A wrapping/wrapped socket can take care of tasks such as
synchronization/queueing and timeout.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_the_mysterious_weird_news_api">3.2.3. The mysterious/weird/news API</h4>
<div class="paragraph">
<p>One of the maybe surprising things to start with is the use of highly structured
objects as opposed to things like opaque buffers. You pass a message object to
the initiating function and you&#8217;ll have a fully decomposed object with an URL, a
method and even an associative container for the headers!!!</p>
</div>
<div class="paragraph">
<p>If you do have special memory requirements for the messages, you&#8217;re free to
implementing an alternative container, as long as it fulfills the documented
<code>Message</code> concept. Connections channels and HTTP messages are <strong>not</strong> coupled
together. You can reuse these pieces in many many different contexts.</p>
</div>
<div class="paragraph">
<p>The uncoupled architecture is more general and it is the default mode, but let&#8217;s
say you work at a more constrained environment where memory copying is banned,
for instance. You could provide your HTTP backend (e.g. a non-copying embedded
server) tied to your specific HTTP message type implementing our ideas and you
still may benefit from this libray. This library provides some HTTP algorithms
and some HTTP handlers (e.g. file server) and these abstractions will save some
time from you.</p>
</div>
<div class="paragraph">
<p>Another difference in this library is the presence of an associated state for
reading and writing messages. I believe this abstraction can be extended to also
support very simple HTTP clients. To avoid confusion, if some member-function
cannot be used for both modes (clients and servers), it&#8217;ll have one of the
following prefixes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>async_read_request</p>
</li>
<li>
<p>async_read_response</p>
</li>
<li>
<p>async_write_request</p>
</li>
<li>
<p>async_write_response</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We gave special attention to <code>read_state</code> and <code>write_state</code> to make sure it&#8217;ll
also be usable for <strong>simple</strong> and asynchronous HTTP clients.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_why">3.2.4. The why</h4>
<div class="paragraph">
<p>Boost.Http provides an HTTP socket, which can be used to manage a pipeline of
HTTP messages (i.e. an HTTP request or an HTTP reply). HTTP is stateless and
each message coming from the same socket is independent. The HTTP socket from
Boost.Http is a concept and specific implementations from this concept may
provide more guarantees about the communication properties. The reasons to
provide few guarantees are (<code>#1</code>) because we want a common denominator from
which we can provide implementation for multiple communication channels and
(<code>#2</code>) because implementation details are usually not required for the
application, which is only interested in a high-level abstraction. The provided
<code>boost::http::basic_socket</code> implementation will handle actual HTTP traffic from
TCP sockets and you can use it to handle <code>HTTP/1.0</code> and <code>HTTP/1.1</code> traffic from
TCP and SSL sockets.</p>
</div>
<div class="paragraph">
<p><code>read_state()</code> and <code>write_state()</code> are used to inspect the current state of
interaction and react appropriately. There are rules regarding when the socket
can mutate and change its states. Once you request the socket to read a new HTTP
request, you&#8217;ll be notified as soon as the request metadata (request line and
HTTP headers) are ready, then you can progressively download the body and react
appropriately. This idea is very useful to improve communication between the
library authors and application authors and also helps to create some tests.</p>
</div>
<div class="paragraph">
<p>You&#8217;ll have to inspect the socket to know whether the current message-exchange
requires <code>100-continue</code>, allows chunked entities (streaming response) and alike.
There is like two kind of replies. With atomic replies, you write the whole
message at once. With chunked message, you compose a message spreading its
construction among several API calls. You may want to use chunked messages when
you don&#8217;t know the whole body in advance (e.g. reading a file, video live
stream&#8230;&#8203;), but chunked messages can only be used in certain message
exchanges. The reason behind providing two kind of replies is to properly
support a wider range of HTTP communication channels.</p>
</div>
<div class="paragraph">
<p>You create one HTTP socket for each HTTP client and should handle them all
concurrently. In case you&#8217;re using the embeddable HTTP server backend, you must
use an acceptor to initialize the <code>basic_socket</code>s' <code>next_layer()</code> and then
consume them. <code>basic_socket</code> templatize the underlying internal socket, so you
can use SSL, queue wrapping socket (to work around Asio&#8217;s composed operations)
and so on. The intention of Boost.Http is not only to generalize over data
structures and HTTP backends, but about any place where it may be helpful.</p>
</div>
<div class="paragraph">
<p>The choice to represent the HTTP messages in separate objects and the whole
combination of this design ease supports for HTTP pipelining a lot. In passive
styles, a request is generated and generated and you must act on them. In this
active style, you explicitly request the next message, handle it and then
request another one. In this scenario, two unrelated messages won&#8217;t be mixed up,
because you won&#8217;t see the next message while you don&#8217;t handle the current
one. The read and write states gives a mean to communicate how to use the API
and how to detect some logical errors in the application.</p>
</div>
<div class="paragraph">
<p>The choice to hide details from the HTTP connection (HTTP version, socket
object&#8230;&#8203;) was done to properly support multiple backends. The ability to query
certain properties from the underlying communication channel is necessary to
achieve reliability under this model. A lot of responsibilies and expected
behaviour is documented on the type requirements for <code>ServerSocket</code> objects.</p>
</div>
<div class="paragraph">
<p>A C++11 multimap is used to represent HTTP headers because that&#8217;s what HTTP
headers conceptually are. HTTP spec specifies you must handle HTTP header
elements with equivalent keys as if there was a single header where the values
are joined with commas. Some old headers don&#8217;t work with this approach and their
values, when multiple elements with equivalent keys are present, must be stored
separately. The order matters, just as the C++11 definition of multimap.</p>
</div>
<div class="paragraph">
<p>Runtime-based polymorphic behaviour isn&#8217;t used by default, because not all
projects are willing to pay for this price. Well defined type requirements are
provided and some polymorphic adaptors will convert models of these type
requirements to classes inheriting a single specific abstract base class.</p>
</div>
<div class="paragraph">
<p>Member-functions as opposed to member-variables are used in HTTP messages,
because some setup (e.g. a proxy who doesn&#8217;t want to reformat the messages) may
want to move the HTTP parser to the HTTP message object. I want to allow a
library who will beat C servers in every aspect.</p>
</div>
<div class="paragraph">
<p>As per <a href="https://tools.ietf.org/html/rfc7230#section-3.2.2">RFC 7230</a>, âa server MUST NOT apply a request to the target resource
until the entire request header section is received, since later header fields
might include conditionals, authentication credentials, or deliberately
misleading duplicate header fields that would impact request processingâ, so we
define an interface who will only expose a message once the complete header
section is ready. The message body can be progressively received later. The API
also unifies HTTP messages and HTTP chunking.</p>
</div>
<div class="paragraph">
<p>URL-decomposed objects aren&#8217;t used because all an HTTP backend needs is some
string-like container to push bytes. This container can implement an in-place
URL parsing algorithm and it is all solved. The generic HTTP backends you find
in Boost.Http won&#8217;t care about the url concrete type and you don&#8217;t need to
expect any barrier from this side.</p>
</div>
<div class="paragraph">
<p>We do not use the message itself as a buffer object while we&#8217;re parsing the
connection stream. We require a separate buffer to be able to properly handle
HTTP pipelining (and futurely multiplexing in <code>HTTP/2.0</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_when">3.2.5. The when</h4>
<div class="paragraph">
<p>I couldn&#8217;t resist the temptation of adding a â<em>when</em>â named section after I
already had written a â<em>what</em>â and a â<em>why</em>â section.</p>
</div>
<div class="paragraph">
<p>Just too much research time went into this proposal. Really, a lot of time. I
developed some broken HTTP projects some years ago, learned a lot of design with
really different approaches (PHP, Django, Node.js) trying to solve this problem,
developed my own serious project (<a href="https://github.com/vinipsmaker/tufao">TufÃ£o</a>)
and continued to study and research a lot (the HTTP spec resurrection project,
or <a href="https://tools.ietf.org/html/rfc7230#section-3.2.2">RFC 7230</a>, helped <strong>a lot</strong>). I&#8217;ve gathered info around where interoperability
may be a problem if API doesn&#8217;t help and what features will be desired, sooner
or later, by users, among other data. I&#8217;ve done real effort to gather feedback
from C++ programmers for quite a while already.</p>
</div>
<div class="paragraph">
<p>A special thanks to BjÃ¸rn Reese for mentoring me on Asio quirks and API general
design, the feedback which changed the proposal the most. Also a special thanks
to any friend who helped to maintain my mind at a happy state.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_roadmap">3.3. Roadmap</h3>
<div class="ulist">
<ul>
<li>
<p>C++98.</p>
</li>
<li>
<p>Client-side HTTP.</p>
</li>
<li>
<p><code>HTTP/2.0</code>.</p>
</li>
<li>
<p>Request-router.</p>
</li>
<li>
<p>Forms and file uploads.</p>
</li>
<li>
<p>Cookies and sessions (RFC 6265).</p>
</li>
<li>
<p>WebSocket.</p>
</li>
<li>
<p>Alternative backends.</p>
</li>
<li>
<p>Increase test coverage a lot.</p>
</li>
<li>
<p>Benchmarks.</p>
</li>
<li>
<p>Compress replies.</p>
</li>
<li>
<p>WebDAV (it will depend on Boost.XML, which doesn&#8217;t exist yet).</p>
</li>
<li>
<p>World domination.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reference">4. Reference</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All declarations from this library resides within the <code>boost::http</code>
namespace. For brevity, this prefix is <strong>not</strong> repeated on the documentation.</p>
</div>
<div class="sect2">
<h3 id="_summary">4.1. Summary</h3>
<div class="sect3">
<h4 id="_classes">4.1.1. Classes</h4>
<div class="ulist">
<ul>
<li>
<p><a href="#headers"><code>headers</code></a></p>
</li>
<li>
<p><a href="#request"><code>request</code></a></p>
</li>
<li>
<p><a href="#response"><code>response</code></a></p>
</li>
<li>
<p><a href="#socket"><code>socket</code></a></p>
</li>
<li>
<p><a href="#buffered_socket"><code>buffered_socket</code></a></p>
</li>
<li>
<p><a href="#polymorphic_socket_base"><code>polymorphic_socket_base</code></a></p>
</li>
<li>
<p><a href="#polymorphic_server_socket"><code>polymorphic_server_socket</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_class_templates">4.1.2. Class Templates</h4>
<div class="ulist">
<ul>
<li>
<p><a href="#basic_request"><code>basic_request</code></a></p>
</li>
<li>
<p><a href="#basic_response"><code>basic_response</code></a></p>
</li>
<li>
<p><a href="#basic_socket"><code>basic_socket</code></a></p>
</li>
<li>
<p><a href="#basic_buffered_socket"><code>basic_buffered_socket</code></a></p>
</li>
<li>
<p><a href="#request_response_wrapper"><code>request_response_wrapper</code></a></p>
</li>
<li>
<p><a href="#basic_polymorphic_socket_base"><code>basic_polymorphic_socket_base</code></a></p>
</li>
<li>
<p><a href="#basic_polymorphic_server_socket"><code>basic_polymorphic_server_socket</code></a></p>
</li>
<li>
<p><a href="#server_socket_adaptor"><code>server_socket_adaptor</code></a></p>
</li>
<li>
<p><a href="#is_message"><code>is_message</code></a></p>
</li>
<li>
<p><a href="#is_request_message"><code>is_request_message</code></a></p>
</li>
<li>
<p><a href="#is_response_message"><code>is_response_message</code></a></p>
</li>
<li>
<p><a href="#is_socket"><code>is_socket</code></a></p>
</li>
<li>
<p><a href="#is_server_socket"><code>is_server_socket</code></a></p>
</li>
<li>
<p><a href="#basic_router"><code>basic_router</code></a></p>
</li>
<li>
<p><a href="#regex_router"><code>regex_router</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_free_functions">4.1.3. Free Functions</h4>
<div class="ulist">
<ul>
<li>
<p>Header processing</p>
<div class="ulist">
<ul>
<li>
<p><a href="#header_to_ptime"><code>header_to_ptime</code></a></p>
</li>
<li>
<p><a href="#to_http_date"><code>to_http_date</code></a></p>
</li>
<li>
<p><a href="#header_value_all_of"><code>header_value_all_of</code></a></p>
</li>
<li>
<p><a href="#header_value_any_of"><code>header_value_any_of</code></a></p>
</li>
<li>
<p><a href="#header_value_none_of"><code>header_value_none_of</code></a></p>
</li>
<li>
<p><a href="#header_value_for_each"><code>header_value_for_each</code></a></p>
</li>
<li>
<p><a href="#etag_match_strong"><code>etag_match_strong</code></a></p>
</li>
<li>
<p><a href="#etag_match_weak"><code>etag_match_weak</code></a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Channel querying</p>
<div class="ulist">
<ul>
<li>
<p><a href="#request_continue_required"><code>request_continue_required</code></a></p>
</li>
<li>
<p><a href="#request_upgrade_desired"><code>request_upgrade_desired</code></a></p>
</li>
</ul>
</div>
</li>
<li>
<p>File server</p>
<div class="ulist">
<ul>
<li>
<p><a href="#async_response_transmit_file"><code>async_response_transmit_file</code></a></p>
</li>
<li>
<p><a href="#async_response_transmit_dir"><code>async_response_transmit_dir</code></a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_enumerations">4.1.4. Enumerations</h4>
<div class="ulist">
<ul>
<li>
<p><a href="#read_state"><code>read_state</code></a></p>
</li>
<li>
<p><a href="#write_state"><code>write_state</code></a></p>
</li>
<li>
<p><a href="#status_code"><code>status_code</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_error_codes">4.1.5. Error Codes</h4>
<div class="ulist">
<ul>
<li>
<p><a href="#http_errc"><code>http_errc</code></a></p>
</li>
<li>
<p><a href="#file_server_errc"><code>file_server_errc</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_type_requirements">4.1.6. Type Requirements</h4>
<div class="ulist">
<ul>
<li>
<p><a href="#message_concept"><code>Message</code></a></p>
</li>
<li>
<p><a href="#request_concept"><code>Request</code></a></p>
</li>
<li>
<p><a href="#response_concept"><code>Response</code></a></p>
</li>
<li>
<p><a href="#socket_concept"><code>Socket</code></a></p>
</li>
<li>
<p><a href="#server_socket_concept"><code>ServerSocket</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_headers">4.1.7. Headers</h4>
<div class="ulist">
<ul>
<li>
<p><a href="#algorithm_header"><code>&lt;boost/http/algorithm.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#header_header"><code>&lt;boost/http/algorithm/header.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#query_header"><code>&lt;boost/http/algorithm/query.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#file_server_header"><code>&lt;boost/http/file_server.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#headers_header"><code>&lt;boost/http/headers.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#http_category_header"><code>&lt;boost/http/http_category.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#http_errc_header"><code>&lt;boost/http/http_errc.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#request_header"><code>&lt;boost/http/request.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#response_header"><code>&lt;boost/http/response.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#request_response_wrapper_header"><code>&lt;boost/http/request_response_wrapper.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#polymorphic_server_socket_header"><code>&lt;boost/http/polymorphic_server_socket.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#polymorphic_socket_base_header"><code>&lt;boost/http/polymorphic_socket_base.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#read_state_header"><code>&lt;boost/http/read_state.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#server_socket_adaptor_header"><code>&lt;boost/http/server_socket_adaptor.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#socket_header"><code>&lt;boost/http/socket.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#buffered_socket_header"><code>&lt;boost/http/buffered_socket.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#status_code_header"><code>&lt;boost/http/status_code.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#write_state_header"><code>&lt;boost/http/write_state.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#traits_header"><code>&lt;boost/http/traits.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#basic_router_header"><code>&lt;boost/http/basic_router.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#regex_router_header"><code>&lt;boost/http/regex_router.hpp&gt;</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_macros">4.1.8. Macros</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>BOOST_HTTP_SOCKET_DEFAULT_BUFFER_SIZE</code></dt>
<dd>
<p>This macro defines the default buffer size for
<a href="#basic_buffered_socket"><code>basic_buffered_socket</code></a>. It&#8217;s safe to override this
value (per using class or globally) and should be done before including the
file <a href="#buffered_socket_header"><code>&lt;boost/http/buffered_socket.hpp&gt;</code></a>. The
default provided value (i.e. the non-overriden version) is unspecified
(e.g. can change among versions and platforms).</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_detailed">4.2. Detailed</h3>
<div class="sect3">
<h4 id="headers">4.2.1. <code>headers</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/headers.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>headers</code> is a simple typedef for some unspecified multimap container.</p>
</div>
<div class="paragraph">
<p>The user can safely assume that <code>headers::key_type</code> will be <code>std::string</code> and
<code>headers::mapped_type</code> will be <code>std::string</code>. <code>std::string</code> is used because
fulfills the requirements perfectly and is very unlikely it will ever cause any
controversy.</p>
</div>
<div class="paragraph">
<p>The user can also assume that this type fulfills the <a href="#message_concept">Headers
definition of message</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Previously, <code>headers</code> was guaranteed to be a typedef for
<code>boost::container::flat_multimap</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="request">4.2.2. <code>request</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/request.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>request</code> is a simple typedef for <a href="#basic_request"><code>basic_request</code></a>. It&#8217;s
defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">typedef</span> <span class="tok-n">basic_request</span><span class="tok-o">&lt;</span><span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">string</span><span class="tok-p">,</span> <span class="tok-n">headers</span><span class="tok-p">,</span> <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">vector</span><span class="tok-o">&lt;</span><span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-kt">uint8_t</span><span class="tok-o">&gt;&gt;</span> <span class="tok-n">request</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>std::vector&lt;std::uint8_t&gt;</code> is used over <code>std::string</code>, because fits the purpose
of the body (binary data payload container) better (no <code>'\0'</code> character
terminator, well-defined behaviours of capacity, size and iterator invalidation,
&#8230;&#8203;).</p>
</div>
<div class="sect4">
<h5 id="_see_also">4.2.2.1. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#headers"><code>headers</code></a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="response">4.2.3. <code>response</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/response.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>response</code> is a simple typedef for <a href="#basic_response"><code>basic_response</code></a>. It&#8217;s
defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">typedef</span> <span class="tok-n">basic_response</span><span class="tok-o">&lt;</span><span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">string</span><span class="tok-p">,</span> <span class="tok-n">headers</span><span class="tok-p">,</span> <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">vector</span><span class="tok-o">&lt;</span><span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-kt">uint8_t</span><span class="tok-o">&gt;&gt;</span> <span class="tok-n">response</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>std::vector&lt;std::uint8_t&gt;</code> is used over <code>std::string</code>, because fits the purpose
of the body (binary data payload container) better (no <code>'\0'</code> character
terminator, well-defined behaviours of capacity, size and iterator invalidation,
&#8230;&#8203;).</p>
</div>
<div class="sect4">
<h5 id="_see_also_2">4.2.3.1. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#headers"><code>headers</code></a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="socket">4.2.4. <code>socket</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/socket.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>socket</code> is a simple typedef for <a href="#basic_socket"><code>basic_socket</code></a>. It&#8217;s defined
as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">typedef</span> <span class="tok-n">basic_socket</span><span class="tok-o">&lt;</span><span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">ip</span><span class="tok-o">::</span><span class="tok-n">tcp</span><span class="tok-o">::</span><span class="tok-n">socket</span><span class="tok-o">&gt;</span> <span class="tok-n">socket</span><span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="buffered_socket">4.2.5. <code>buffered_socket</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/buffered_socket.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>buffered_socket</code> is a simple typedef for <a href="#basic_buffered_socket"><code>basic_buffered_socket</code></a>. It&#8217;s defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">typedef</span> <span class="tok-n">basic_buffered_socket</span><span class="tok-o">&lt;</span><span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">ip</span><span class="tok-o">::</span><span class="tok-n">tcp</span><span class="tok-o">::</span><span class="tok-n">socket</span><span class="tok-o">&gt;</span> <span class="tok-n">buffered_socket</span><span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="request_response_wrapper">4.2.6. <code>request_response_wrapper</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/request_response_wrapper.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>request_response_wrapper</code> is an adapter which acts like a common type (akin to
<code>std::common_type</code>) for different <code>Request</code> and <code>Response</code> types. There is no
type erasure and only <a href="#message_concept"><code>Message</code> interface</a> will be available.</p>
</div>
<div class="paragraph">
<p>The purpose of this class is <strong>not</strong> to be a polymorphic wrapper. Therefore, it&#8217;s
not our concern to make sure compatible objects (i.e. objects with the same
<code>header_type</code> and so on) are of the <strong>same</strong> <code>request_response_wrapper</code> type. In
other words, <code>request_response_wrapper</code> will not free you from the template work
if you want to support different <code>Request</code>/<code>Response</code> types. This is <strong>not</strong> a
design issue. However, there is a templated constructor which can accept <strong>some</strong>
different types.</p>
</div>
<div class="sect4">
<h5 id="_template_parameters">4.2.6.1. Template parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>Request</code></dt>
<dd>
<p>A model of the <a href="#message_concept"><code>Message</code> concept</a>.</p>
</dd>
<dt class="hdlist1"><code>Response</code></dt>
<dd>
<p>A model of the <a href="#message_concept"><code>Message</code> concept</a>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>Response::headers_type</code> must be the same as <code>Request::headers_type</code>. And
the same applies to <code>Response::body_type</code>. Also, if <code>const</code> is applied to
<code>Request</code> or <code>Response</code>, it must be applied to both.
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_member_types">4.2.6.2. Member types</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>headers_type</code></dt>
<dd>
<p>If <code>Request</code> is <code>const</code>, then it is defined as <code>const typename
Request::headers_type</code>. Otherwise, it&#8217;s defined as <code>typename
Request::headers_type</code>.</p>
</dd>
<dt class="hdlist1"><code>body_type</code></dt>
<dd>
<p>If <code>Request</code> is <code>const</code>, then it is defined as <code>const typename
Request::body_type</code>. Otherwise, it&#8217;s defined as <code>typename Request::body_type</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_member_functions">4.2.6.3. Member functions</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>request_response_wrapper(Request &amp;request)</code></dt>
<dd>
<p>Constructs a <code>request_response_wrapper</code> from a <code>Request</code>.</p>
</dd>
<dt class="hdlist1"><code>request_response_wrapper(Response &amp;response)</code></dt>
<dd>
<p>Constructs a <code>request_response_wrapper</code> from a <code>Response</code>.</p>
</dd>
<dt class="hdlist1"><code>template&lt;class Request2, class Response2&gt; request_response_wrapper(request_response_wrapper&lt;Request2, Response2&gt; &amp;other)</code></dt>
<dd>
<p>Constructs a <code>request_response_wrapper</code> from another
<code>request_response_wrapper</code> with compatible <code>headers_type</code> and <code>body_type</code>.</p>
</dd>
</dl>
</div>
<div class="sect5">
<h6 id="__code_message_code_concept"><code>Message</code> concept</h6>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>headers_type &amp;headers()</code></dt>
<dd>
<p>Returns the wrapped headers object.</p>
</dd>
<dt class="hdlist1"><code>const headers_type &amp;headers() const</code></dt>
<dd>
<p>Returns the wrapped headers object.</p>
</dd>
<dt class="hdlist1"><code>body_type &amp;body()</code></dt>
<dd>
<p>Returns the wrapped body object.</p>
</dd>
<dt class="hdlist1"><code>const body_type &amp;body() const</code></dt>
<dd>
<p>Returns the wrapped body object.</p>
</dd>
<dt class="hdlist1"><code>headers_type &amp;trailers()</code></dt>
<dd>
<p>Returns the wrapped trailers object.</p>
</dd>
<dt class="hdlist1"><code>const headers_type &amp;trailers() const</code></dt>
<dd>
<p>Returns the wrapped trailers object.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_see_also_3">4.2.6.4. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#polymorphic_socket_base"><code>polymorphic_socket_base</code></a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic_polymorphic_socket_base">4.2.7. <code>basic_polymorphic_socket_base</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/polymorphic_socket_base.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>basic_polymorphic_socket_base</code> is the base class for all classes in the
hierarchy defined for runtime-based polymorphic HTTP producers. It is an
abstract class that only contains functionality useful for simultaneously both
channel ends (client and server).</p>
</div>
<div class="paragraph">
<p>References for objects of this class are expected to fulfill the
<a href="#socket_concept"><code>Socket</code> concept</a>.</p>
</div>
<div class="paragraph">
<p>This class has no state to ease multiple inheritance and it is inherited by
<a href="#basic_polymorphic_server_socket"><code>basic_polymorphic_server_socket</code></a>.</p>
</div>
<div class="paragraph">
<p>The design for the hierarchy started with this class was a little inspired by
<em>C++'s iostream</em> and
<a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3525.pdf">N3525:
Polymorphic Allocators</a>.</p>
</div>
<div class="sect4">
<h5 id="_template_parameters_2">4.2.7.1. Template parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>Message</code></dt>
<dd>
<p>The message type.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_member_types_2">4.2.7.2. Member types</h5>
<div class="paragraph">
<p>These are the types chosen <em>set in stone</em> to guarantee ABI stability across
binaries (including possible plugins).</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>typedef Message message_type</code></dt>
<dd>
<p>The message type usable within this class&#8217;s operations.</p>
</dd>
<dt class="hdlist1"><code>typedef std::function&lt;void(boost::system::error_code)&gt; callback_type</code></dt>
<dd>
<p>It is so standard that is the only of its kind living in the standard
library. It&#8217;s flexible enough to type erase any other handler. Needless to say
more.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_member_functions_2">4.2.7.3. Member functions</h5>
<div class="sect5">
<h6 id="_overwritable_functions">Overwritable functions</h6>
<div class="paragraph">
<p>These are the functions that subclasses need to implement in order to lose the
<code>abstract class</code> property.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>virtual asio::io_service&amp; get_io_service() = 0</code></dt>
<dd>
<p>This function presents no differences (besides mandatory virtual) from the one
with the same name found on the <a href="#socket_concept"><code>Socket</code> concept</a>.</p>
</dd>
<dt class="hdlist1"><code>virtual bool is_open() const = 0</code></dt>
<dd>
<p>This function presents no differences (besides mandatory virtual) from the one
with the same name found on the <a href="#socket_concept"><code>Socket</code> concept</a>.</p>
</dd>
<dt class="hdlist1"><code>virtual read_state read_state() const = 0</code></dt>
<dd>
<p>This function presents no differences (besides mandatory virtual) from the one
with the same name found on the <a href="#socket_concept"><code>Socket</code> concept</a>.</p>
</dd>
<dt class="hdlist1"><code>virtual write_state write_state() const = 0</code></dt>
<dd>
<p>This function presents no differences (besides mandatory virtual) from the one
with the same name found on the <a href="#socket_concept"><code>Socket</code> concept</a>.</p>
</dd>
<dt class="hdlist1"><code>virtual void async_read_some(message_type &amp;message, callback_type handler) = 0</code></dt>
<dd>
<p>The only difference between this function (besides mandatory virtual) and the
one with the same name found on the <a href="#socket_concept"><code>Socket</code> concept</a> is the
lack of support for completion tokens and the use of a type erased handler
instead.</p>
</dd>
<dt class="hdlist1"><code>virtual void async_read_trailers(message_type &amp;message, callback_type handler) = 0</code></dt>
<dd>
<p>The only difference between this function (besides mandatory virtual) and the
one with the same name found on the <a href="#socket_concept"><code>Socket</code> concept</a> is the
lack of support for completion tokens and the use of a type erased handler
instead.</p>
</dd>
<dt class="hdlist1"><code>virtual void async_write(const message_type &amp;message, callback_type handler) = 0</code></dt>
<dd>
<p>The only difference between this function (besides mandatory virtual) and the
one with the same name found on the <a href="#socket_concept"><code>Socket</code> concept</a> is the
lack of support for completion tokens and the use of a type erased handler
instead.</p>
</dd>
<dt class="hdlist1"><code>virtual void async_write_trailers(const message_type &amp;message, callback_type handler) = 0</code></dt>
<dd>
<p>The only difference between this function (besides mandatory virtual) and the
one with the same name found on the <a href="#socket_concept"><code>Socket</code> concept</a> is the
lack of support for completion tokens and the use of a type erased handler
instead.</p>
</dd>
<dt class="hdlist1"><code>virtual void async_write_end_of_message(callback_type handler) = 0</code></dt>
<dd>
<p>The only difference between this function (besides mandatory virtual) and the
one with the same name found on the <a href="#socket_concept"><code>Socket</code> concept</a> is the
lack of support for completion tokens and the use of a type erased handler
instead.</p>
</dd>
<dt class="hdlist1"><code>virtual ~basic_polymorphic_socket_base() = 0</code></dt>
<dd>
<p>Destructor. Inline definition done with <code>= default</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="_wrappers_to_fulfill_the_asio_extensible_model">Wrappers to fulfill the ASIO extensible model</h6>
<div class="paragraph">
<p>These functions rewrite usual function calls in terms of the ABI stable
interface. They also enable the ASIO extensible model within this hierarchy.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>template&lt;class CompletionToken&gt; typename boost::asio::async_result&lt;typename boost::asio::handler_type&lt;CompletionToken, void(boost::system::error_code)&gt;::type&gt;::type async_read_some(message_type &amp;message, CompletionToken &amp;&amp;token)</code></dt>
<dd>
<p>Handle the token and dispatch the operation to the ABI stable
<code>async_read_some</code>.</p>
</dd>
<dt class="hdlist1"><code>template&lt;class CompletionToken&gt; typename boost::asio::async_result&lt;typename boost::asio::handler_type&lt;CompletionToken, void(boost::system::error_code)&gt;::type&gt;::type async_read_trailers(message_type &amp;message, CompletionToken &amp;&amp;token)</code></dt>
<dd>
<p>Handle the token and dispatch the operation to the ABI stable
<code>async_read_trailers</code>.</p>
</dd>
<dt class="hdlist1"><code>template&lt;class CompletionToken&gt; typename boost::asio::async_result&lt;typename boost::asio::handler_type&lt;CompletionToken, void(boost::system::error_code)&gt;::type&gt;::type async_write(const message_type &amp;message, CompletionToken &amp;&amp;token)</code></dt>
<dd>
<p>Handle the token and dispatch the operation to the ABI stable
<code>async_write</code>.</p>
</dd>
<dt class="hdlist1"><code>template&lt;class CompletionToken&gt; typename boost::asio::async_result&lt;typename boost::asio::handler_type&lt;CompletionToken, void(boost::system::error_code)&gt;::type&gt;::type async_write_trailers(const message_type &amp;message, CompletionToken &amp;&amp;token)</code></dt>
<dd>
<p>Handle the token and dispatch the operation to the ABI stable
<code>async_write_trailers</code>.</p>
</dd>
<dt class="hdlist1"><code>template&lt;class CompletionToken&gt; typename boost::asio::async_result&lt;typename boost::asio::handler_type&lt;CompletionToken, void(boost::system::error_code)&gt;::type&gt;::type async_write_end_of_message(CompletionToken &amp;&amp;token)</code></dt>
<dd>
<p>Handle the token and dispatch the operation to the ABI stable
<code>async_write_end_of_message</code>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_see_also_4">4.2.7.4. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#polymorphic_socket_base"><code>polymorphic_socket_base</code></a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic_polymorphic_server_socket">4.2.8. <code>basic_polymorphic_server_socket</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/polymorphic_server_socket.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This class inherits <a href="#basic_polymorphic_socket_base"><code>basic_polymorphic_socket_base&lt;Message&gt;</code></a> and extends its interface with
virtual functions useful for server sockets. This class itself is also an
abstract class with no state (i.e. an <em>interface</em>).</p>
</div>
<div class="paragraph">
<p>References for objects of this class are expected to fulfill the
<a href="#server_socket_concept"><code>ServerSocket</code> concept</a>.</p>
</div>
<div class="paragraph">
<p>This class is inherited by <a href="#server_socket_adaptor"><code>server_socket_adaptor</code></a>.</p>
</div>
<div class="sect4">
<h5 id="_template_parameters_3">4.2.8.1. Template parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>Request</code></dt>
<dd>
<p>The request type.</p>
</dd>
<dt class="hdlist1"><code>Response</code></dt>
<dd>
<p>The response type.</p>
</dd>
<dt class="hdlist1"><code>Message = request_response_wrapper&lt;Request, Response&gt;</code></dt>
<dd>
<p>The message type.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_member_types_3">4.2.8.2. Member types</h5>
<div class="paragraph">
<p>These are the types chosen <em>set in stone</em> to guarantee ABI stability across
binaries (including possible plugins).</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>typedef Request request_server_type</code></dt>
<dd>
<p>The <code>server_type</code> suffix is used to avoid name clashing with a possible HTTP
client abstraction.</p>
</dd>
<dt class="hdlist1"><code>typedef Response response_server_type</code></dt>
<dd>
<p>The <code>server_type</code> suffix is used to avoid name clashing with a possible HTTP
client abstraction.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_member_functions_3">4.2.8.3. Member functions</h5>
<div class="sect5">
<h6 id="_overwritable_functions_2">Overwritable functions</h6>
<div class="paragraph">
<p>These are the functions that subclasses need to implement in order to lose the
<code>abstract class</code> property.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>virtual bool write_response_native_stream() const = 0</code></dt>
<dd>
<p>This function presents no differences (besides mandatory virtual) from the one
with the same name found on the <a href="#server_socket_concept"><code>ServerSocket</code>
concept</a>.</p>
</dd>
<dt class="hdlist1"><code>virtual void async_read_request(request_server_type &amp;request, callback_type handler) = 0</code></dt>
<dd>
<p>The only difference between this function (besides mandatory virtual) and the
one with the same name found on the <a href="#server_socket_concept"><code>ServerSocket</code>
concept</a> is the lack of support for completion tokens and the use of a type
erased handler instead.</p>
</dd>
<dt class="hdlist1"><code>virtual void async_write_response(const response_server_type &amp;response, callback_type handler) = 0</code></dt>
<dd>
<p>The only difference between this function (besides mandatory virtual) and the
one with the same name found on the <a href="#server_socket_concept"><code>ServerSocket</code>
concept</a> is the lack of support for completion tokens and the use of a type
erased handler instead.</p>
</dd>
<dt class="hdlist1"><code>virtual void async_write_response_continue(callback_type handler) = 0</code></dt>
<dd>
<p>The only difference between this function (besides mandatory virtual) and the
one with the same name found on the <a href="#server_socket_concept"><code>ServerSocket</code>
concept</a> is the lack of support for completion tokens and the use of a type
erased handler instead.</p>
</dd>
<dt class="hdlist1"><code>virtual void async_write_response_metadata(const response_server_type &amp;response, callback_type handler) = 0</code></dt>
<dd>
<p>The only difference between this function (besides mandatory virtual) and the
one with the same name found on the <a href="#server_socket_concept"><code>ServerSocket</code>
concept</a> is the lack of support for completion tokens and the use of a type
erased handler instead.</p>
</dd>
<dt class="hdlist1"><code>virtual ~basic_polymorphic_server_socket()</code></dt>
<dd>
<p>Destructor.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="_wrappers_to_fulfill_the_asio_extensible_model_2">Wrappers to fulfill the ASIO extensible model</h6>
<div class="paragraph">
<p>These functions rewrite usual function calls in terms of the ABI stable
interface. They also enable the ASIO extensible model within this hierarchy.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>template&lt;class CompletionToken&gt; typename boost::asio::async_result&lt;typename boost::asio::handler_type&lt;CompletionToken, void(boost::system::error_code)&gt;::type&gt;::type async_read_request(request_server_type &amp;request, CompletionToken &amp;&amp;token)</code></dt>
<dd>
<p>Handle the token and dispatch the operation to the ABI stable
<code>async_read_request</code>.</p>
</dd>
<dt class="hdlist1"><code>template&lt;class CompletionToken&gt; typename boost::asio::async_result&lt;typename boost::asio::handler_type&lt;CompletionToken, void(boost::system::error_code)&gt;::type&gt;::type async_write_response(const response_server_type &amp;response, CompletionToken &amp;&amp;token)</code></dt>
<dd>
<p>Handle the token and dispatch the operation to the ABI stable
<code>async_write_response</code>.</p>
</dd>
<dt class="hdlist1"><code>template&lt;class CompletionToken&gt; typename boost::asio::async_result&lt;typename boost::asio::handler_type&lt;CompletionToken, void(boost::system::error_code)&gt;::type&gt;::type async_write_response_continue(CompletionToken &amp;&amp;token)</code></dt>
<dd>
<p>Handle the token and dispatch the operation to the ABI stable
<code>async_write_response_continue</code>.</p>
</dd>
<dt class="hdlist1"><code>template&lt;class CompletionToken&gt; typename boost::asio::async_result&lt;typename boost::asio::handler_type&lt;CompletionToken, void(boost::system::error_code)&gt;::type&gt;::type async_write_response_metadata(const response_server_type &amp;response, CompletionToken &amp;&amp;token)</code></dt>
<dd>
<p>Handle the token and dispatch the operation to the ABI stable
<code>async_write_response_metadata</code>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_see_also_5">4.2.8.4. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#polymorphic_server_socket"><code>polymorphic_server_socket</code></a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="polymorphic_socket_base">4.2.9. <code>polymorphic_socket_base</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/polymorphic_socket_base.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>polymorphic_socket_base</code> is a simple typedef for
<a href="#basic_polymorphic_socket_base"><code>basic_polymorphic_socket_base</code></a>. It&#8217;s defined
as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">typedef</span> <span class="tok-n">basic_polymorphic_socket_base</span><span class="tok-o">&lt;</span><span class="tok-n">request_response_wrapper</span><span class="tok-o">&lt;</span><span class="tok-n">request</span><span class="tok-p">,</span> <span class="tok-n">response</span><span class="tok-o">&gt;&gt;</span>
  <span class="tok-n">polymorphic_socket_base</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_see_also_6">4.2.9.1. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#basic_polymorphic_socket_base"><code>basic_polymorphic_socket_base</code></a></p>
</li>
<li>
<p><a href="#request"><code>request</code></a></p>
</li>
<li>
<p><a href="#response"><code>response</code></a></p>
</li>
<li>
<p><a href="#request_response_wrapper"><code>request_response_wrapper</code></a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="polymorphic_server_socket">4.2.10. <code>polymorphic_server_socket</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/polymorphic_server_socket.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>polymorphic_server_socket</code> is a simple typedef for
<a href="#basic_polymorphic_server_socket"><code>basic_polymorphic_server_socket</code></a>. It&#8217;s
defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">typedef</span> <span class="tok-n">basic_polymorphic_server_socket</span><span class="tok-o">&lt;</span><span class="tok-n">request</span><span class="tok-p">,</span> <span class="tok-n">response</span><span class="tok-o">&gt;</span>
  <span class="tok-n">polymorphic_server_socket</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_see_also_7">4.2.10.1. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#basic_polymorphic_server_socket"><code>basic_polymorphic_server_socket</code></a></p>
</li>
<li>
<p><a href="#message"><code>message</code></a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic_request">4.2.11. <code>basic_request</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/request.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This template can be used to easily define classes fulfilling the
<a href="#request_concept"><code>Request</code> concept</a> and specializing the
<a href="#is_request_message"><code>is_request_message</code></a> trait.</p>
</div>
<div class="sect4">
<h5 id="_template_parameters_4">4.2.11.1. Template parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>String</code></dt>
<dd>
<p>The type to fulfill the <code>X::string_type</code> from the <a href="#request_concept"><code>Request</code>
concept</a>.</p>
</dd>
<dt class="hdlist1"><code>Headers</code></dt>
<dd>
<p>The type to fulfill the <code>X::headers_type</code> from the <a href="#request_concept"><code>Request</code>
concept</a>.</p>
</dd>
<dt class="hdlist1"><code>Body</code></dt>
<dd>
<p>The type to fulfill the <code>X::body_type</code> from the <a href="#request_concept"><code>Request</code>
concept</a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_member_types_4">4.2.11.2. Member types</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>typedef String string_type</code></dt>
<dd>
<p>The type to fulfill the <code>X::string_type</code> from the <a href="#request_concept"><code>Request</code>
concept</a>.</p>
</dd>
<dt class="hdlist1"><code>typedef Headers headers_type</code></dt>
<dd>
<p>The type to fulfill the <code>X::headers_type</code> from the <a href="#request_concept"><code>Request</code>
concept</a>.</p>
</dd>
<dt class="hdlist1"><code>typedef Body body_type</code></dt>
<dd>
<p>The type to fulfill the <code>X::body_type</code> from the <a href="#request_concept"><code>Request</code>
concept</a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_member_functions_4">4.2.11.3. Member functions</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>string_type &amp;method()</code></dt>
<dd>
<p>Returns the internal method object.</p>
</dd>
<dt class="hdlist1"><code>const string_type &amp;method() const</code></dt>
<dd>
<p>Returns the internal method object.</p>
</dd>
<dt class="hdlist1"><code>string_type &amp;target()</code></dt>
<dd>
<p>Returns the internal request target object.</p>
</dd>
<dt class="hdlist1"><code>const string_type &amp;target() const</code></dt>
<dd>
<p>Returns the internal request target object.</p>
</dd>
<dt class="hdlist1"><code>headers_type &amp;headers()</code></dt>
<dd>
<p>Returns the internal headers object.</p>
</dd>
<dt class="hdlist1"><code>const headers_type &amp;headers() const</code></dt>
<dd>
<p>Returns the internal headers object.</p>
</dd>
<dt class="hdlist1"><code>body_type &amp;body()</code></dt>
<dd>
<p>Returns the internal body object.</p>
</dd>
<dt class="hdlist1"><code>const body_type &amp;body() const</code></dt>
<dd>
<p>Returns the internal body object.</p>
</dd>
<dt class="hdlist1"><code>headers_type &amp;trailers()</code></dt>
<dd>
<p>Returns the internal trailers object.</p>
</dd>
<dt class="hdlist1"><code>const headers_type &amp;trailers() const</code></dt>
<dd>
<p>Returns the internal trailers object.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_see_also_8">4.2.11.4. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#request"><code>request</code></a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic_response">4.2.12. <code>basic_response</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/response.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This template can be used to easily define classes fulfilling the
<a href="#response_concept"><code>Response</code> concept</a> and specializing the
<a href="#is_response_message"><code>is_response_message</code></a> trait.</p>
</div>
<div class="sect4">
<h5 id="_template_parameters_5">4.2.12.1. Template parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>String</code></dt>
<dd>
<p>The type to fulfill the <code>X::string_type</code> from the <a href="#response_concept"><code>Response</code> concept</a>.</p>
</dd>
<dt class="hdlist1"><code>Headers</code></dt>
<dd>
<p>The type to fulfill the <code>X::headers_type</code> from the <a href="#response_concept"><code>Response</code> concept</a>.</p>
</dd>
<dt class="hdlist1"><code>Body</code></dt>
<dd>
<p>The type to fulfill the <code>X::body_type</code> from the <a href="#response_concept"><code>Response</code>
concept</a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_member_types_5">4.2.12.2. Member types</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>typedef String string_type</code></dt>
<dd>
<p>The type to fulfill the <code>X::string_type</code> from the <a href="#response_concept"><code>Response</code> concept</a>.</p>
</dd>
<dt class="hdlist1"><code>typedef Headers headers_type</code></dt>
<dd>
<p>The type to fulfill the <code>X::headers_type</code> from the <a href="#response_concept"><code>Response</code> concept</a>.</p>
</dd>
<dt class="hdlist1"><code>typedef Body body_type</code></dt>
<dd>
<p>The type to fulfill the <code>X::body_type</code> from the <a href="#response_concept"><code>Response</code>
concept</a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_member_functions_5">4.2.12.3. Member functions</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>std::uint_least16_t &amp;status_code()</code></dt>
<dd>
<p>Returns the internal status code object.</p>
</dd>
<dt class="hdlist1"><code>const std::uint_least16_t &amp;status_code() const</code></dt>
<dd>
<p>Returns the internal status code object.</p>
</dd>
<dt class="hdlist1"><code>string_type &amp;reason_phrase()</code></dt>
<dd>
<p>Returns the internal reason phrase object.</p>
</dd>
<dt class="hdlist1"><code>const string_type &amp;reason_phrase() const</code></dt>
<dd>
<p>Returns the internal reason phrase object.</p>
</dd>
<dt class="hdlist1"><code>headers_type &amp;headers()</code></dt>
<dd>
<p>Returns the internal headers object.</p>
</dd>
<dt class="hdlist1"><code>const headers_type &amp;headers() const</code></dt>
<dd>
<p>Returns the internal headers object.</p>
</dd>
<dt class="hdlist1"><code>body_type &amp;body()</code></dt>
<dd>
<p>Returns the internal body object.</p>
</dd>
<dt class="hdlist1"><code>const body_type &amp;body() const</code></dt>
<dd>
<p>Returns the internal body object.</p>
</dd>
<dt class="hdlist1"><code>headers_type &amp;trailers()</code></dt>
<dd>
<p>Returns the internal trailers object.</p>
</dd>
<dt class="hdlist1"><code>const headers_type &amp;trailers() const</code></dt>
<dd>
<p>Returns the internal trailers object.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_see_also_9">4.2.12.4. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#response"><code>response</code></a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic_socket">4.2.13. <code>basic_socket</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/socket.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This template can be used to easily define classes fulfilling the strict
<a href="#server_socket_concept"><code>ServerSocket</code> concept</a> and specializing the
<a href="#is_server_socket"><code>is_server_socket</code></a> trait. These classes exposes the
<code>HTTP/1.1</code> wire format (i.e. a builtin/standalone HTTP server) into an
easy-to-use API.</p>
</div>
<div class="paragraph">
<p>The underlying I/O object is expected to have the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is stream-oriented (i.e. no message boundaries; read or write operations
may transfer fewer bytes than requested&#8230;&#8203;).</p>
</li>
<li>
<p>It fulfills the ASIO&#8217;s <code>AsyncReadStream</code> requirement.</p>
</li>
<li>
<p>It fulfills the ASIO&#8217;s <code>AsyncWriteStream</code> requirement.</p>
</li>
<li>
<p>It is backed by a reliable transport or session-layer âconnectionâ with
in-order delivery of octets (i.e. any 8-bit sequence of data).</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This class doesn&#8217;t restrict the message, method, path and reason phrase types.
Therefore, the following members are <strong>not</strong> defined:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>message_type</code></p>
</li>
<li>
<p><code>request_server_type</code></p>
</li>
<li>
<p><code>response_server_type</code></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The API from this class is implemented in terms of composed
operations. As such, you MUST <strong>NOT</strong> initiate any async read operation while
there is another read operation in progress and you MUST <strong>NOT</strong> initiate any
async write operation while there is another write operation in progress. If you
cannot guarantee the ordering of the operations, you should use some queueing
socket (e.g.
<a href="http://sourceforge.net/p/axiomq/code/ci/master/tree/include/axiomq/basic_queue_socket.hpp">
AxioMQ&#8217;s <code>basic_queue_socket</code></a>).
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
You cannot detect the lack of network inactivity properly under this
layer. If you need to implement timeouts, you should do so under the lower
layer.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_template_parameters_6">4.2.13.1. Template parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>Socket</code></dt>
<dd>
<p>The underlying communication channel type. It MUST fulfill the requirements
for ASIO&#8217;s <code>AsyncReadStream</code> and ASIO&#8217;s <code>AsyncWriteStream</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_member_types_6">4.2.13.2. Member types</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>typedef Socket next_layer_type</code></dt>
<dd>
<p>The type of the underlying communication channel.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_member_functions_6">4.2.13.3. Member functions</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>basic_socket(boost::asio::io_service &amp;io_service, boost::asio::mutable_buffer inbuffer)</code></dt>
<dd>
<p>Constructor. <em>io_service</em> is passed to the constructor from the underlying
stream.</p>
<div class="openblock">
<div class="title">Exceptions:</div>
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>std::invalid_argument</code>: If buffer size is zero.</p>
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>template&lt;class&#8230;&#8203; Args&gt; basic_socket(boost::asio::mutable_buffer inbuffer, Args&amp;&amp;&#8230;&#8203; args)</code></dt>
<dd>
<p>Constructor. <em>args</em> are forwarded to the constructor from the underlying
stream.</p>
<div class="openblock">
<div class="title">Exceptions:</div>
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>std::invalid_argument</code>: If buffer size is zero.</p>
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>next_layer_type &amp;next_layer()</code></dt>
<dd>
<p>Returns a reference to the underlying stream.</p>
</dd>
<dt class="hdlist1"><code>const next_layer_type &amp;next_layer() const</code></dt>
<dd>
<p>Returns a reference to the underlying stream.</p>
</dd>
<dt class="hdlist1"><code>void open()</code></dt>
<dd>
<p>Change socket state to open.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
See <code>is_open()</code>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
You MUST cancel current ongoing operations and wait for their
completion handlers to be called before call this function. Otherwise, undefined
behaviour is invoked.
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
<div class="sect5">
<h6 id="__code_socket_code_concept"><code>Socket</code> concept</h6>
<div class="paragraph">
<p>See the <a href="#socket_concept"><code>Socket</code> concept</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>asio::io_service&amp; get_io_service()</code></p>
</li>
<li>
<p><code>bool is_open() const</code></p>
</li>
<li>
<p><code>read_state read_state() const</code></p>
</li>
<li>
<p><code>write_state write_state() const</code></p>
</li>
<li>
<p><code>template&lt;class Message, class CompletionToken&gt;
typename boost::asio::async_result&lt;
    typename boost::asio::handler_type&lt;CompletionToken,
                                void(boost::system::error_code)&gt;::type&gt;::type
async_read_some(Message &amp;message, CompletionToken &amp;&amp;token)</code></p>
</li>
<li>
<p><code>template&lt;class Message, class CompletionToken&gt;
typename boost::asio::async_result&lt;
    typename boost::asio::handler_type&lt;CompletionToken,
                                void(boost::system::error_code)&gt;::type&gt;::type
async_read_trailers(Message &amp;message, CompletionToken &amp;&amp;token)</code></p>
</li>
<li>
<p><code>template&lt;class Message, class CompletionToken&gt;
typename boost::asio::async_result&lt;
    typename boost::asio::handler_type&lt;CompletionToken,
                                void(boost::system::error_code)&gt;::type&gt;::type
async_write(const Message &amp;message, CompletionToken &amp;&amp;token)</code></p>
</li>
<li>
<p><code>template&lt;class Message, class CompletionToken&gt;
typename boost::asio::async_result&lt;
    typename boost::asio::handler_type&lt;CompletionToken,
                                void(boost::system::error_code)&gt;::type&gt;::type
async_write_trailers(const Message &amp;message, CompletionToken &amp;&amp;token)</code></p>
</li>
<li>
<p><code>template&lt;class CompletionToken&gt;
typename boost::asio::async_result&lt;
    typename boost::asio::handler_type&lt;CompletionToken,
                                void(boost::system::error_code)&gt;::type&gt;::type
async_write_end_of_message(CompletionToken &amp;&amp;token)</code></p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="__code_serversocket_code_concept"><code>ServerSocket</code> concept</h6>
<div class="paragraph">
<p>See the <a href="#server_socket_concept"><code>ServerSocket</code> concept</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>bool write_response_native_stream() const</code></p>
</li>
<li>
<p><code>template&lt;class Request, class CompletionToken&gt;
typename boost::asio::async_result&lt;
    typename boost::asio::handler_type&lt;CompletionToken,
                                void(boost::system::error_code)&gt;::type&gt;::type
async_read_request(Request &amp;request, CompletionToken &amp;&amp;token)</code></p>
</li>
<li>
<p><code>template&lt;class Response, class CompletionToken&gt;
typename boost::asio::async_result&lt;
    typename boost::asio::handler_type&lt;CompletionToken,
                                void(boost::system::error_code)&gt;::type&gt;::type
async_write_response(const Response &amp;response, CompletionToken &amp;&amp;token)</code></p>
</li>
<li>
<p><code>template&lt;class CompletionToken&gt;
typename boost::asio::async_result&lt;
    typename boost::asio::handler_type&lt;CompletionToken,
                                void(boost::system::error_code)&gt;::type&gt;::type
async_write_response_continue(CompletionToken &amp;&amp;token)</code></p>
</li>
<li>
<p><code>template&lt;class Response, class CompletionToken&gt;
typename boost::asio::async_result&lt;
    typename boost::asio::handler_type&lt;CompletionToken,
                                void(boost::system::error_code)&gt;::type&gt;::type
async_write_response_metadata(const Response &amp;response,
                              CompletionToken &amp;&amp;token)</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic_buffered_socket">4.2.14. <code>basic_buffered_socket</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/buffered_socket.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This template can be used to easily define classes fulfilling the strict
<a href="#server_socket_concept"><code>ServerSocket</code> concept</a>. These classes exposes the
<code>HTTP/1.1</code> wire format (i.e. a builtin/standalone HTTP server) into an
easy-to-use API.</p>
</div>
<div class="paragraph">
<p>The underlying I/O object is expected to have the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is stream-oriented (i.e. no message boundaries; read or write operations
may transfer fewer bytes than requested&#8230;&#8203;).</p>
</li>
<li>
<p>It fulfills the ASIO&#8217;s <code>AsyncReadStream</code> requirement.</p>
</li>
<li>
<p>It fulfills the ASIO&#8217;s <code>AsyncWriteStream</code> requirement.</p>
</li>
<li>
<p>It is backed by a reliable transport or session-layer âconnectionâ with
in-order delivery of octets (i.e. any 8-bit sequence of data).</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This class doesn&#8217;t restrict the message, method, path and reason phrase types.
Therefore, the following members are <strong>not</strong> defined:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>message_type</code></p>
</li>
<li>
<p><code>request_server_type</code></p>
</li>
<li>
<p><code>response_server_type</code></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The API from this class is implemented in terms of composed
operations. As such, you MUST <strong>NOT</strong> initiate any async read operation while
there is another read operation in progress and you MUST <strong>NOT</strong> initiate any
async write operation while there is another write operation in progress. If you
cannot guarantee the ordering of the operations, you should use some queueing
socket (e.g.
<a href="http://sourceforge.net/p/axiomq/code/ci/master/tree/include/axiomq/basic_queue_socket.hpp">
AxioMQ&#8217;s <code>basic_queue_socket</code></a>).
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
You cannot detect the lack of network inactivity properly under this
layer. If you need to implement timeouts, you should do so under the lower
layer.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_template_parameters_7">4.2.14.1. Template parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>Socket</code></dt>
<dd>
<p>The underlying communication channel type. It MUST fulfill the requirements
for ASIO&#8217;s <code>AsyncReadStream</code> and ASIO&#8217;s <code>AsyncWriteStream</code>.</p>
</dd>
<dt class="hdlist1"><code>N</code></dt>
<dd>
<p>The internal buffer size. It defaults to
<code>BOOST_HTTP_SOCKET_DEFAULT_BUFFER_SIZE</code></p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_member_types_7">4.2.14.2. Member types</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>typedef Socket next_layer_type</code></dt>
<dd>
<p>The type of the underlying communication channel.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_member_functions_7">4.2.14.3. Member functions</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>basic_buffered_socket(boost::asio::io_service &amp;io_service)</code></dt>
<dd>
<p>Constructor. <em>io_service</em> is passed to the constructor from the underlying
stream.</p>
</dd>
<dt class="hdlist1"><code>template&lt;class&#8230;&#8203; Args&gt; basic_buffered_socket(Args&amp;&amp;&#8230;&#8203; args)</code></dt>
<dd>
<p>Constructor. <em>args</em> are forwarded to the constructor from the underlying
stream.</p>
</dd>
<dt class="hdlist1"><code>next_layer_type &amp;next_layer()</code></dt>
<dd>
<p>Returns a reference to the underlying stream.</p>
</dd>
<dt class="hdlist1"><code>const next_layer_type &amp;next_layer() const</code></dt>
<dd>
<p>Returns a reference to the underlying stream.</p>
</dd>
</dl>
</div>
<div class="sect5">
<h6 id="__code_socket_code_concept_2"><code>Socket</code> concept</h6>
<div class="paragraph">
<p>See the <a href="#socket_concept"><code>Socket</code> concept</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>asio::io_service&amp; get_io_service()</code></p>
</li>
<li>
<p><code>bool is_open() const</code></p>
</li>
<li>
<p><code>read_state read_state() const</code></p>
</li>
<li>
<p><code>write_state write_state() const</code></p>
</li>
<li>
<p><code>template&lt;class Message, class CompletionToken&gt;
typename boost::asio::async_result&lt;
    typename boost::asio::handler_type&lt;CompletionToken,
                                void(boost::system::error_code)&gt;::type&gt;::type
async_read_some(Message &amp;message, CompletionToken &amp;&amp;token)</code></p>
</li>
<li>
<p><code>template&lt;class Message, class CompletionToken&gt;
typename boost::asio::async_result&lt;
    typename boost::asio::handler_type&lt;CompletionToken,
                                void(boost::system::error_code)&gt;::type&gt;::type
async_read_trailers(Message &amp;message, CompletionToken &amp;&amp;token)</code></p>
</li>
<li>
<p><code>template&lt;class Message, class CompletionToken&gt;
typename boost::asio::async_result&lt;
    typename boost::asio::handler_type&lt;CompletionToken,
                                void(boost::system::error_code)&gt;::type&gt;::type
async_write(const Message &amp;message, CompletionToken &amp;&amp;token)</code></p>
</li>
<li>
<p><code>template&lt;class Message, class CompletionToken&gt;
typename boost::asio::async_result&lt;
    typename boost::asio::handler_type&lt;CompletionToken,
                                void(boost::system::error_code)&gt;::type&gt;::type
async_write_trailers(const Message &amp;message, CompletionToken &amp;&amp;token)</code></p>
</li>
<li>
<p><code>template&lt;class CompletionToken&gt;
typename boost::asio::async_result&lt;
    typename boost::asio::handler_type&lt;CompletionToken,
                                void(boost::system::error_code)&gt;::type&gt;::type
async_write_end_of_message(CompletionToken &amp;&amp;token)</code></p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="__code_serversocket_code_concept_2"><code>ServerSocket</code> concept</h6>
<div class="paragraph">
<p>See the <a href="#server_socket_concept"><code>ServerSocket</code> concept</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>bool write_response_native_stream() const</code></p>
</li>
<li>
<p><code>template&lt;class Request, class CompletionToken&gt;
typename boost::asio::async_result&lt;
    typename boost::asio::handler_type&lt;CompletionToken,
                                void(boost::system::error_code)&gt;::type&gt;::type
async_read_request(Request &amp;request, CompletionToken &amp;&amp;token)</code></p>
</li>
<li>
<p><code>template&lt;class Response, class CompletionToken&gt;
typename boost::asio::async_result&lt;
    typename boost::asio::handler_type&lt;CompletionToken,
                                void(boost::system::error_code)&gt;::type&gt;::type
async_write_response(const Response &amp;response, CompletionToken &amp;&amp;token)</code></p>
</li>
<li>
<p><code>template&lt;class CompletionToken&gt;
typename boost::asio::async_result&lt;
    typename boost::asio::handler_type&lt;CompletionToken,
                                void(boost::system::error_code)&gt;::type&gt;::type
async_write_response_continue(CompletionToken &amp;&amp;token)</code></p>
</li>
<li>
<p><code>template&lt;class Response, class CompletionToken&gt;
typename boost::asio::async_result&lt;
    typename boost::asio::handler_type&lt;CompletionToken,
                                void(boost::system::error_code)&gt;::type&gt;::type
async_write_response_metadata(const Response &amp;response,
                              CompletionToken &amp;&amp;token)</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="server_socket_adaptor">4.2.15. <code>server_socket_adaptor</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/server_socket_adaptor.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This class adapts a class fulfilling the <a href="#server_socket_concept"><code>ServerSocket</code>
concept</a> to implement the <a href="#basic_polymorphic_server_socket"><code>basic_polymorphic_server_socket&lt;Request, Response, Message&gt;</code></a> interface.</p>
</div>
<div class="paragraph">
<p>This design was chosen taking a number of shortcomings in consideration.</p>
</div>
<div class="paragraph">
<p>If the user can control object construction, he might benefit by less levels of
indirection by constructing both (the HTTP socket and its runtime-based
polymorphic adaptor) at once and at a single memory space.</p>
</div>
<div class="paragraph">
<p>The scenario where the user don&#8217;t control the object construction was also taken
in consideration. In these cases, it&#8217;s possible to use the
<code>std::reference_wrapper</code> type found in the <code>&lt;functional&gt;</code> header. There is a
<code>server_socket_adaptor</code> specialization that will do the job for
<code>std::reference_wrapper</code>.</p>
</div>
<div class="paragraph">
<p>Also, if the user needs to query for the specific type at runtime, the user can
do so with a single call to <code>dynamic_cast</code> to the specific polymorphic wrapper
(rather than calling a second function to query for the wrapped object).</p>
</div>
<div class="paragraph">
<p>The design is simple to use, to learn and to read. These values were chasen to
avoid misuse by the user&#8217;s part.</p>
</div>
<div class="paragraph">
<p>Although very different, the name and inspiration were borrowed from
<a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3525.pdf">N3525:
Polymorphic Allocators</a>.</p>
</div>
<div class="sect4">
<h5 id="_template_parameters_8">4.2.15.1. Template parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>Socket</code></dt>
<dd>
<p>The type to be wrapped.</p>
</dd>
<dt class="hdlist1"><code>Request = request</code></dt>
<dd>
<p>The request message type. Default argument is <a href="#request"><code>request</code></a>.</p>
</dd>
<dt class="hdlist1"><code>Response = response</code></dt>
<dd>
<p>The response message type. Default argument is <a href="#response"><code>response</code></a>.</p>
</dd>
<dt class="hdlist1"><code>Message = request_response_wrapper&lt;Request, Response&gt;</code></dt>
<dd>
<p>The message type. Default argument is <a href="#request_response_wrapper"><code>request_response_wrapper&lt;Request, Response&gt;</code></a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_specializations">4.2.15.2. Specializations</h5>
<div class="ulist">
<ul>
<li>
<p><code>server_socket_adaptor&lt;std::reference_wrapper&lt;Socket&gt;&gt;</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_member_types_8">4.2.15.3. Member types</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>typedef Socket next_layer_type</code></dt>
<dd>
<p>The type of the wrapped socket.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_member_functions_8">4.2.15.4. Member functions</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>template&lt;class&#8230;&#8203; Args&gt; server_socket_adaptor(Args&amp;&amp;&#8230;&#8203; args)</code></dt>
<dd>
<p>Constructor. <code>args</code> are forwarded to the underlying socket constructor.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Not available under the
<code>server_socket_adaptor&lt;std::reference_wrapper&lt;Socket&gt;&gt;</code> specialization.
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>server_socket_adaptor(Socket &amp;socket)</code></dt>
<dd>
<p>Constructor. <code>socket</code> is passed to the <code>std::reference_wrapper</code>
constructor.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Only available under the
<code>server_socket_adaptor&lt;std::reference_wrapper&lt;Socket&gt;&gt;</code> specialization.
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>next_layer_type &amp;next_layer()</code></dt>
<dd>
<p>Socket isn&#8217;t exposed directly to avoid confusion over the duplication of
interfaces.</p>
<div class="paragraph">
<p>The name socket is not used because both (the wrapped object and this object
itself) are sockets and it would be confusing.</p>
</div>
</dd>
<dt class="hdlist1"><code>const next_layer_type &amp;next_layer() const</code></dt>
<dd>
<p>Socket isn&#8217;t exposed directly to avoid confusion over the duplication of
interfaces.</p>
<div class="paragraph">
<p>The name socket is not used because both (the wrapped object and this object
itself) are sockets and it would be confusing.</p>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="header_to_ptime">4.2.16. <code>header_to_ptime</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/algorithm/header.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">StringRef</span><span class="tok-o">&gt;</span>
<span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">posix_time</span><span class="tok-o">::</span><span class="tok-n">ptime</span> <span class="tok-n">header_to_ptime</span><span class="tok-p">(</span><span class="tok-k">const</span> <span class="tok-n">StringRef</span> <span class="tok-o">&amp;</span><span class="tok-n">value</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Converts an <em>HTTP-date</em> <sup class="footnote">[<a id="_footnoteref_10" class="footnote" href="#_footnote_10" title="View footnote.">10</a>]</sup> field
value into <code>boost::posix_time::ptime</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Values containing extra whitespace at the beginning or at the end of
<em>value</em> will be rejected and no conversion will be done. This behaviour is
intentional.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_template_parameters_9">4.2.16.1. Template parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>StringRef</code></dt>
<dd>
<p>It MUST fulfill the requirements of the <code>StringRef</code> concept
(i.e. <code>boost::basic_string_ref</code>).</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_paremeters">4.2.16.2. Paremeters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>const StringRef &amp;value</code></dt>
<dd>
<p>An <em>HTTP-date</em>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_return_value">4.2.16.3. Return value</h5>
<div class="paragraph">
<p>The converted value if <em>value</em> is a valid <em>HTTP-date</em> or
<code>boost::posix_time::ptime(date_time::not_a_date_time)</code> otherwise.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
You can use <code>ptime&#8217;s `is_not_a_date_time()</code> member-function to check if
the conversion failed.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_see_also_10">4.2.16.4. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#to_http_date"><code>to_http_date</code></a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="to_http_date">4.2.17. <code>to_http_date</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/algorithm/header.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">String</span><span class="tok-o">&gt;</span>
<span class="tok-n">String</span> <span class="tok-n">to_http_date</span><span class="tok-p">(</span><span class="tok-k">const</span> <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">posix_time</span><span class="tok-o">::</span><span class="tok-n">ptime</span> <span class="tok-o">&amp;</span><span class="tok-n">datetime</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Converts a <code>boost::posix_time::ptime</code> into the preferred string representation
according to section 7.1.1.1 of RFC 7231 (i.e. fixed length/zone/capitalization
subset of the format defined in section 3.3 of RFC 5322).</p>
</div>
<div class="sect4">
<h5 id="_template_parameters_10">4.2.17.1. Template parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>String</code></dt>
<dd>
<p>It MUST fulfill the requirements of the <code>String</code> concept
(i.e. <code>std::basic_string</code>).</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_parameters">4.2.17.2. Parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>const boost::posix_time::ptime &amp;datetime</code></dt>
<dd>
<p>The timepoint to be converted. It MUST be in UTC timezone.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_return_value_2">4.2.17.3. Return value</h5>
<div class="paragraph">
<p>The string representation in the preferred format (a.k.a. <em>IMF-fixdate</em>).</p>
</div>
</div>
<div class="sect4">
<h5 id="_exceptions">4.2.17.4. Exceptions</h5>
<div class="ulist">
<ul>
<li>
<p><code>std::out_of_range</code>: If invalid <em>datetime</em> is given.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_see_also_11">4.2.17.5. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#header_to_ptime">header_to_ptime</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="header_value_all_of">4.2.18. <code>header_value_all_of</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/algorithm/header.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">StringRef</span><span class="tok-p">,</span> <span class="tok-k">class</span> <span class="tok-nc">Predicate</span><span class="tok-o">&gt;</span>
<span class="tok-kt">bool</span> <span class="tok-n">header_value_all_of</span><span class="tok-p">(</span><span class="tok-k">const</span> <span class="tok-n">StringRef</span> <span class="tok-o">&amp;</span><span class="tok-n">header_value</span><span class="tok-p">,</span> <span class="tok-k">const</span> <span class="tok-n">Predicate</span> <span class="tok-o">&amp;</span><span class="tok-n">p</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Checks if unary predicate <em>p</em> returns <code>true</code> for all elements from the
comma-separated list defined by the <em>header_value</em> HTTP field value.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This algorithm is liberal in what it accepts and it will skip invalid
elements. An invalid element is a sequence, possibly empty, containing no other
character than optional white space (i.e. <code>'\x20'</code> or <code>'\t'</code>).
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_template_parameters_11">4.2.18.1. Template parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>StringRef</code></dt>
<dd>
<p>It MUST fulfill the requirements of the <code>StringRef</code> concept
(i.e. <code>boost::basic_string_ref</code>).</p>
</dd>
<dt class="hdlist1"><code>Predicate</code></dt>
<dd>
<p>A type whose instances are callable and have the following signature:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-kt">bool</span><span class="tok-p">(</span><span class="tok-n">StringRef</span><span class="tok-p">)</span></code></pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_parameters_2">4.2.18.2. Parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>const StringRef &amp;header_value</code></dt>
<dd>
<p>The HTTP field value.</p>
</dd>
<dt class="hdlist1"><code>const Predicate &amp;p</code></dt>
<dd>
<p>The functor predicate that will be called for the elements found on the
comma-separated list.</p>
<div class="paragraph">
<p>Optional white space (only at the beginning and at the end) is trimmed before
applying the element to <em>p</em>.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_return_value_3">4.2.18.3. Return value</h5>
<div class="paragraph">
<p><code>true</code> if <em>p</em> doesn&#8217;t returns <code>false</code> for any element from the list and <code>false</code>
otherwise. This also means that you&#8217;ll get the return value <code>true</code> for empty
lists.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="header_value_any_of">4.2.19. <code>header_value_any_of</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/algorithm/header.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">StringRef</span><span class="tok-p">,</span> <span class="tok-k">class</span> <span class="tok-nc">Predicate</span><span class="tok-o">&gt;</span>
<span class="tok-kt">bool</span> <span class="tok-n">header_value_any_of</span><span class="tok-p">(</span><span class="tok-k">const</span> <span class="tok-n">StringRef</span> <span class="tok-o">&amp;</span><span class="tok-n">header_value</span><span class="tok-p">,</span> <span class="tok-k">const</span> <span class="tok-n">Predicate</span> <span class="tok-o">&amp;</span><span class="tok-n">p</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Checks if unary predicate <em>p</em> returns <code>true</code> for at least one element from the
comma-separated list defined by the <em>header_value</em> HTTP field value.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This algorithm is liberal in what it accepts and it will skip invalid
elements. An invalid element is a sequence, possibly empty, containing no other
character than optional white space (i.e. <code>'\x20'</code> or <code>'\t'</code>).
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_template_parameters_12">4.2.19.1. Template parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>StringRef</code></dt>
<dd>
<p>It MUST fulfill the requirements of the <code>StringRef</code> concept
(i.e. <code>boost::basic_string_ref</code>).</p>
</dd>
<dt class="hdlist1"><code>Predicate</code></dt>
<dd>
<p>A type whose instances are callable and have the following signature:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-kt">bool</span><span class="tok-p">(</span><span class="tok-n">StringRef</span><span class="tok-p">)</span></code></pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_parameters_3">4.2.19.2. Parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>const StringRef &amp;header_value</code></dt>
<dd>
<p>The HTTP field value.</p>
</dd>
<dt class="hdlist1"><code>const Predicate &amp;p</code></dt>
<dd>
<p>The functor predicate that will be called for the elements found on the
comma-separated list.</p>
<div class="paragraph">
<p>Optional white space (only at the beginning and at the end) is trimmed before
applying the element to <em>p</em>.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_return_value_4">4.2.19.3. Return value</h5>
<div class="paragraph">
<p><code>true</code> if the <em>p</em> returns <code>true</code> for at least one element from the list and
<code>false</code> otherwise. This also means that you&#8217;ll get the return value <code>false</code> for
empty lists.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="header_value_none_of">4.2.20. <code>header_value_none_of</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/algorithm/header.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">StringRef</span><span class="tok-p">,</span> <span class="tok-k">class</span> <span class="tok-nc">Predicate</span><span class="tok-o">&gt;</span>
<span class="tok-kt">bool</span> <span class="tok-n">header_value_none_of</span><span class="tok-p">(</span><span class="tok-k">const</span> <span class="tok-n">StringRef</span> <span class="tok-o">&amp;</span><span class="tok-n">header_value</span><span class="tok-p">,</span> <span class="tok-k">const</span> <span class="tok-n">Predicate</span> <span class="tok-o">&amp;</span><span class="tok-n">p</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Checks if unary predicate <em>p</em> returns <code>true</code> for no elements from the
comma-separated list defined by the <em>header_value</em> HTTP field value.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This algorithm is liberal in what it accepts and it will skip invalid
elements. An invalid element is a sequence, possibly empty, containing no other
character than optional white space (i.e. <code>'\x20'</code> or <code>'\t'</code>).
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_template_parameters_13">4.2.20.1. Template parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>StringRef</code></dt>
<dd>
<p>It MUST fulfill the requirements of the <code>StringRef</code> concept
(i.e. <code>boost::basic_string_ref</code>).</p>
</dd>
<dt class="hdlist1"><code>Predicate</code></dt>
<dd>
<p>A type whose instances are callable and have the following signature:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-kt">bool</span><span class="tok-p">(</span><span class="tok-n">StringRef</span><span class="tok-p">)</span></code></pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_parameters_4">4.2.20.2. Parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>const StringRef &amp;header_value</code></dt>
<dd>
<p>The HTTP field value.</p>
</dd>
<dt class="hdlist1"><code>const Predicate &amp;p</code></dt>
<dd>
<p>The functor predicate that will be called for the elements found on the
comma-separated list.</p>
<div class="paragraph">
<p>Optional white space (only at the beginning and at the end) is trimmed before
applying the element to <em>p</em>.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_return_value_5">4.2.20.3. Return value</h5>
<div class="paragraph">
<p><code>true</code> if <em>p</em> doesn&#8217;t returns <code>true</code> for any element from the list and <code>false</code>
otherwise. This also means that you&#8217;ll get the return value <code>true</code> for empty
lists.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="header_value_for_each">4.2.21. <code>header_value_for_each</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/algorithm/header.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">StringRef</span><span class="tok-p">,</span> <span class="tok-k">class</span> <span class="tok-nc">F</span><span class="tok-o">&gt;</span>
<span class="tok-n">F</span> <span class="tok-n">header_value_for_each</span><span class="tok-p">(</span><span class="tok-k">const</span> <span class="tok-n">StringRef</span> <span class="tok-o">&amp;</span><span class="tok-n">header_value</span><span class="tok-p">,</span> <span class="tok-n">F</span> <span class="tok-n">f</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Apply <em>f</em> for each element from the comma-separated list defined by the
<em>header_value</em> HTTP field value.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This algorithm is liberal in what it accepts and it will skip invalid
elements. An invalid element is a sequence, possibly empty, containing no other
character than optional white space (i.e. <code>'\x20'</code> or <code>'\t'</code>).
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_template_parameters_14">4.2.21.1. Template parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>StringRef</code></dt>
<dd>
<p>It MUST fulfill the requirements of the <code>StringRef</code> concept
(i.e. <code>boost::basic_string_ref</code>).</p>
</dd>
<dt class="hdlist1"><code>F</code></dt>
<dd>
<p>A type whose instances are callable and have the following signature:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-kt">void</span><span class="tok-p">(</span><span class="tok-n">StringRef</span><span class="tok-p">)</span></code></pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_parameters_5">4.2.21.2. Parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>const StringRef &amp;header_value</code></dt>
<dd>
<p>The HTTP field value.</p>
</dd>
<dt class="hdlist1"><code>F f</code></dt>
<dd>
<p>The functor that will be called for the elements found on the comma-separated
list.</p>
<div class="paragraph">
<p>Optional white space (only at the beginning and at the end) is trimmed before
applying the element to <em>f</em>.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_return_value_6">4.2.21.3. Return value</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">move</span><span class="tok-p">(</span><span class="tok-n">f</span><span class="tok-p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="etag_match_strong">4.2.22. <code>etag_match_strong</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/algorithm/header.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">StringRef</span><span class="tok-o">&gt;</span>
<span class="tok-kt">bool</span> <span class="tok-n">etag_match_strong</span><span class="tok-p">(</span><span class="tok-k">const</span> <span class="tok-n">StringRef</span> <span class="tok-o">&amp;</span><span class="tok-n">a</span><span class="tok-p">,</span> <span class="tok-k">const</span> <span class="tok-n">StringRef</span> <span class="tok-o">&amp;</span><span class="tok-n">b</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Check if <em>a</em> and <em>b</em> match.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This function doesn&#8217;t pedantically check if both arguments are actual entity
tags and you should validate at least one of the arguments yourself.</p>
</div>
<div class="paragraph">
<p>Builtin validation is only done enough to protect against attacks.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_template_parameters_15">4.2.22.1. Template parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>StringRef</code></dt>
<dd>
<p>It MUST fulfill the requirements of the <code>StringRef</code> concept
(i.e. <code>boost::basic_string_ref</code>).</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_parameters_6">4.2.22.2. Parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>const StringRef &amp;a</code></dt>
<dd>
<p>The entity tag to compare against <em>b</em>.</p>
</dd>
<dt class="hdlist1"><code>const StringRef &amp;b</code></dt>
<dd>
<p>The entity tag to compare against <em>a</em>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_return_value_7">4.2.22.3. Return value</h5>
<div class="paragraph">
<p><code>true</code> if the entity tags match, using the strong comparison <sup class="footnote">[<a id="_footnoteref_11" class="footnote" href="#_footnote_11" title="View footnote.">11</a>]</sup> or <code>false</code> otherwise.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="etag_match_weak">4.2.23. <code>etag_match_weak</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/algorithm/header.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">StringRef</span><span class="tok-o">&gt;</span>
<span class="tok-kt">bool</span> <span class="tok-n">etag_match_weak</span><span class="tok-p">(</span><span class="tok-k">const</span> <span class="tok-n">StringRef</span> <span class="tok-o">&amp;</span><span class="tok-n">a</span><span class="tok-p">,</span> <span class="tok-k">const</span> <span class="tok-n">StringRef</span> <span class="tok-o">&amp;</span><span class="tok-n">b</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Check if <em>a</em> and <em>b</em> match.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This function doesn&#8217;t pedantically check if both arguments are actual entity
tags and you should validate at least one of the arguments yourself.</p>
</div>
<div class="paragraph">
<p>Builtin validation is only done enough to protect against attacks.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_template_parameters_16">4.2.23.1. Template parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>StringRef</code></dt>
<dd>
<p>It MUST fulfill the requirements of the <code>StringRef</code> concept
(i.e. <code>boost::basic_string_ref</code>).</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_parameters_7">4.2.23.2. Parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>const StringRef &amp;a</code></dt>
<dd>
<p>The entity tag to compare against <em>b</em>.</p>
</dd>
<dt class="hdlist1"><code>const StringRef &amp;b</code></dt>
<dd>
<p>The entity tag to compare against <em>a</em>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_return_value_8">4.2.23.3. Return value</h5>
<div class="paragraph">
<p><code>true</code> if the entity tags match, using the weak comparison <sup class="footnote">[<a id="_footnoteref_12" class="footnote" href="#_footnote_12" title="View footnote.">12</a>]</sup> or <code>false</code> otherwise.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="request_continue_required">4.2.24. <code>request_continue_required</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/algorithm/query.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">Request</span><span class="tok-o">&gt;</span>
<span class="tok-kt">bool</span> <span class="tok-n">request_continue_required</span><span class="tok-p">(</span><span class="tok-k">const</span> <span class="tok-n">Request</span> <span class="tok-o">&amp;</span><span class="tok-n">request</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Check if the request represented by <em>request</em> requires a â100 (Continue)
responseâ <sup class="footnote">[<a id="_footnoteref_13" class="footnote" href="#_footnote_13" title="View footnote.">13</a>]</sup>.</p>
</div>
<div class="paragraph">
<p>If you can properly process and reply the message without its body, you&#8217;re free
to go. Otherwise, you should send a â100 (Continue) responseâ to ask for the
message body from the HTTP client.</p>
</div>
<div class="paragraph">
<p>This feature was designed to decrease network traffic, by allowing servers to
sooner reject messages that would be discarded anyway.</p>
</div>
<div class="paragraph">
<p>The name <em>required</em> is used instead <em>supported</em>, because an action from the
server is required.</p>
</div>
<div class="sect4">
<h5 id="_template_parameters_17">4.2.24.1. Template parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>Request</code></dt>
<dd>
<p>A type fulfilling the requirements for the <a href="#request_concept"><code>Request</code>
concept</a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_parameters_8">4.2.24.2. Parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>const Request &amp;request</code></dt>
<dd>
<p>The read message.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_return_value_9">4.2.24.3. Return value</h5>
<div class="paragraph">
<p>Whether the request represented by <em>request</em> requires a â100 (Continue)
responseâ.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="request_upgrade_desired">4.2.25. <code>request_upgrade_desired</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/algorithm/query.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">Request</span><span class="tok-p">,</span>
         <span class="tok-k">class</span> <span class="tok-nc">StringRef</span> <span class="tok-o">=</span> <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">basic_string_ref</span><span class="tok-o">&lt;</span>
             <span class="tok-k">typename</span> <span class="tok-n">Request</span><span class="tok-o">::</span><span class="tok-n">headers_type</span><span class="tok-o">::</span><span class="tok-n">mapped_type</span><span class="tok-o">::</span><span class="tok-n">value_type</span><span class="tok-o">&gt;&gt;</span>
<span class="tok-kt">bool</span> <span class="tok-n">request_upgrade_desired</span><span class="tok-p">(</span><span class="tok-k">const</span> <span class="tok-n">Request</span> <span class="tok-o">&amp;</span><span class="tok-n">request</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Check if the client desires to initiate a protocol upgrade.</p>
</div>
<div class="paragraph">
<p>The desired protocols are present in the <code>"upgrade"</code> header as a comma-separated
list.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
You MUST <strong>NOT</strong> upgrade to a protocol listed in the <code>"upgrade"</code> header
if this function returns <code>false</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The upgrade desire can always be safely ignored.</p>
</div>
<div class="paragraph">
<p>The user MUST wait till the whole request is received before proceeding to the
protocol upgrade.</p>
</div>
<div class="sect4">
<h5 id="_template_parameters_18">4.2.25.1. Template parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>Request</code></dt>
<dd>
<p>A type fulfilling the requirements for the <a href="#request_concept"><code>Request</code>
concept</a>.</p>
</dd>
<dt class="hdlist1"><code>StringRef</code></dt>
<dd>
<p>A type fulfilling the requirements for the <code>StringRef</code> concept
(i.e. <code>boost::basic_string_ref</code>).</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_parameters_9">4.2.25.2. Parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>const Request &amp;request</code></dt>
<dd>
<p>The read message.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_return_value_10">4.2.25.3. Return value</h5>
<div class="paragraph">
<p>Whether the client desires to initiate a protocol upgrade.</p>
</div>
</div>
<div class="sect4">
<h5 id="_see_also_12">4.2.25.4. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#header_value_any_of"><code>header_value_any_of</code></a></p>
</li>
<li>
<p><a href="#header_value_for_each"><code>header_value_for_each</code></a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="async_response_transmit_file">4.2.26. <code>async_response_transmit_file</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/file_server.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This function has two overloads.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">ServerSocket</span><span class="tok-p">,</span> <span class="tok-k">class</span> <span class="tok-nc">Request</span><span class="tok-p">,</span> <span class="tok-k">class</span> <span class="tok-nc">Response</span><span class="tok-p">,</span>
         <span class="tok-k">class</span> <span class="tok-nc">CompletionToken</span><span class="tok-o">&gt;</span>
<span class="tok-k">typename</span> <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">async_result</span><span class="tok-o">&lt;</span>
    <span class="tok-k">typename</span> <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">handler_type</span><span class="tok-o">&lt;</span><span class="tok-n">CompletionToken</span><span class="tok-p">,</span>
                                <span class="tok-kt">void</span><span class="tok-p">(</span><span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">system</span><span class="tok-o">::</span><span class="tok-n">error_code</span><span class="tok-p">)</span><span class="tok-o">&gt;::</span><span class="tok-n">type</span><span class="tok-o">&gt;::</span><span class="tok-n">type</span>
<span class="tok-n">async_response_transmit_file</span><span class="tok-p">(</span><span class="tok-n">ServerSocket</span> <span class="tok-o">&amp;</span><span class="tok-n">socket</span><span class="tok-p">,</span> <span class="tok-k">const</span> <span class="tok-n">Request</span> <span class="tok-o">&amp;</span><span class="tok-n">imessage</span><span class="tok-p">,</span>
                             <span class="tok-n">Response</span> <span class="tok-o">&amp;</span><span class="tok-n">omessage</span><span class="tok-p">,</span>
                             <span class="tok-k">const</span> <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">filesystem</span><span class="tok-o">::</span><span class="tok-n">path</span> <span class="tok-o">&amp;</span><span class="tok-n">file</span><span class="tok-p">,</span>
                             <span class="tok-n">CompletionToken</span> <span class="tok-o">&amp;&amp;</span><span class="tok-n">token</span><span class="tok-p">);</span> <span class="tok-c1">// (1)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">ServerSocket</span><span class="tok-p">,</span> <span class="tok-k">class</span> <span class="tok-nc">Request</span><span class="tok-p">,</span> <span class="tok-k">class</span> <span class="tok-nc">Response</span><span class="tok-p">,</span>
         <span class="tok-k">class</span> <span class="tok-nc">CompletionToken</span><span class="tok-o">&gt;</span>
<span class="tok-k">typename</span> <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">async_result</span><span class="tok-o">&lt;</span>
    <span class="tok-k">typename</span> <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">handler_type</span><span class="tok-o">&lt;</span><span class="tok-n">CompletionToken</span><span class="tok-p">,</span>
                                <span class="tok-kt">void</span><span class="tok-p">(</span><span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">system</span><span class="tok-o">::</span><span class="tok-n">error_code</span><span class="tok-p">)</span><span class="tok-o">&gt;::</span><span class="tok-n">type</span><span class="tok-o">&gt;::</span><span class="tok-n">type</span>
<span class="tok-n">async_response_transmit_file</span><span class="tok-p">(</span><span class="tok-n">ServerSocket</span> <span class="tok-o">&amp;</span><span class="tok-n">socket</span><span class="tok-p">,</span> <span class="tok-k">const</span> <span class="tok-n">Request</span> <span class="tok-o">&amp;</span><span class="tok-n">imessage</span><span class="tok-p">,</span>
                             <span class="tok-n">Response</span> <span class="tok-o">&amp;</span><span class="tok-n">omessage</span><span class="tok-p">,</span>
                             <span class="tok-k">const</span> <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">filesystem</span><span class="tok-o">::</span><span class="tok-n">path</span> <span class="tok-o">&amp;</span><span class="tok-n">file</span><span class="tok-p">,</span>
                             <span class="tok-kt">bool</span> <span class="tok-n">is_head_request</span><span class="tok-p">,</span>
                             <span class="tok-n">CompletionToken</span> <span class="tok-o">&amp;&amp;</span><span class="tok-n">token</span><span class="tok-p">);</span> <span class="tok-c1">// (2)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This function will handle a big part of the file serving job for you, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It&#8217;ll interpret and process the request headers. However, it doesn&#8217;t process
the request method nor the the input path. This means you still have to
guarantee the method is applicable and you&#8217;re also expected to resolve the
input path to a valid local file path.</p>
</li>
<li>
<p>It&#8217;ll fill all the applicable response headers appropriate to the request.</p>
</li>
<li>
<p>It&#8217;ll interpret the file attributes to process conditional requests and
partial download. However, MIME detection (the <code>"content-type"</code> optional
header) is still left for the user to handle.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Summarizing your responsibilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure it is a <code>"GET"</code> method or a method with similar semantics before
calling this function. <em>Overload 2</em> also accepts the <code>"HEAD"</code> method.</p>
</li>
<li>
<p>Resolve the input URL to the appropriate file.</p>
</li>
<li>
<p><strong>Optional</strong>: MIME detection (the <code>"content-type"</code> header).</p>
</li>
<li>
<p><strong>Optional</strong>: <code>ETag</code> detection (see
<a href="#async_response_transmit_file_etag">below</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A method with semantics similar to the <code>"GET"</code> method is any method fulfilling
the following conditions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The body data payload for the response message is compatible.</p>
</li>
<li>
<p>The following headers for the request message have the same meaning:</p>
<div class="ulist">
<ul>
<li>
<p><code>"if-modified-since"</code></p>
</li>
<li>
<p><code>"if-range"</code></p>
</li>
<li>
<p><code>"if-unmodified-since"</code></p>
</li>
<li>
<p><code>"range"</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>The following headers for the response message have the same meaning or don&#8217;t
affect the message processing:</p>
<div class="ulist">
<ul>
<li>
<p><code>"accept-ranges"</code></p>
</li>
<li>
<p><code>"content-range"</code></p>
</li>
<li>
<p><code>"content-type"</code></p>
</li>
<li>
<p><code>"date"</code></p>
</li>
<li>
<p><code>"last-modified"</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>The same set of status code for the response are applicable.</p>
<div class="ulist">
<ul>
<li>
<p><code>"200 OK"</code></p>
</li>
<li>
<p><code>"206 Partial Content"</code></p>
</li>
<li>
<p><code>"304 Not Modified"</code></p>
</li>
<li>
<p><code>"412 Precondition Failed"</code></p>
</li>
<li>
<p><code>"416 Range Not Satisfiable"</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This function will call the handler with <code>file_server_errc::io_error</code> if
any operation on the <strong>file stream</strong> fails or throws an exception.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The response headers filled by this function MUST NOT be sent through
trailers. Therefore, this function will not do any operation and it will call
the handler with an <code>error_code</code> (<code>file_server_errc::write_state_not_supported</code>)
set if you pass a socket for which the headers were already sent.
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph">
<p>async_response_transmit_file will make use of the streaming interface only if
available.</p>
</div>
<div class="paragraph">
<p>If you want to avoid wasting memory under HTTP/1.0 and other non-streaming
capable channels, starting points for two solutions are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reject channels without a streaming interface (e.g. HTTP/1.0). RFC 2068
(a.k.a.  HTTP/1.1) has been available since January 1997.</p>
</li>
<li>
<p>Write a custom message type that adapts the filestream to the message concept
and specialize the algorithm for such message.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>omessage.body()</code> will be used as output buffer. If
<code>omessage.body().capacity() == 0</code>, an unspecified buffer size will be used and
it is very likely it&#8217;ll be highly inefficient.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="async_response_transmit_file_etag">4.2.26.1. ETags</h5>
<div class="paragraph">
<p>An ETag is a string that identify a representation of a resource. The ETag can
be used to perform conditional requests more robust than the ones done with
dates (limited by HTTP to seconds-based precision). In the conditional request
context, an etag is a validator.</p>
</div>
<div class="paragraph">
<p>If you want to make use of the ETag implementation, just set the <code>"etag"</code> header
in the <code>omessage</code> object to the appropriate value, as described below (also
described in more details in RFC7232).</p>
</div>
<div class="paragraph">
<p>The first decision you must do if you decide to provide an etag is if you&#8217;re
going to provide a strong validator or a weak validator.</p>
</div>
<div class="sect5">
<h6 id="_strong_validators">Strong validators</h6>
<div class="paragraph">
<p>A strong validator changes whenever a change occurs to the representation data
that would be observable in the payload body. A strong validator is unique
across all versions of all representations associated with a particular resource
over time.</p>
</div>
<div class="paragraph">
<p>A strong etag has the form (specified in Augmented Backus-Naur Form (ABNF)
notation of [RFC5234]):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>strong-etag = DQUOTE *etagc DQUOTE
etagc       = %x21 / %x23-7E / obs-text
            ; VCHAR except double quotes, plus obs-text
obs-text    = %x80-FF</pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
Some recipients might perform backslash unescaping. Therefore, it is a
good practice to avoid backslash characters.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Some examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>"xyasdzzy"</code></p>
</li>
<li>
<p><code>"xyz9czy"</code></p>
</li>
<li>
<p><code>""</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
A strong validator might change for reasons other than a change to the
representation data.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
There is no implication of uniqueness across representations of different
resources.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_weak_validators">Weak validators</h6>
<div class="paragraph">
<p>A weak validator might not change for every change to the representation data.</p>
</div>
<div class="paragraph">
<p>A weak etag has the form (specified in Augmented Backus-Naur Form (ABNF)
notation of [RFC5234]):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>weak-etag  = weak opaque-tag
weak       = %x57.2F ; "W/", case-sensitive
opaque-tag = DQUOTE *etagc DQUOTE
etagc      = %x21 / %x23-7E / obs-text
           ; VCHAR except double quotes, plus obs-text
obs-text   = %x80-FF</pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
Some recipients might perform backslash unescaping. Therefore, it is a
good practice to avoid backslash characters.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Some examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>W/"xyasdzzy"</code></p>
</li>
<li>
<p><code>W/"xyz9czy"</code></p>
</li>
<li>
<p><code>W/""</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_template_parameters_19">4.2.26.2. Template parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ServerSocket</code></dt>
<dd>
<p>Must fulfill the requirements for the <a href="#server_socket_concept"><code>ServerSocket
concept</code></a>.</p>
</dd>
<dt class="hdlist1"><code>Request</code></dt>
<dd>
<p>Must fulfill the requirements for the <a href="#request_concept"><code>Request</code> concept</a>.</p>
</dd>
<dt class="hdlist1"><code>Response</code></dt>
<dd>
<p>Must fulfill the requirements for the <a href="#response_concept"><code>Response</code> concept</a>.</p>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph">
<p><code>Response::body_type</code> MUST fulfill the following extra requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Its elements MUST be stored contiguously (e.g. <code>std::vector</code>).</p>
</li>
<li>
<p>It MUST support C++11 <code>std::vector</code> capicity and data semantics
(<em>vector.capacity</em> and <em>vector.data</em>, respectively).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These extra requirements are posed because file APIs are defined in terms of
buffer <sup class="footnote">[<a id="_footnoteref_14" class="footnote" href="#_footnote_14" title="View footnote.">14</a>]</sup> operations.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>CompletionToken</code></dt>
<dd>
<p>Must fulfill the ASIO requirements for a completion token.</p>
<div class="paragraph">
<p>The used handler signature is <code>void(boost::system::error_code)</code>.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_parameters_10">4.2.26.3. Parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ServerSocket &amp;socket</code></dt>
<dd>
<p>The socket associated with the <em>imessage</em> and <em>omessage</em> that will be used for
the response.</p>
</dd>
<dt class="hdlist1"><code>const Request &amp;imessage</code></dt>
<dd>
<p>The request message received.</p>
</dd>
<dt class="hdlist1"><code>Response &amp;omessage</code></dt>
<dd>
<p>The message object that should be used to reply the message.</p>
<div class="paragraph">
<p>The user might be interested in filling some extra headers here like
<code>"content-type"</code> or cache policies.</p>
</div>
</dd>
<dt class="hdlist1"><code>const filesystem::path &amp;file</code></dt>
<dd>
<p>The requested file that should be transmitted.</p>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
If you cannot guarantee the <em>file</em> did not change twice during the
second covered by the last write time, you should remove all <code>"range"</code> and
<code>"if-range"</code> headers from <em>imessage</em> before calling this function. It&#8217;s possible
to construct a more robust file server by making use of system-level APIs that
can provide unique identifiers for file revisions.
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>bool is_head_request</code></dt>
<dd>
<p>Whether the request was made with a <code>"HEAD"</code> method.</p>
<div class="paragraph">
<p>If the received request isn&#8217;t <code>"GET"</code> nor <code>"HEAD"</code>, you MAY remove all <code>"range"</code>
and <code>"if-range"</code> headers and pass the value <code>false</code> to this argument.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Available only for <em>overload 2</em>.
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>CompletionToken &amp;&amp;token</code></dt>
<dd>
<p>The token from which the handler and the return value are extracted.</p>
<div class="paragraph">
<p>The extracted handler is called when the operation completes.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_return_value_11">4.2.26.4. Return value</h5>
<div class="paragraph">
<p>Extracted using <em>token</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_see_also_13">4.2.26.5. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#file_server_errc">file_server_errc</a></p>
</li>
<li>
<p><a href="#async_response_transmit_dir">async_response_transmit_dir</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="async_response_transmit_dir">4.2.27. <code>async_response_transmit_dir</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/file_server.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This function has two overloads.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">ServerSocket</span><span class="tok-p">,</span> <span class="tok-k">class</span> <span class="tok-nc">ConvertibleToPath</span><span class="tok-p">,</span> <span class="tok-k">class</span> <span class="tok-nc">Request</span><span class="tok-p">,</span>
         <span class="tok-k">class</span> <span class="tok-nc">Response</span><span class="tok-p">,</span> <span class="tok-k">class</span> <span class="tok-nc">CompletionToken</span><span class="tok-o">&gt;</span>
<span class="tok-k">typename</span> <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">async_result</span><span class="tok-o">&lt;</span>
    <span class="tok-k">typename</span> <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">handler_type</span><span class="tok-o">&lt;</span><span class="tok-n">CompletionToken</span><span class="tok-p">,</span>
                                <span class="tok-kt">void</span><span class="tok-p">(</span><span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">system</span><span class="tok-o">::</span><span class="tok-n">error_code</span><span class="tok-p">)</span><span class="tok-o">&gt;::</span><span class="tok-n">type</span><span class="tok-o">&gt;::</span><span class="tok-n">type</span>
<span class="tok-n">async_response_transmit_dir</span><span class="tok-p">(</span><span class="tok-n">ServerSocket</span> <span class="tok-o">&amp;</span><span class="tok-n">socket</span><span class="tok-p">,</span>
                            <span class="tok-k">const</span> <span class="tok-n">ConvertibleToPath</span> <span class="tok-o">&amp;</span><span class="tok-n">ipath</span><span class="tok-p">,</span>
                            <span class="tok-k">const</span> <span class="tok-n">Request</span> <span class="tok-o">&amp;</span><span class="tok-n">imessage</span><span class="tok-p">,</span> <span class="tok-n">Response</span> <span class="tok-o">&amp;</span><span class="tok-n">omessage</span><span class="tok-p">,</span>
                            <span class="tok-k">const</span> <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">filesystem</span><span class="tok-o">::</span><span class="tok-n">path</span> <span class="tok-o">&amp;</span><span class="tok-n">root_dir</span><span class="tok-p">,</span>
                            <span class="tok-n">CompletionToken</span> <span class="tok-o">&amp;&amp;</span><span class="tok-n">token</span><span class="tok-p">);</span> <span class="tok-c1">// (1)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">ServerSocket</span><span class="tok-p">,</span> <span class="tok-k">class</span> <span class="tok-nc">ConvertibleToPath</span><span class="tok-p">,</span> <span class="tok-k">class</span> <span class="tok-nc">Request</span><span class="tok-p">,</span>
         <span class="tok-k">class</span> <span class="tok-nc">Response</span><span class="tok-p">,</span> <span class="tok-k">class</span> <span class="tok-nc">Predicate</span><span class="tok-p">,</span> <span class="tok-k">class</span> <span class="tok-nc">CompletionToken</span><span class="tok-o">&gt;</span>
<span class="tok-k">typename</span> <span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">async_result</span><span class="tok-o">&lt;</span>
    <span class="tok-k">typename</span> <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">handler_type</span><span class="tok-o">&lt;</span><span class="tok-n">CompletionToken</span><span class="tok-p">,</span>
                                <span class="tok-kt">void</span><span class="tok-p">(</span><span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">system</span><span class="tok-o">::</span><span class="tok-n">error_code</span><span class="tok-p">)</span><span class="tok-o">&gt;::</span><span class="tok-n">type</span><span class="tok-o">&gt;::</span><span class="tok-n">type</span>
<span class="tok-n">async_response_transmit_dir</span><span class="tok-p">(</span><span class="tok-n">ServerSocket</span> <span class="tok-o">&amp;</span><span class="tok-n">socket</span><span class="tok-p">,</span>
                            <span class="tok-k">const</span> <span class="tok-n">ConvertibleToPath</span> <span class="tok-o">&amp;</span><span class="tok-n">ipath</span><span class="tok-p">,</span>
                            <span class="tok-k">const</span> <span class="tok-n">Request</span> <span class="tok-o">&amp;</span><span class="tok-n">imessage</span><span class="tok-p">,</span> <span class="tok-n">Response</span> <span class="tok-o">&amp;</span><span class="tok-n">omessage</span><span class="tok-p">,</span>
                            <span class="tok-k">const</span> <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">filesystem</span><span class="tok-o">::</span><span class="tok-n">path</span> <span class="tok-o">&amp;</span><span class="tok-n">root_dir</span><span class="tok-p">,</span>
                            <span class="tok-n">Predicate</span> <span class="tok-n">filter</span><span class="tok-p">,</span> <span class="tok-n">CompletionToken</span> <span class="tok-o">&amp;&amp;</span><span class="tok-n">token</span><span class="tok-p">);</span> <span class="tok-c1">// (2)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This function does a lot more than just sending bytes. It carries the
responsibilities from <a href="#async_response_transmit_file"><code>async_response_transmit_file</code></a>, but add a few more of its own:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It&#8217;ll also handle the HTTP method.</p>
</li>
<li>
<p>It&#8217;ll also handle the file resolution. It does so with respect to the given
<em>root_dir</em> argument.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The only feature missing is mime support (<code>"content-type"</code> header). It cannot be
done reliably within this abstraction.</p>
</div>
<div class="paragraph">
<p>This function will handle even the start line and the only acceptable
<code>write_state</code> is <code>empty</code>. It&#8217;ll fail on any other <code>write_state</code>.</p>
</div>
<div class="paragraph">
<p>All urls are absolute, but are absolute with respect to the given
<em>root_dir</em>. This interface provides no means to disable this security check. If
the user needs that much complex logic, then it should write its own path
resolving solution and use <a href="#async_response_transmit_file"><code>async_response_transmit_file</code></a>.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
This function will call the handler with
<code>file_server_category::file_not_found</code> if the requested file, with respect to
the given <em>root_dir</em>, cannot be found. The channel remains untouched in this
case, giving the user the opportunity to send custom 404 messages.
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
This function will call the handler with
<code>file_server_category::file_type_not_supported</code> if resolution finishes but this
function cannot process the result because the file is not regular (directories,
block devices&#8230;&#8203;). The channel is also left untouched, giving the user the
opportunity to use another HTTP consumer.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_template_parameters_20">4.2.27.1. Template parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ServerSocket</code></dt>
<dd>
<p>Must fulfill the requirements for the <a href="#server_socket_concept"><code>ServerSocket</code>
concept</a>.</p>
</dd>
<dt class="hdlist1"><code>ConvertibleToPath</code></dt>
<dd>
<p>A type whose instances can be used to construct a <code>boost::filesystem::path</code>
object.</p>
</dd>
<dt class="hdlist1"><code>Request</code></dt>
<dd>
<p>Must fulfill the requirements for the <a href="#request_concept"><code>Request</code> concept</a>.</p>
</dd>
<dt class="hdlist1"><code>Response</code></dt>
<dd>
<p>Must fulfill the requirements for the <a href="#response_concept"><code>Response</code> concept</a>.</p>
</dd>
<dt class="hdlist1"><code>Predicate</code></dt>
<dd>
<p>A type whose instances are callable and have the following signature:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-kt">bool</span><span class="tok-p">(</span><span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">filesystem</span><span class="tok-o">::</span><span class="tok-n">path</span> <span class="tok-o">&amp;</span><span class="tok-n">resolved_path</span><span class="tok-p">)</span></code></pre>
</div>
</div>
</dd>
<dt class="hdlist1"><code>CompletionToken</code></dt>
<dd>
<p>Must fulfill the ASIO requirements for a completion token.</p>
<div class="paragraph">
<p>The used handler signature is <code>void(boost::system::error_code)</code>.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_parameters_11">4.2.27.2. Parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ServerSocket &amp;socket</code></dt>
<dd>
<p>The socket associated with the <em>imessage</em> and <em>omessage</em> that will be used for
the response.</p>
</dd>
<dt class="hdlist1"><code>const ConvertibleToPath &amp;ipath</code></dt>
<dd>
<p><em>ipath</em> (standing for input path) is the <strong>parsed path</strong> from the requested url.</p>
<div class="paragraph">
<p>It&#8217;s guaranteed that it&#8217;ll only be used to construct a <code>boost::filesystem::path</code>
object. Thus, the user can fake the requested path to force an <em>internal
redirect</em>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
This is the input <strong>path component</strong>, not the input URL. Therefore, you
MUST parse the input url before dispatching it to this function and only the
path component must be forwarded. Extracting the path is an extra responsibility
for the user, but it is an useful abstraction for scenarios where the user
doesn&#8217;t control the served root dir. Thanks to the security check, this
<em>internal redirect</em> trick doesn&#8217;t work for files outside the <em>root_dir</em>.
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>const Request &amp;imessage</code></dt>
<dd>
<p>The request message received.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Any request method is acceptable, but any method other than <code>"GET"</code> and
<code>"HEAD"</code> will be responded with <code>"405 Method Not Allowed"</code>.
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>Response &amp;omessage</code></dt>
<dd>
<p>The message object that should be used to reply the message.</p>
<div class="paragraph">
<p>The user might be interested in filling some extra headers here like
<code>"content-type"</code> or cache policies.</p>
</div>
</dd>
<dt class="hdlist1"><code>const boost::filesystem::path &amp;root_dir</code></dt>
<dd>
<p>The dir to be interpreted as the root dir of requested files.</p>
</dd>
<dt class="hdlist1"><code>Predicate filter</code></dt>
<dd>
<p>It is applied to the resolved path as the last step before proceeding to file
and network operations.</p>
<div class="paragraph">
<p>If filter returns <code>false</code>, the functions finishes before touching the channel,
with the error_code <code>file_server_category::filter_set</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
It&#8217;s possible to use a stateful non-pure <em>filter</em> to add response headers
and properly process mime types (content-type header).
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<em>filter</em> can also be used to redirect files by modifying the input arg.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This function might throw if <em>filter</em> throws. In this case, we provide the
basic exception guarantee.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Available only for <em>overload 2</em>.
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>CompletionToken &amp;&amp;token</code></dt>
<dd>
<p>The token from which the handler and the return value are extracted.</p>
<div class="paragraph">
<p>The extracted handler is called when the operation completes.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_return_value_12">4.2.27.3. Return value</h5>
<div class="paragraph">
<p>Extracted using <em>token</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_see_also_14">4.2.27.4. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#file_server_errc"><code>file_server_errc</code></a></p>
</li>
<li>
<p><a href="#async_response_transmit_file"><code>async_response_transmit_file</code></a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="read_state">4.2.28. <code>read_state</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/read_state.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">enum</span> <span class="tok-k">class</span> <span class="tok-nc">read_state</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="read_state.svg" alt="read state">
</div>
</div>
<div class="paragraph">
<p>Represents the current state in the HTTP incoming request or HTTP incoming
response.</p>
</div>
<div class="paragraph">
<p>Be prepared to face multiple state changes after a single action is scheduled
(e.g. you issue <code>receive_message</code> action and the state already changed to empty
when the handler is invoked). However, the message producer (e.g. the embedded
server) is not allowed to change the state from <code>empty</code> to <code>request_ready</code>
without another iteraction from the library user.</p>
</div>
<div class="sect4">
<h5 id="_member_constants">4.2.28.1. Member constants</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>empty</code></dt>
<dd>
<p>This is the initial state.</p>
<div class="paragraph">
<p>There are two ways to interpret this state. It might mean that the request
object wasn&#8217;t used/read yet.</p>
</div>
<div class="paragraph">
<p>Another interpretation is that it was reached from the <code>body_ready</code> state, after
all trailers have been received. It&#8217;s safe to assume that all message data is
available if this is the case.</p>
</div>
<div class="paragraph">
<p>An easy to interpret this state is that it is complete for the previous message
and empty for the next one.</p>
</div>
<div class="paragraph">
<p>At this state, you can only issue a <code>receive_message</code> action.</p>
</div>
</dd>
<dt class="hdlist1"><code>message_ready</code></dt>
<dd>
<p>This state is reached from the <code>empty</code> state, once you ask for a new request.</p>
<div class="paragraph">
<p>No more <code>receive_message</code> actions can be issued from this state.</p>
</div>
<div class="paragraph">
<p>From this state, you can issue the <code>receive_some_body</code> action. The state will
change to <code>body_ready</code> once all body was read. In streaming connections
(e.g. HTTP/1.1 chunked entities), this condition (body fully received) might
never happen.</p>
</div>
<div class="paragraph">
<p>Once this state is reached, you can safely read the first line and the headers.</p>
</div>
</dd>
<dt class="hdlist1"><code>body_ready</code></dt>
<dd>
<p>This state is reached from the <code>request_ready</code>, once the http producer
(e.g. embedded server) fully received the message body.</p>
<div class="paragraph">
<p>From this state, you can only issue the <code>receive_trailers</code> action.</p>
</div>
<div class="paragraph">
<p>Once this state is reached, you can safely assume that no more body parts will
be received.</p>
</div>
</dd>
<dt class="hdlist1"><code>finished</code></dt>
<dd>
<p>Only possible in incoming response mode. It means the message is complete and
you can no longer issue another <code>receive_message</code> until something else is done
(e.g. send another http request). This is a different/special value, because
the âsomething else to doâ might not be related to read actions.</p>
<div class="paragraph">
<p>It can be reached from <code>body_ready</code> state, after all trailers have been
received. It&#8217;s safe to assume that all message data is available at the time
this state is reached.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_see_also_15">4.2.28.2. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#write_state"><code>write_state</code></a></p>
</li>
<li>
<p><a href="#socket_concept"><code>Socket</code></a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="write_state">4.2.29. <code>write_state</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/write_state.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">enum</span> <span class="tok-k">class</span> <span class="tok-nc">write_state</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="write_state.svg" alt="write state">
</div>
</div>
<div class="paragraph">
<p>Represents the current state in the HTTP outgoing response or HTTP outgoing
request.</p>
</div>
<div class="paragraph">
<p>It has extra values that won&#8217;t be used in âoutgoing-requestâ mode.  Explanation
focuses in âoutgoing-responseâ mode.</p>
</div>
<div class="sect4">
<h5 id="_member_constants_2">4.2.29.1. Member constants</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>empty</code></dt>
<dd>
<p>This is the initial state.</p>
<div class="paragraph">
<p>It means that the response object wasn&#8217;t used yet.</p>
</div>
<div class="paragraph">
<p>At this state, you can only issue the metadata or issue a continue action, if
continue is supported/used in this HTTP session. Even if continue was requested,
issue a continue action is optional and only required if you need the request&#8217;s
body.</p>
</div>
</dd>
<dt class="hdlist1"><code>continue_issued</code></dt>
<dd>
<p>This state is reached from the <code>empty</code> state, once you issue a continue
action.</p>
<div class="paragraph">
<p>No more continue actions can be issued from this state.</p>
</div>
<div class="paragraph">
<p>Only makes sense in server mode, when issuing an outgoing response.</p>
</div>
</dd>
<dt class="hdlist1"><code>metadata_issued</code></dt>
<dd>
<p>This state can be reached either from <code>empty</code> or <code>continue_issued</code>.</p>
<div class="paragraph">
<p>It happens when the metadata (start line + header section) is reached (through
<code>write_metadata</code>).</p>
</div>
<div class="paragraph">
<p>From this state, you can only issue the body, the trailers or the end of the
message.</p>
</div>
</dd>
<dt class="hdlist1"><code>finished</code></dt>
<dd>
<p>The message is considered complete once this state is reached.</p>
<div class="paragraph">
<p>You can no longer issue anything once this state is reached. The underlying
channel will change the outgoing_state once some unspecified event occurs. This
event is usually a new request in server mode or the response fully received in
client mode.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_see_also_16">4.2.29.2. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#read_state"><code>read_state</code></a></p>
</li>
<li>
<p><a href="#socket_concept"><code>Socket</code></a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="status_code">4.2.30. <code>status_code</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/status_code.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">enum</span> <span class="tok-k">class</span> <span class="tok-nc">status_code</span><span class="tok-o">:</span> <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-kt">uint_fast16_t</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This scoped enumeration defines the values for the
<a href="http://www.iana.org/assignments/http-status-codes/http-status-codes.xhtml">
âHypertext Transfer Protocol (HTTP) Status Code Registryâ</a>.</p>
</div>
<div class="sect4">
<h5 id="_member_constants_3">4.2.30.1. Member constants</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>continue_request</code></dt>
<dd>
<p><code>100</code></p>
</dd>
<dt class="hdlist1"><code>switching_protocols</code></dt>
<dd>
<p><code>101</code></p>
</dd>
<dt class="hdlist1"><code>processing</code></dt>
<dd>
<p><code>102</code></p>
</dd>
<dt class="hdlist1"><code>ok</code></dt>
<dd>
<p><code>200</code></p>
</dd>
<dt class="hdlist1"><code>created</code></dt>
<dd>
<p><code>201</code></p>
</dd>
<dt class="hdlist1"><code>accepted</code></dt>
<dd>
<p><code>202</code></p>
</dd>
<dt class="hdlist1"><code>non_authoritative_information</code></dt>
<dd>
<p><code>203</code></p>
</dd>
<dt class="hdlist1"><code>no_content</code></dt>
<dd>
<p><code>204</code></p>
</dd>
<dt class="hdlist1"><code>reset_content</code></dt>
<dd>
<p><code>205</code></p>
</dd>
<dt class="hdlist1"><code>partial_content</code></dt>
<dd>
<p><code>206</code></p>
</dd>
<dt class="hdlist1"><code>multi_status</code></dt>
<dd>
<p><code>207</code></p>
</dd>
<dt class="hdlist1"><code>already_reported</code></dt>
<dd>
<p><code>208</code></p>
</dd>
<dt class="hdlist1"><code>im_used</code></dt>
<dd>
<p><code>226</code></p>
</dd>
<dt class="hdlist1"><code>multiple_choices</code></dt>
<dd>
<p><code>300</code></p>
</dd>
<dt class="hdlist1"><code>moved_permanently</code></dt>
<dd>
<p><code>301</code></p>
</dd>
<dt class="hdlist1"><code>found</code></dt>
<dd>
<p><code>302</code></p>
</dd>
<dt class="hdlist1"><code>see_other</code></dt>
<dd>
<p><code>303</code></p>
</dd>
<dt class="hdlist1"><code>not_modified</code></dt>
<dd>
<p><code>304</code></p>
</dd>
<dt class="hdlist1"><code>use_proxy</code></dt>
<dd>
<p><code>305</code></p>
</dd>
<dt class="hdlist1"><code>switch_proxy</code></dt>
<dd>
<p><code>306</code></p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
No longer used.
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>temporary_redirect</code></dt>
<dd>
<p><code>307</code></p>
</dd>
<dt class="hdlist1"><code>permanent_redirect</code></dt>
<dd>
<p><code>308</code></p>
</dd>
<dt class="hdlist1"><code>bad_request</code></dt>
<dd>
<p><code>400</code></p>
</dd>
<dt class="hdlist1"><code>unauthorized</code></dt>
<dd>
<p><code>401</code></p>
</dd>
<dt class="hdlist1"><code>payment_required</code></dt>
<dd>
<p><code>402</code></p>
</dd>
<dt class="hdlist1"><code>forbidden</code></dt>
<dd>
<p><code>403</code></p>
</dd>
<dt class="hdlist1"><code>not_found</code></dt>
<dd>
<p><code>404</code></p>
</dd>
<dt class="hdlist1"><code>method_not_allowed</code></dt>
<dd>
<p><code>405</code></p>
</dd>
<dt class="hdlist1"><code>not_acceptable</code></dt>
<dd>
<p><code>406</code></p>
</dd>
<dt class="hdlist1"><code>proxy_authentication_required</code></dt>
<dd>
<p><code>407</code></p>
</dd>
<dt class="hdlist1"><code>request_timeout</code></dt>
<dd>
<p><code>408</code></p>
</dd>
<dt class="hdlist1"><code>conflict</code></dt>
<dd>
<p><code>409</code></p>
</dd>
<dt class="hdlist1"><code>gone</code></dt>
<dd>
<p><code>410</code></p>
</dd>
<dt class="hdlist1"><code>length_required</code></dt>
<dd>
<p><code>411</code></p>
</dd>
<dt class="hdlist1"><code>precondition_failed</code></dt>
<dd>
<p><code>412</code></p>
</dd>
<dt class="hdlist1"><code>payload_too_large</code></dt>
<dd>
<p><code>413</code></p>
</dd>
<dt class="hdlist1"><code>uri_too_long</code></dt>
<dd>
<p><code>414</code></p>
</dd>
<dt class="hdlist1"><code>unsupported_media_type</code></dt>
<dd>
<p><code>415</code></p>
</dd>
<dt class="hdlist1"><code>requested_range_not_satisfiable</code></dt>
<dd>
<p><code>416</code></p>
</dd>
<dt class="hdlist1"><code>expectation_failed</code></dt>
<dd>
<p><code>417</code></p>
</dd>
<dt class="hdlist1"><code>unprocessable_entity</code></dt>
<dd>
<p><code>422</code></p>
</dd>
<dt class="hdlist1"><code>locked</code></dt>
<dd>
<p><code>423</code></p>
</dd>
<dt class="hdlist1"><code>failed_dependency</code></dt>
<dd>
<p><code>424</code></p>
</dd>
<dt class="hdlist1"><code>upgrade_required</code></dt>
<dd>
<p><code>426</code></p>
</dd>
<dt class="hdlist1"><code>precondition_required</code></dt>
<dd>
<p><code>428</code></p>
</dd>
<dt class="hdlist1"><code>too_many_requests</code></dt>
<dd>
<p><code>429</code></p>
</dd>
<dt class="hdlist1"><code>request_header_fields_too_large</code></dt>
<dd>
<p><code>431</code></p>
</dd>
<dt class="hdlist1"><code>internal_server_error</code></dt>
<dd>
<p><code>500</code></p>
</dd>
<dt class="hdlist1"><code>not_implemented</code></dt>
<dd>
<p><code>501</code></p>
</dd>
<dt class="hdlist1"><code>bad_gateway</code></dt>
<dd>
<p><code>502</code></p>
</dd>
<dt class="hdlist1"><code>service_unavailable</code></dt>
<dd>
<p><code>503</code></p>
</dd>
<dt class="hdlist1"><code>gateway_timeout</code></dt>
<dd>
<p><code>504</code></p>
</dd>
<dt class="hdlist1"><code>http_version_not_supported</code></dt>
<dd>
<p><code>505</code></p>
</dd>
<dt class="hdlist1"><code>variant_also_negotiates</code></dt>
<dd>
<p><code>506</code></p>
</dd>
<dt class="hdlist1"><code>insufficient_storage</code></dt>
<dd>
<p><code>507</code></p>
</dd>
<dt class="hdlist1"><code>loop_detected</code></dt>
<dd>
<p><code>508</code></p>
</dd>
<dt class="hdlist1"><code>not_extended</code></dt>
<dd>
<p><code>510</code></p>
</dd>
<dt class="hdlist1"><code>network_authentication_required</code></dt>
<dd>
<p><code>511</code></p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_non_member_functions">4.2.30.2. Non-member functions</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>bool operator==(status_code lhs, std::uint_fast16_t rhs)</code></dt>
<dd>
<p>Tests if <em>lhs</em> and <em>rhs</em> are equal.</p>
</dd>
<dt class="hdlist1"><code>bool operator==(std::uint_fast16_t lhs, status_code rhs)</code></dt>
<dd>
<p>Tests if <em>lhs</em> and <em>rhs</em> are equal.</p>
</dd>
<dt class="hdlist1"><code>template&lt;class String&gt; String to_string(status_code sc)</code></dt>
<dd>
<p>Returns the textual representation (i.e. the reason phrase) of <em>sc</em>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_see_also_17">4.2.30.3. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#write_header"><code>&lt;boost/http/algorithm/write.hpp&gt;</code></a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="http_errc">4.2.31. <code>http_errc</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/http_errc.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">enum</span> <span class="tok-k">class</span> <span class="tok-nc">http_errc</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This scoped enumeration defines the values for the standard error codes reported
by HTTP message producers and consumers. They are intended to be generic and
usable by a variety of HTTP producers.</p>
</div>
<div class="paragraph">
<p>They are designed to work together <a href="#http_errc_http_category"><code>http_category</code></a>.</p>
</div>
<div class="paragraph">
<p>The traits <code>boost::system::is_error_code_enum</code> and
<code>boost::system::is_error_condition_enum</code> are specialized to recognize
<code>http_errc</code>.</p>
</div>
<div class="sect4">
<h5 id="_member_constants_4">4.2.31.1. Member constants</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>out_of_order</code></dt>
<dd>
<p>Actions issued on the wrong order by the library user.</p>
<div class="paragraph">
<p>Make sure to check the examples and the return value from <code>socket.read_state()</code>
and <code>socket.write_state()</code>.</p>
</div>
</dd>
<dt class="hdlist1"><code>native_stream_unsupported</code></dt>
<dd>
<p>The issued action can only be used when the underlying channel supports native
stream, as defined in the <a href="#socket_concept"><code>Socket</code> concept page</a>.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
If you&#8217;re using a type fulfilling the <a href="#server_socket_concept"><code>ServerSocket</code> concept</a>, you may be interested in the
<code>write_response_native_stream()</code> member function.
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>parsing_error</code></dt>
<dd>
<p>The underlying communication channel sent an invalid message.</p>
</dd>
<dt class="hdlist1"><code>buffer_exhausted</code></dt>
<dd>
<p>This error should only happen if a poor parser is used.</p>
</dd>
<dt class="hdlist1"><code>wrong_direction</code></dt>
<dd>
<p>For flexible sockets that select the channel type upon the first use. It
happens if you started the socket operations behaving like an HTTP client and
later started to behave as an HTTP server, or vice versa, on the same channel.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_non_member_functions_2">4.2.31.2. Non-member functions</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>boost::system::error_code make_error_code(http_errc e)</code></dt>
<dd>
<p>Creates an error code using <em>e</em> and <a href="#http_errc_http_category"><code>http_category</code></a>.</p>
</dd>
<dt class="hdlist1"><code>boost::system::error_condition make_error_condition(http_errc e)</code></dt>
<dd>
<p> Creates an error codition using <em>e</em> and <a href="#http_errc_http_category"><code>http_category</code></a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="http_errc_http_category">4.2.31.3. http_category</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">const</span> <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">system</span><span class="tok-o">::</span><span class="tok-n">error_category</span><span class="tok-o">&amp;</span> <span class="tok-n">http_category</span><span class="tok-p">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Obtains a reference to the static error category object for HTTP errors. The
object overrides the member function <code>name</code> to return <code>"http"</code> and overrides
<code>message</code> to support all values from <code>http_errc</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="file_server_errc">4.2.32. <code>file_server_errc</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/file_server.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">enum</span> <span class="tok-k">class</span> <span class="tok-nc">file_server_errc</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This scoped enumeration defines the values for the error codes reported by HTTP
file server abstraction shipped with this library.</p>
</div>
<div class="paragraph">
<p>They&#8217;re designed to work with <a href="#file_server_errc_file_server_category">file_server_category</a>.</p>
</div>
<div class="paragraph">
<p>The traits <code>boost::system::is_error_code_enum</code> and
<code>boost::system::is_error_condition_enum</code> are specialized to recognize
<code>file_server_errc</code>.</p>
</div>
<div class="sect4">
<h5 id="_member_constants_5">4.2.32.1. Member constants</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>io_error</code></dt>
<dd>
<p>When any operation on the file stream fails or throws an exception.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
It&#8217;s guaranteed that no operations on the underlying socket were done when
this error happens.
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>irrecoverable_io_error</code></dt>
<dd>
<p>When any operation on the file stream fails or throws an exception AFTER some
operation on the underlying socket already was issued.</p>
</dd>
<dt class="hdlist1"><code>write_state_not_supported</code></dt>
<dd>
<p>If some write operation already was issued before the call to the function
that raised this error code.</p>
</dd>
<dt class="hdlist1"><code>file_not_found</code></dt>
<dd>
<p>The requested file wasn&#8217;t found. The channel is left untouched to give the
user the opportunity to send a custom â404 responseâ or to further forward the
request.</p>
</dd>
<dt class="hdlist1"><code>file_type_not_supported</code></dt>
<dd>
<p>The requested file was found but it is not regular (e.g. directories, block
devices, links&#8230;&#8203;). Channel remains untouched.</p>
</dd>
<dt class="hdlist1"><code>filter_set</code></dt>
<dd>
<p>The user provided filter predicate returned <code>false</code> to cancel the
operation. Channel remains untouched.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_non_member_functions_3">4.2.32.2. Non-member functions</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>boost::system::error_code make_error_code(file_server_errc e)</code></dt>
<dd>
<p>Creates an error code using <em>e</em> and <a href="#file_server_errc_file_server_category">file_server_category</a></p>
</dd>
<dt class="hdlist1"><code>boost::system::error_condition make_error_condition(file_server_errc e)</code></dt>
<dd>
<p>Creates an error code using <em>e</em> and <a href="#file_server_errc_file_server_category">file_server_category</a></p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="file_server_errc_file_server_category">4.2.32.3. file_server_category</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">const</span> <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">system</span><span class="tok-o">::</span><span class="tok-n">error_category</span><span class="tok-o">&amp;</span> <span class="tok-n">file_server_category</span><span class="tok-p">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Obtains a reference to the static error category object for the file server
errors. The object overrides the member function <code>name</code> to return
<code>"file_server"</code> and overrides <code>message</code> to support all values from
<code>file_server_errc</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_see_also_18">4.2.32.4. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#async_response_transmit_file"><code>async_response_transmit_file</code></a></p>
</li>
<li>
<p><a href="#async_response_transmit_dir"><code>async_response_transmit_dir</code></a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="message_concept">4.2.33. <code>Message</code></h4>
<div class="paragraph">
<p>A container able to hold generic HTTP messages.</p>
</div>
<div class="sect4">
<h5 id="_definitions">4.2.33.1. Definitions</h5>
<div class="dlist">
<dl>
<dt class="hdlist1">HTTP field name</dt>
<dd>
<p>A string encoded with the <em>ISO-8859-1</em> charset whose contents are limited to
the chars listed below (case-sensitive):</p>
<div class="ulist">
<ul>
<li>
<p>A digit (i.e. <code>'0'</code>, <code>'1'</code>, <code>'2'</code>, <code>'3'</code>, <code>'4'</code>, <code>'5'</code>, <code>'6'</code>, <code>'7'</code>, <code>'8'</code> or
<code>'9'</code>).</p>
</li>
<li>
<p>A lowercase alphabetic (i.e. <code>'a'</code>, <code>'b'</code>, <code>'c'</code>, <code>'d'</code>, <code>'e'</code>, <code>'f'</code>, <code>'g'</code>,
<code>'h'</code>, <code>'i'</code>, <code>'j'</code>, <code>'k'</code>, <code>'l'</code>, <code>'m'</code>, <code>'n'</code>, <code>'o'</code>, <code>'p'</code>, <code>'q'</code>, <code>'r'</code>,
<code>'s'</code>, <code>'t'</code>, <code>'u'</code>, <code>'v'</code>, <code>'w'</code>, <code>'x'</code>, <code>'y'</code> or <code>'z'</code>).</p>
</li>
<li>
<p>A few special characters: <code>'!'</code>, <code>'#'</code>, <code>'$'</code>, <code>'%'</code>, <code>'&amp;'</code>, <code>'\''</code>, <code>'*'</code>,
<code>'+'</code>, <code>'-'</code>, <code>'.'</code>, <code>'^'</code>, <code>'_'</code>, backtick (i.e. <code>'\x60'</code>), <code>'|'</code> or <code>'~'</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Any uppercase character received through the wire MUST be normalized
(i.e. converted to lowercase).
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">HTTP field value</dt>
<dd>
<p>A string encoded with the <em>ISO-8859-1</em> charset whose contents are limited to
the chars listed below (whether they&#8217;re case-sensitive or not is defined on a
header-by-header basis and, as such, they all are considered case-sensitive in
this layer of abstraction):</p>
<div class="ulist">
<ul>
<li>
<p>Any visible <em>USASCII</em> character.</p>
</li>
<li>
<p>Any character in the closed interval (i.e. both ends are inclusive) between
<code>'\x80'</code> and <code>'\xFF'</code>. The use of these characters within the <em>HTTP field
value</em> is obsolete and should be avoided.</p>
</li>
<li>
<p>Space (i.e. <code>'\x20'</code>) and horizontal tab (i.e. <code>'\t'</code>). These characters are
not allowed in the beginning or in the end of the <em>HTTP field value</em>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">HTTP field</dt>
<dd>
<p>A pair whose first element is an <em>HTTP field name</em> and second element is an
<em>HTTP field value</em>.</p>
</dd>
<dt class="hdlist1">HTTP header section</dt>
<dd>
<p>A set of <em>HTTP fields</em> received in the same chunk (e.g. the HTTP header
section defined in the RFC 7230).</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For fields with equivalent field names, the relative order is preserved.
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_notation">4.2.33.2. Notation</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>X</code></dt>
<dd>
<p>A type that is a model of <code>Message</code>.</p>
</dd>
<dt class="hdlist1"><code>Headers</code></dt>
<dd>
<p>A type fulfilling the following requirements:</p>
<div class="ulist">
<ul>
<li>
<p>The C++11 concept of associative containers (<em>associative.reqmts</em>)
<sup class="footnote">[<a id="_footnoteref_15" class="footnote" href="#_footnote_15" title="View footnote.">15</a>]</sup>.</p>
</li>
<li>
<p>It supports equivalent keys.</p>
</li>
<li>
<p>Value type is equal to <code>pair&lt;const Key, T&gt;</code>.</p>
</li>
<li>
<p><code>mapped_type</code> is available with the same semantics for multimap.</p>
</li>
<li>
<p><code>Headers::key_type</code> MUST fulfill the requirements for the <code>String</code> concept
(i.e. <code>std::basic_string</code>).</p>
<div class="paragraph">
<p><code>Headers::key_type::value_type</code> MUST be able to represent all values in the
<em>ISO-8859-1</em> charset except for the upper case versions of the alphabetic
characters.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Inserting elements in <code>Headers</code> instances whose keys contains uppercase
char(s) invoke undefined behaviour.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>Headers::mapped_type</code> MUST fulfill the requirements for the <code>String</code> concept
(i.e. <code>std::basic_string</code>).</p>
<div class="paragraph">
<p><code>Headers::mapped_type::value_type</code> MUST be able to represent all values in the
<em>ISO-8859-1</em> charset.</p>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>Body</code></dt>
<dd>
<p>A type fulfilling the C++ concept of sequence containers (<em>sequence.reqmts</em>)
whose <code>value_type</code> can represent byte octets.</p>
</dd>
<dt class="hdlist1"><code>a</code></dt>
<dd>
<p>Object of type <code>X</code>.</p>
</dd>
<dt class="hdlist1"><code>ca</code></dt>
<dd>
<p>Object of type <code>const X</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_requirements_2">4.2.33.3. Requirements</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Expression</th>
<th class="tableblock halign-left valign-top">Return type</th>
<th class="tableblock halign-left valign-top">Precondition</th>
<th class="tableblock halign-left valign-top">Semantics</th>
<th class="tableblock halign-left valign-top">Postcondition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>std::is_base_of&lt;std::true_type, http::is_message&lt;X&gt;&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>std::true_type</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>X::headers_type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Headers</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>X::body_type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Body</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.headers()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>X::headers_type&amp;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>It should be used to represent the <em>HTTP header section</em> received/to-be-sent
before the HTTP body data payload.</p>
</li>
<li>
<p>Always returns a reference to the same object.</p>
</li>
<li>
<p>The returned object MUST <strong>NOT</strong> be shared with the one returned by
<code>a.trailers()</code>.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.headers()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>const X::headers_type&amp;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>It should be used to represent the <em>HTTP header section</em> received/to-be-sent
before the HTTP body data payload.</p>
</li>
<li>
<p>Always returns a reference to the same object.</p>
</li>
<li>
<p>The returned object MUST <strong>NOT</strong> be shared with the one returned by
<code>a.trailers()</code>.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.body()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>X::body_type&amp;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>It should be used to represent chunks of the HTTP body data payload.</p>
</li>
<li>
<p>Always returns a reference to the same object.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.body()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>const X::body_type&amp;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>It should be used to represent chunks of the HTTP body data payload.</p>
</li>
<li>
<p>Always returns a reference to the same object.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.trailers()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>X::headers_type&amp;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>It should be used to represent the <em>HTTP header section</em> received/to-be-sent
after the HTTP body data payload.</p>
</li>
<li>
<p>Always returns a reference to the same object.</p>
</li>
<li>
<p>The returned object MUST <strong>NOT</strong> be shared with the one returned by
<code>a.headers()</code>.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.trailers()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>const X::headers_type&amp;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>It should be used to represent the <em>HTTP header section</em> received/to-be-sent
after the HTTP body data payload.</p>
</li>
<li>
<p>Always returns a reference to the same object.</p>
</li>
<li>
<p>The returned object MUST <strong>NOT</strong> be shared with the one returned by
<code>a.headers()</code>.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Failing to comply with the âMUSTâ and âMUST <strong>NOT</strong>â conditions described
previously invokes undefined behaviour.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_see_also_19">4.2.33.4. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#request_concept"><code>Request</code> concept</a>.</p>
</li>
<li>
<p><a href="#response_concept"><code>Response</code> concept</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="request_concept">4.2.34. <code>Request</code></h4>
<div class="paragraph">
<p>A container able to hold HTTP request messages.</p>
</div>
<div class="sect4">
<h5 id="_refinement_of">4.2.34.1. Refinement of</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#message_concept"><code>Message</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_notation_2">4.2.34.2. Notation</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>X</code></dt>
<dd>
<p>A type that is a model of <code>Request</code>.</p>
</dd>
<dt class="hdlist1"><code>String</code></dt>
<dd>
<p>A type that is a model of C++'s <code>String</code>.</p>
</dd>
<dt class="hdlist1"><code>a</code></dt>
<dd>
<p>Object of type <code>X</code>.</p>
</dd>
<dt class="hdlist1"><code>ca</code></dt>
<dd>
<p>Object of type <code>const X</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_requirements_3">4.2.34.3. Requirements</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Expression</th>
<th class="tableblock halign-left valign-top">Return type</th>
<th class="tableblock halign-left valign-top">Precondition</th>
<th class="tableblock halign-left valign-top">Semantics</th>
<th class="tableblock halign-left valign-top">Postcondition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>std::is_base_of&lt;std::true_type, http::is_request_message&lt;X&gt;&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>std::true_type</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>X::string_type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.method()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>X::string_type&amp;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>It should be used to represent the HTTP request method.</p>
</li>
<li>
<p>Always returns a reference to the same object.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.method()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>const X::string_type&amp;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>It should be used to represent the HTTP request method.</p>
</li>
<li>
<p>Always returns a reference to the same object.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.target()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>X::string_type&amp;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>It should be used to represent the HTTP request target.</p>
</li>
<li>
<p>Always returns a reference to the same object.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.target()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>const X::string_type&amp;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>It should be used to represent the HTTP request target.</p>
</li>
<li>
<p>Always returns a reference to the same object.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_models">4.2.34.4. Models</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#request"><code>request</code></a></p>
</li>
<li>
<p><a href="#basic_request"><code>basic_request</code></a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="response_concept">4.2.35. <code>Response</code></h4>
<div class="paragraph">
<p>A container able to hold HTTP response messages.</p>
</div>
<div class="sect4">
<h5 id="_refinement_of_2">4.2.35.1. Refinement of</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#message_concept"><code>Message</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_notation_3">4.2.35.2. Notation</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>X</code></dt>
<dd>
<p>A type that is a model of <code>Response</code>.</p>
</dd>
<dt class="hdlist1"><code>String</code></dt>
<dd>
<p>A type that is a model of C++'s <code>String</code>.</p>
</dd>
<dt class="hdlist1"><code>a</code></dt>
<dd>
<p>Object of type <code>X</code>.</p>
</dd>
<dt class="hdlist1"><code>ca</code></dt>
<dd>
<p>Object of type <code>const X</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_requirements_4">4.2.35.3. Requirements</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Expression</th>
<th class="tableblock halign-left valign-top">Return type</th>
<th class="tableblock halign-left valign-top">Precondition</th>
<th class="tableblock halign-left valign-top">Semantics</th>
<th class="tableblock halign-left valign-top">Postcondition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>std::is_base_of&lt;std::true_type, http::is_response_message&lt;X&gt;&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>std::true_type</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>X::string_type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.status_code()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>std::uint_least16_t&amp;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>It should be used to represent the HTTP response status code.</p>
</li>
<li>
<p>Always returns a reference to the same object.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.status_code()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>const std::uint_least16_t&amp;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>It should be used to represent the HTTP response status code.</p>
</li>
<li>
<p>Always returns a reference to the same object.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.reason_phrase()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>X::string_type&amp;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>It should be used to represent the HTTP response reason phrase.</p>
</li>
<li>
<p>Always returns a reference to the same object.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.reason_phrase()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>const X::string_type&amp;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>It should be used to represent the HTTP response reason phrase.</p>
</li>
<li>
<p>Always returns a reference to the same object.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_models_2">4.2.35.4. Models</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#response"><code>response</code></a></p>
</li>
<li>
<p><a href="#basic_response"><code>basic_response</code></a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="socket_concept">4.2.36. <code>Socket</code></h4>
<div class="paragraph">
<p>Common operations between request and response that the underlying channel
should provide.</p>
</div>
<div class="sect4">
<h5 id="_definitions_2">4.2.36.1. Definitions</h5>
<div class="dlist">
<dl>
<dt class="hdlist1">Types fulfilling the <code>Socket</code> concept and also possessing the <em>strict</em> property</dt>
<dd>
<p>Instances from this type will <strong>not</strong> insert illegal characters
<sup class="footnote">[<a id="_footnoteref_16" class="footnote" href="#_footnote_16" title="View footnote.">16</a>]</sup> in the HTTP fields.</p>
</dd>
<dt class="hdlist1">Native stream</dt>
<dd>
<p>The message size doesn&#8217;t need to be know prior to writing the response
message. The use of the streaming API can only be used when this property
holds. Buffering the body MUST <strong>NOT</strong> be done and the message parts MUST be
written as soon as convenient. If this property holds, the user MAY safely use
the socket to transmit a live video stream, for instance.</p>
</dd>
<dt class="hdlist1">Message metadata</dt>
<dd>
<p>The HTTP status line plus the header section.</p>
</dd>
<dt class="hdlist1">Atomic message</dt>
<dd>
<p>A message which is issued and fully know with a single API call.</p>
<div class="paragraph">
<p>Every message is either atomic or chunked.</p>
</div>
</dd>
<dt class="hdlist1">Chunked message</dt>
<dd>
<p>A message which is issued among several API calls.</p>
<div class="paragraph">
<p>Every message is either atomic or chunked.</p>
</div>
<div class="paragraph">
<p>Chunked messages are useful if you don&#8217;t know the message in advance (e.g. video
streaming). These messages can only be used if native stream is supported.</p>
</div>
<div class="paragraph">
<p>You always need to be prepared to receive chunked messages and it&#8217;s only useful
to differ operations which only apply to atomic messages or chunked messages
when you&#8217;re about to send a message.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_notation_4">4.2.36.2. Notation</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>Message</code></dt>
<dd>
<p>A type fulfilling the requirements for the <a href="#message_concept"><code>Message</code>
concept</a>.</p>
</dd>
<dt class="hdlist1"><code>m</code></dt>
<dd>
<p>Object of type <code>Message</code>.</p>
</dd>
<dt class="hdlist1"><code>cm</code></dt>
<dd>
<p>Object of type <code>const Message</code>.</p>
</dd>
<dt class="hdlist1"><code>CompletionToken</code></dt>
<dd>
<p>A type fulfilling the concept of a completion token, as defined in
<a href="https://isocpp.org/files/papers/n4045.pdf">N4045: Library Foundations for
Asynchronous Operations, Revision 2</a>.</p>
</dd>
<dt class="hdlist1"><code>AsyncResultType</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">async_result</span><span class="tok-o">&lt;</span>
    <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">handler_type</span><span class="tok-o">&lt;</span>
        <span class="tok-n">CompletionToken</span><span class="tok-p">,</span> <span class="tok-kt">void</span><span class="tok-p">(</span><span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">system</span><span class="tok-o">::</span><span class="tok-n">error_code</span><span class="tok-p">)</span><span class="tok-o">&gt;::</span><span class="tok-n">type</span><span class="tok-o">&gt;::</span><span class="tok-n">type</span></code></pre>
</div>
</div>
</dd>
<dt class="hdlist1"><code>token</code></dt>
<dd>
<p>An object of the type <code>CompletionToken</code>.</p>
</dd>
<dt class="hdlist1"><code>X</code></dt>
<dd>
<p>A type that is a model of <code>Socket</code>.</p>
</dd>
<dt class="hdlist1"><code>a</code></dt>
<dd>
<p>Object of type <code>X</code>.</p>
</dd>
<dt class="hdlist1"><code>ca</code></dt>
<dd>
<p>Object of type <code>const X</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_requirements_5">4.2.36.3. Requirements</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Expression</th>
<th class="tableblock halign-left valign-top">Return type</th>
<th class="tableblock halign-left valign-top">Precondition</th>
<th class="tableblock halign-left valign-top">Semantics</th>
<th class="tableblock halign-left valign-top">Postcondition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>std::is_base_of&lt;std::true_type, http::is_socket&lt;X&gt;&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>std::true_type</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.get_io_service()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asio::io_service&amp;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the <code>io_service</code> object through which the handlers of asynchronous
 operations will be invoked.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>X::message_type</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Socket</code> only supports operations involving a single type of message.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Must be a type fulfilling the <a href="#message_concept"><code>Message</code> concept</a>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.is_open()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determine whether the socket is open.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.read_state()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#read_state"><code>read_state</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the state associated with the <code>Socket</code> meaningful for reading
 operations.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.write_state()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#write_state"><code>write_state</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the state associated with the <code>Socket</code> meaningful for writing
 operations.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.async_read_some(m, token)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AsyncResultType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.read_state() == read_state::message_ready</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initiate an asynchronous operation to read a part of the message body. Handler
 is called when at least one byte is read (called with no error set), when the
 end of message is reached (called with no error set) or when some error occurs.
</p><p class="tableblock"> <code>m.body()</code> and <code>m.trailers()</code> are left in an unspecified state while the
 operation is in progress.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By the time the handler is called, the part of the message read (if any) is
 appended to <code>m.body()</code>, if no error happened.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.async_read_some(m, token)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AsyncResultType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.read_state() != read_state::message_ready</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No actions are done and the handler from the completion token is called with
 <code>boost::system::error_code {http_errc::out_of_order}</code>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.async_read_trailers(m, token)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AsyncResultType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.read_state() == read_state::body_ready</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initiate an asynchronous operation to read the trailers. Handler is called when
 the rest of the message is fully received (called with no error set) or when
 some error occurs.
</p><p class="tableblock"> <code>m.trailers()</code> is left in an unspecified state while the operation is in
 progress.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>By the time the handler is called, if no error happened:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>a.read_state() == http::read_state::empty</code></p>
</li>
<li>
<p>The read trailers (if any) are inserted into <code>m.trailers()</code>.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.async_read_trailers(m, token)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AsyncResultType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.read_state() != read_state::body_ready</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No actions are done and the handler from the completion token is called with
 <code>boost::system::error_code {http_errc::out_of_order}</code>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.async_write(cm, token)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AsyncResultType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.write_state() == write_state ::metadata_issued</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initiate an asynchronous operation to write a chunk of the HTTP body data
 payload (chunked message). Handler is called when the operation completes with
 an appropriate parameter.
</p><p class="tableblock"> <code>cm.body()</code> MUST <strong>NOT</strong> be modified while the operation is in progress.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By the time the handler is called, the <code>cm.body()</code> data is considered
 delivered, if no error happened.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.async_write(cm, token)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AsyncResultType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.write_state() != write_state ::metadata_issued</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No actions are done and the handler from the completion token is called with
 <code>boost::system::error_code {http_errc::out_of_order}</code>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.async_write_trailers(cm, token)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AsyncResultType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.write_state() == write_state ::metadata_issued</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initiate an asynchronous operation to write the trailer part of the message
 (chunked message). Handler is called when the operation completes with an
 appropriate parameter.
</p><p class="tableblock"> <code>cm.trailers()</code> MUST <strong>NOT</strong> be modified while the operation is in progress.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p><code>a.write_state() == write_state::finished</code></p>
</li>
<li>
<p>By the time the operation completes, the <code>cm.trailers()</code> data is considered
delivered, if no error happened.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.async_write_trailers(cm, token)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AsyncResultType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.write_state() != write_state ::metadata_issued</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No actions are done and the handler from the completion token is called with
 <code>boost::system::error_code {http_errc::out_of_order}</code>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.async_write_end_of_message (token)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AsyncResultType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.write_state() == write_state ::metadata_issued</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initiate an asynchronous operation to signalize the sent message is complete
 (chunked message). Handler is called when the operation completes with an
 appropriate parameter.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p><code>a.write_state() == write_state::finished</code></p>
</li>
<li>
<p>By the time the operation completes, the message is considered complete, if no
error happened.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.async_write_end_of_message (token)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AsyncResultType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.write_state() != write_state ::metadata_issued</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No actions are done and the handler from the completion token is called with
 <code>boost::system::error_code {http_errc::out_of_order}</code>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Failing to comply with the âMUSTâ and âMUST <strong>NOT</strong>â conditions described
previously invokes undefined behaviour.</p>
</li>
<li>
<p>Any HTTP field name received through the wire is normalized (i.e. uppercase
characters are converted to lowercase) before they&#8217;re inserted into objects of
type <code>Message::headers_type</code>.</p>
</li>
<li>
<p>The <code>Socket</code> object has the freedom to store information required to further
process the incoming message in the user-provided <code>message</code> object. Thus, the
library user MUST <strong>NOT</strong> use different <code>message</code> objects in the functions that
initiate <strong>read</strong> operations, in the context of the <strong>same</strong> message exchange
(i.e. the user can use a different <code>message</code> object to receive a different
message). This requirement is extended to refinements of this concept.</p>
</li>
<li>
<p>The <code>Socket</code> object MUST <strong>NOT</strong> insert HTTP headers with empty keys (i.e. <code>""</code>)
in message, request or response objects provided by the user.</p>
</li>
<li>
<p>You MUST <strong>NOT</strong> write messages with the <code>"transfer-encoding: chunked"</code> header.</p>
</li>
<li>
<p>You MUST <strong>NOT</strong> write <strong>atomic</strong> messages with the <code>"transfer-encoding"</code> header.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_models_3">4.2.36.4. Models</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#basic_socket"><code>basic_socket</code></a></p>
</li>
<li>
<p><a href="#basic_buffered_socket"><code>basic_buffered_socket</code></a></p>
</li>
<li>
<p><a href="#polymorphic_socket_base"><code>polymorphic_socket_base</code></a></p>
</li>
<li>
<p><a href="#polymorphic_server_socket"><code>polymorphic_server_socket</code></a></p>
</li>
<li>
<p><a href="#server_socket_adaptor"><code>server_socket_adaptor</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_see_also_20">4.2.36.5. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#server_socket_concept"><code>ServerSocket</code></a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="server_socket_concept">4.2.37. <code>ServerSocket</code></h4>
<div class="paragraph">
<p>Provides operations for HTTP servers.</p>
</div>
<div class="sect4">
<h5 id="_refinement_of_3">4.2.37.1. Refinement of</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#socket_concept"><code>Socket</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_definitions_3">4.2.37.2. Definitions</h5>
<div class="dlist">
<dl>
<dt class="hdlist1">Types fulfilling the <code>ServerSocket</code> concept and also possessing the <em>strict</em> property</dt>
<dd>
<p>Instances from this type will <strong>not</strong> insert illegal characters
<sup class="footnote">[<a id="_footnoteref_17" class="footnote" href="#_footnote_17" title="View footnote.">17</a>]</sup> in the HTTP fields.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_notation_5">4.2.37.3. Notation</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>Request</code></dt>
<dd>
<p>A type fulfilling the requirements for the <a href="#request_concept"><code>Request</code>
concept</a>.</p>
</dd>
<dt class="hdlist1"><code>Response</code></dt>
<dd>
<p>A type fulfilling the requirements for the <a href="#response_concept"><code>Response</code>
concept</a>.</p>
</dd>
<dt class="hdlist1"><code>im</code></dt>
<dd>
<p>Object of type <code>Request</code>.</p>
</dd>
<dt class="hdlist1"><code>om</code></dt>
<dd>
<p>Object of type <code>const Response</code>.</p>
</dd>
<dt class="hdlist1"><code>CompletionToken</code></dt>
<dd>
<p>A type fulfilling the concept of a completion token, as defined in
<a href="https://isocpp.org/files/papers/n4045.pdf">N4045: Library Foundations for
Asynchronous Operations, Revision 2</a>.</p>
</dd>
<dt class="hdlist1"><code>AsyncResultType</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">async_result</span><span class="tok-o">&lt;</span>
     <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">handler_type</span><span class="tok-o">&lt;</span>
         <span class="tok-n">CompletionToken</span><span class="tok-p">,</span> <span class="tok-kt">void</span><span class="tok-p">(</span><span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">system</span><span class="tok-o">::</span><span class="tok-n">error_code</span><span class="tok-p">)</span><span class="tok-o">&gt;::</span><span class="tok-n">type</span><span class="tok-o">&gt;::</span><span class="tok-n">type</span></code></pre>
</div>
</div>
</dd>
<dt class="hdlist1"><code>token</code></dt>
<dd>
<p>An object of the type <code>CompletionToken</code>.</p>
</dd>
<dt class="hdlist1"><code>X</code></dt>
<dd>
<p>A type that is a model of <code>ServerSocket</code>.</p>
</dd>
<dt class="hdlist1"><code>a</code></dt>
<dd>
<p>Object of type <code>X</code>.</p>
</dd>
<dt class="hdlist1"><code>ca</code></dt>
<dd>
<p>Object of type <code>const X</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_requirements_6">4.2.37.4. Requirements</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Expression</th>
<th class="tableblock halign-left valign-top">Return type</th>
<th class="tableblock halign-left valign-top">Precondition</th>
<th class="tableblock halign-left valign-top">Semantics</th>
<th class="tableblock halign-left valign-top">Postcondition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>std::is_base_of&lt;std::true_type, http::is_server_socket&lt;X&gt;&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>std::true_type</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>X::request_type</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ServerSocket</code> only supports operations involving a single type of request
 message.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Must be a type fulfilling the requirements for the <a href="#request_concept"><code>Request</code>
 concept</a>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>X::response_type</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ServerSocket</code> only supports operations involving a single type of response
 message.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Must be a type fulfilling the requirements for the
 <a href="#response_concept"><code>Response</code> concept</a>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.write_response_native_stream()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.read_state() != read_state::empty</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns whether the current message exchange supports native stream.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The same value and property is maintained until the end of the current message
 exchange.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.async_read_request(im, token)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AsyncResultType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.read_state() == read_state::empty</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initiate an asynchronous operation to read enough of the message to apply the
 request to a target resource (i.e. request line plus the header section).
 Handler is called when the operation completes with an appropriate parameter.
</p><p class="tableblock"> <code>im</code> is left in a unspecified state while the operation is in progress.
</p><p class="tableblock"> The <code>ServerSocket</code> object MUST prevent the user from issuing new replies while
 the request isn&#8217;t ready. The prevention MUST be done by changing the write
 state to <code>write_state::finished</code> while the read_request operation is in
 progress.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By the time the handler is called, <code>im.method()</code> value represents the read
 method, <code>im.target()</code> represents the read url and all headers for the current
 request are inserted into <code>m.headers()</code>, if no error happened.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.async_read_request(im, token)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AsyncResultType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.read_state() != read_state::empty</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No actions are done and the handler from the completion token is called with
 <code>boost::system::error_code {http_errc::out_of_order}</code>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.async_write_response(om, token)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AsyncResultType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.write_state() == write_state::empty
  || a.write_state() == write_state::continue_issued</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initiate an asynchronous operation to write the response message (atomic
 message). Handler is called with an appropriate argument when the operation
 completes.
</p><p class="tableblock"> <code>om</code> MUST <strong>NOT</strong> be modified while the operation is in progress.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p><code>a.write_state() == write_state ::finished</code></p>
</li>
<li>
<p>By the time the handler is called, the <code>om</code> message is considered delivered,
if no error happened.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.async_write_response(om, token)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AsyncResultType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.write_state() != write_state::empty
 &amp;&amp; a.write_state() != write_state::continue_issued</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No actions are done and the handler from the completion token is called with
 <code>boost::system::error_code {http_errc::out_of_order}</code>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.async_write_response_continue (token)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AsyncResultType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.write_state() == write_state::empty</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initiate an asynchronous operation to write a response with the semantics from
 a â100 (Continue) responseâ <sup class="footnote">[<a id="_footnoteref_18" class="footnote" href="#_footnote_18" title="View footnote.">18</a>]</sup>. Handler is called when the operation completes with an appropriate
 parameter.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p><code>a.write_state() == write_state ::continue_issued</code></p>
</li>
<li>
<p>By the time the handler is called, the â100 (Continue) responseâ is
considered delivered.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.async_write_response_continue (token)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AsyncResultType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.write_state() != write_state::empty</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No actions are done and the handler from the completion token is called with
 <code>boost::system::error_code {http_errc::out_of_order}</code>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a .async_write_response_metadata(om, token)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AsyncResultType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(a.write_state() == write_state::empty
   || a.write_state() == write_state::continue_issued)
  &amp;&amp; a.write_response_native_stream() == true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initiate an asynchronous operation to write the response metadata (chunked
 message). Handler is called with an appropriate argument when the operation
 completes.
</p><p class="tableblock"> <code>om</code> MUST <strong>NOT</strong> be modified while the operation is in progress.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p><code>a.write_state() == write_state ::metadata_issued</code></p>
</li>
<li>
<p>By the time the handler is called, the response metadata
(i.e. <code>om.status_code()</code>, <code>om.reason_phrase()</code> and <code>cm.headers()</code>) is
considered delivered, if no error happened.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a .async_write_response_metadata(om, token)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AsyncResultType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a.write_state() != write_state::empty
  &amp;&amp; a.write_state() != write_state::continue_issued</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No actions are done and the handler from the completion token is called with
 <code>boost::system::error_code {http_errc::out_of_order}</code> <sup class="footnote">[<a id="_footnoteref_19" class="footnote" href="#_footnote_19" title="View footnote.">19</a>]</sup>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a .async_write_response_metadata(om, token)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AsyncResultType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(a.write_state() == write_state::empty
   || a.write_state() == write_state::continue_issued)
  &amp;&amp; a.write_response_native_stream() == false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No actions are done and the handler from the completion token is called with
 <code>boost::system::error_code {http_errc ::native_stream_unsupported}</code>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Failing to comply with the âMUSTâ and âMUST <strong>NOT</strong>â conditions described
previously invokes undefined behaviour.</p>
</li>
<li>
<p>Any HTTP field name received through the wire is normalized (i.e. uppercase
characters are converted to lowercase) before they&#8217;re inserted into objects of
type <code>Request::headers_type</code>.</p>
</li>
<li>
<p>If the user pass a <code>"connection: close"</code> header on the message object passed
as argument to the <code>async_write_response</code> or <code>async_write_response_metadata</code>
member-functions and no errors arose during the delivery of the message, the
<code>ServerSocket</code> MUST call the handler with <a href="#http_errc"><code>http_errc::stream_finished</code></a>.</p>
<div class="paragraph">
<p>This behaviour is intended for the communication between the user of this
library and the <code>ServerSocket</code> and can differ from the communication between the
<code>ServerSocket</code> and the underlying channel.</p>
</div>
</li>
<li>
<p>If the <code>ServerSocket</code> reads a message that expects a â100 (Continue)
responseâ, it MUST insert the <code>"expect: 100-continue"</code> header and only one
element with the HTTP field name <code>"expect"</code> MUST be present.</p>
<div class="paragraph">
<p>This behaviour is intended for the communication between the user of this
library and the <code>ServerSocket</code> and can differ from the communication between the
<code>ServerSocket</code> and the underlying channel.</p>
</div>
</li>
<li>
<p>If the <code>ServerSocket</code> reads a message that does <strong>NOT</strong> expect a â100 (Continue)
responseâ, it MUST erase all the <code>"expect: 100-continue"</code> headers.</p>
<div class="paragraph">
<p>This behaviour is intended for the communication between the user of this
library and the <code>ServerSocket</code> and can differ from the communication between the
<code>ServerSocket</code> and the underlying channel.</p>
</div>
</li>
<li>
<p>If the <code>ServerSocket</code> reads a message that represent a desire from the HTTP
client to initiate a protocol upgrade, the <code>ServerSocket</code> supports a protocol
upgrade and it&#8217;ll communicate the client desire to the user of this library,
it MUST communicate the desire ensuring all of the following conditions:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Ensuring that the <code>"upgrade"</code> (case-insensitive) string is present in the
comma-separated list of values from some <code>"connection"</code> header. This rule
implictly requires the presence of at least one <code>"connection"</code> header.</p>
</li>
<li>
<p>There is at least one <code>"upgrade"</code> header and all of the <code>"upgrade"</code> headers
respect the conditions established in the section 6.7 of the RFC7230.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>This behaviour is intended for the communication between the user of this
library and the <code>ServerSocket</code> and can differ from the communication between the
<code>ServerSocket</code> and the underlying channel.</p>
</div>
</li>
<li>
<p>If the <code>ServerSocket</code> isn&#8217;t willing to provide a protocol upgrade, then no
<code>"upgrade"</code> headers can be present (in other words, all <code>"upgrade"</code> headers
MUST be erased before delivering the message to the user of this library).</p>
<div class="paragraph">
<p>This behaviour is intended for the communication between the user of this
library and the <code>ServerSocket</code> and can differ from the communication between the
<code>ServerSocket</code> and the underlying channel.</p>
</div>
</li>
<li>
<p>If the <code>"content-length"</code> header is provided to <code>async_write_response</code>, then
the <code>ServerSocket</code> MUST ignore the message body (i.e. there is no data payload
in the reply message) and SHOULD use the user-provided header.</p>
<div class="paragraph">
<p>The <code>ServerSocket</code> MUST adopt a behaviour that is compatible with the behaviour
defined in the section 3.3.2 of the RFC 7230.</p>
</div>
</li>
<li>
<p>The <code>ServerSocket</code> object MUST <strong>NOT</strong> insert HTTP headers with empty keys
(i.e. <code>""</code>) in message, request or response objects provided by the user.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_models_4">4.2.37.5. Models</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#basic_socket"><code>basic_socket</code></a></p>
</li>
<li>
<p><a href="#basic_buffered_socket"><code>basic_buffered_socket</code></a></p>
</li>
<li>
<p><a href="#polymorphic_server_socket"><code>polymorphic_server_socket</code></a></p>
</li>
<li>
<p><a href="#server_socket_adaptor"><code>server_socket_adaptor</code></a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="algorithm_header">4.2.38. <code>&lt;boost/http/algorithm.hpp&gt;</code></h4>
<div class="paragraph">
<p>A shorthand to write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/algorithm/header.hpp&gt;</span><span class="tok-cp"></span>
<span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/algorithm/query.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_see_also_21">4.2.38.1. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#header_header"><code>&lt;boost/http/algorithm/header.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#query_header"><code>&lt;boost/http/algorithm/query.hpp&gt;</code></a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="header_header">4.2.39. <code>&lt;boost/http/algorithm/header.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#header_to_ptime"><code>header_to_ptime</code></a></p>
</li>
<li>
<p><a href="#to_http_date"><code>to_http_date</code></a></p>
</li>
<li>
<p><a href="#header_value_all_of"><code>header_value_all_of</code></a></p>
</li>
<li>
<p><a href="#header_value_any_of"><code>header_value_any_of</code></a></p>
</li>
<li>
<p><a href="#header_value_none_of"><code>header_value_none_of</code></a></p>
</li>
<li>
<p><a href="#header_value_for_each"><code>header_value_for_each</code></a></p>
</li>
<li>
<p><a href="#etag_match_strong"><code>etag_match_strong</code></a></p>
</li>
<li>
<p><a href="#etag_match_weak"><code>etag_match_weak</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="query_header">4.2.40. <code>&lt;boost/http/algorithm/query.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#request_continue_required"><code>request_continue_required</code></a></p>
</li>
<li>
<p><a href="#request_upgrade_desired"><code>request_upgrade_desired</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="file_server_header">4.2.41. <code>&lt;boost/http/file_server.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#async_response_transmit_file"><code>async_response_transmit_file</code></a></p>
</li>
<li>
<p><a href="#async_response_transmit_dir"><code>async_response_transmit_dir</code></a></p>
</li>
<li>
<p><a href="#file_server_errc"><code>file_server_errc</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="headers_header">4.2.42. <code>&lt;boost/http/headers.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbol:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#headers"><code>headers</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="http_category_header">4.2.43. <code>&lt;boost/http/http_category.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the <code>http_category</code> symbol documented at <a href="#http_errc_http_category"><code>http_errc</code> page</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="http_errc_header">4.2.44. <code>&lt;boost/http/http_errc.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import all the symbols documented at the <a href="#http_errc"><code>http_errc</code> page</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="request_header">4.2.45. <code>&lt;boost/http/request.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#basic_request"><code>basic_request</code></a></p>
</li>
<li>
<p><a href="#request"><code>request</code></a></p>
</li>
<li>
<p><a href="#headers"><code>headers</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="response_header">4.2.46. <code>&lt;boost/http/response.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#basic_response"><code>basic_response</code></a></p>
</li>
<li>
<p><a href="#response"><code>response</code></a></p>
</li>
<li>
<p><a href="#headers"><code>headers</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="request_response_wrapper_header">4.2.47. <code>&lt;boost/http/request_response_wrapper.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#request_response_wrapper"><code>request_response_wrapper</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="polymorphic_server_socket_header">4.2.48. <code>&lt;boost/http/polymorphic_server_socket.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#basic_polymorphic_server_socket"><code>basic_polymorphic_server_socket</code></a></p>
</li>
<li>
<p><a href="#polymorphic_server_socket"><code>polymorphic_server_socket</code></a></p>
</li>
<li>
<p><a href="#polymorphic_socket_base"><code>polymorphic_socket_base</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="polymorphic_socket_base_header">4.2.49. <code>&lt;boost/http/polymorphic_socket_base.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#basic_polymorphic_socket_base"><code>basic_polymorphic_socket_base</code></a></p>
</li>
<li>
<p><a href="#polymorphic_socket_base"><code>polymorphic_socket_base</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="read_state_header">4.2.50. <code>&lt;boost/http/read_state.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbol:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#read_state"><code>read_state</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="server_socket_adaptor_header">4.2.51. <code>&lt;boost/http/server_socket_adaptor.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#server_socket_adaptor"><code>server_socket_adaptor</code></a></p>
</li>
<li>
<p><a href="#polymorphic_server_socket"><code>polymorphic_server_socket</code></a></p>
</li>
<li>
<p><a href="#polymorphic_socket_base"><code>polymorphic_socket_base</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="socket_header">4.2.52. <code>&lt;boost/http/socket.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#basic_socket"><code>basic_socket</code></a></p>
</li>
<li>
<p><a href="#socket"><code>socket</code></a></p>
</li>
<li>
<p><a href="#read_state"><code>read_state</code></a></p>
</li>
<li>
<p><a href="#write_state"><code>write_state</code></a></p>
</li>
<li>
<p><a href="#http_errc"><code>http_errc</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="buffered_socket_header">4.2.53. <code>&lt;boost/http/buffered_socket.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#basic_buffered_socket"><code>basic_buffered_socket</code></a></p>
</li>
<li>
<p><a href="#buffered_socket"><code>buffered_socket</code></a></p>
</li>
<li>
<p><a href="#read_state"><code>read_state</code></a></p>
</li>
<li>
<p><a href="#write_state"><code>write_state</code></a></p>
</li>
<li>
<p><a href="#http_errc"><code>http_errc</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="status_code_header">4.2.54. <code>&lt;boost/http/status_code.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbol:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#status_code"><code>status_code</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="write_state_header">4.2.55. <code>&lt;boost/http/write_state.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbol:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#write_state"><code>write_state</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="traits_header">4.2.56. <code>&lt;boost/http/traits.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#is_message"><code>is_message</code></a></p>
</li>
<li>
<p><a href="#is_request_message"><code>is_request_message</code></a></p>
</li>
<li>
<p><a href="#is_response_message"><code>is_response_message</code></a></p>
</li>
<li>
<p><a href="#is_socket"><code>is_socket</code></a></p>
</li>
<li>
<p><a href="#is_server_socket"><code>is_server_socket</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="basic_router_header">4.2.57. <code>&lt;boost/http/basic_router.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#basic_router"><code>basic_router</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="regex_router_header">4.2.58. <code>&lt;boost/http/regex_router.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#regex_router"><code>regex_router</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="is_message">4.2.59. <code>is_message</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/traits.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>T</code> is an object fulfilling the <a href="#message_concept"><code>Message</code> concept</a>, this
template inherits <code>std::true_type</code>. For any other type, this template inherits
<code>std::false_type</code>.</p>
</div>
<div class="paragraph">
<p>This template may be specialized for a user-defined type to indicate that the
type is eligible for operations involving <a href="#message_concept"><code>Message</code> objects</a>.</p>
</div>
<div class="paragraph">
<p>Initially, it was considered to create a trait that would automatically detect
if <code>T</code> is fullfilling the <a href="#message_concept"><code>Message</code> concept</a>, but the idea
was abandoned, because the <a href="#message_concept"><code>Message</code> concept</a> includes
behaviour that can only be detected at runtime.</p>
</div>
<div class="paragraph">
<p>The default definition follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">T</span><span class="tok-o">&gt;</span>
<span class="tok-k">struct</span> <span class="tok-nl">is_message</span>
    <span class="tok-p">:</span> <span class="tok-k">public</span> <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">integral_constant</span><span class="tok-o">&lt;</span><span class="tok-kt">bool</span><span class="tok-p">,</span>
                                    <span class="tok-n">is_request_message</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;::</span><span class="tok-n">value</span>
                                    <span class="tok-o">||</span> <span class="tok-n">is_response_message</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;::</span><span class="tok-n">value</span><span class="tok-o">&gt;</span>
<span class="tok-p">{};</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_template_parameters_21">4.2.59.1. Template parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>T</code></dt>
<dd>
<p>The type to query.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_see_also_22">4.2.59.2. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#message_concept"><code>Message</code> concept</a>.</p>
</li>
<li>
<p><a href="#is_request_message"><code>is_request_message</code></a>.</p>
</li>
<li>
<p><a href="#is_response_message"><code>is_response_message</code></a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="is_request_message">4.2.60. <code>is_request_message</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/traits.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>T</code> is an object fulfilling the <a href="#request_concept"><code>Request</code> concept</a>, this
template inherits <code>std::true_type</code>. For any other type, this template inherits
<code>std::false_type</code>.</p>
</div>
<div class="paragraph">
<p>This template may be specialized for a user-defined type to indicate that the
type is eligible for operations involving <a href="#request_concept"><code>Request</code> objects</a>.</p>
</div>
<div class="sect4">
<h5 id="_template_parameters_22">4.2.60.1. Template parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>T</code></dt>
<dd>
<p>The type to query.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_see_also_23">4.2.60.2. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#request_concept"><code>Request</code> concept</a>.</p>
</li>
<li>
<p><a href="#is_message"><code>is_message</code></a>.</p>
</li>
<li>
<p><a href="#is_response_message"><code>is_response_message</code></a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="is_response_message">4.2.61. <code>is_response_message</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/traits.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>T</code> is an object fulfilling the <a href="#response_concept"><code>Response</code> concept</a>, this
template inherits <code>std::true_type</code>. For any other type, this template inherits
<code>std::false_type</code>.</p>
</div>
<div class="paragraph">
<p>This template may be specialized for a user-defined type to indicate that the
type is eligible for operations involving <a href="#response_concept"><code>Response</code>
objects</a>.</p>
</div>
<div class="sect4">
<h5 id="_template_parameters_23">4.2.61.1. Template parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>T</code></dt>
<dd>
<p>The type to query.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_see_also_24">4.2.61.2. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#response_concept"><code>Response</code> concept</a>.</p>
</li>
<li>
<p><a href="#is_message"><code>is_message</code></a>.</p>
</li>
<li>
<p><a href="#is_request_message"><code>is_request_message</code></a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="is_socket">4.2.62. <code>is_socket</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/traits.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>T</code> is an object fulfilling the <a href="#socket_concept"><code>Socket</code> concept</a>, this
template inherits <code>std::true_type</code>. For any other type, this template inherits
<code>std::false_type</code>.</p>
</div>
<div class="paragraph">
<p>This template may be specialized for a user-defined type to indicate that the
type is eligible for operations involving <a href="#socket_concept"><code>Socket</code>
objects</a>. If your user-defined type already specializes <a href="#is_server_socket"><code>is_server_socket</code></a>, there is no need to also specialize this template, because
this template will, by default, inherit <code>std::true_type</code> if
<code>is_server_socket&lt;T&gt;::value</code> evaluates to <code>true</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In the future, when the client code is added, this trait will also detect
if <code>T</code> is a client socket.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Initially, it was considered to create a trait that would automatically detect
if <code>T</code> is fullfilling the <a href="#socket_concept"><code>Socket</code> concept</a>, but the idea was
abandoned, because the <a href="#socket_concept"><code>Socket</code> concept</a> includes behaviour
that can only be detected at runtime.</p>
</div>
<div class="sect4">
<h5 id="_template_parameters_24">4.2.62.1. Template parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>T</code></dt>
<dd>
<p>The type to query.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_see_also_25">4.2.62.2. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#socket_concept"><code>Socket</code> concept</a>.</p>
</li>
<li>
<p><a href="#basic_socket"><code>basic_socket</code></a>.</p>
</li>
<li>
<p><a href="#socket"><code>socket</code></a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="is_server_socket">4.2.63. <code>is_server_socket</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/traits.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>T</code> is an object fulfilling the <a href="#server_socket_concept"><code>ServerSocket</code>
concept</a>, this template inherits <code>std::true_type</code>. For any other type, this
template inherits <code>std::false_type</code>.</p>
</div>
<div class="paragraph">
<p>This template may be specialized for a user-defined type to indicate that the
type is eligible for operations involving <a href="#server_socket_concept"><code>ServerSocket</code>
objects</a>.</p>
</div>
<div class="paragraph">
<p>Initially, it was considered to create a trait that would automatically detect
if <code>T</code> is fullfilling the <a href="#server_socket_concept"><code>ServerSocket</code> concept</a>, but
the idea was abandoned, because the <a href="#server_socket_concept"><code>ServerSocket</code>
concept</a> includes behaviour that can only be detected at runtime.</p>
</div>
<div class="sect4">
<h5 id="_template_parameters_25">4.2.63.1. Template parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>T</code></dt>
<dd>
<p>The type to query.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_see_also_26">4.2.63.2. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#server_socket_concept"><code>ServerSocket</code> concept</a>.</p>
</li>
<li>
<p><a href="#basic_socket"><code>basic_socket</code></a>.</p>
</li>
<li>
<p><a href="#socket"><code>socket</code></a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic_router">4.2.64. <code>basic_router</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/basic_router.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Router based on simple test functions.  It is implemented as a vector of
<code>pairs&lt;test,router&gt;</code>.  Where <code>test</code> is a functor that tests a specific path
received by a connection, and if returns ture, calls the <code>router</code> function with
an arbitary number of arguments.</p>
</div>
<div class="paragraph">
<p>A <code>test</code> functor could be as simple as <code>bool test_path(string path) { return
path.empty(); }</code>.</p>
</div>
<div class="paragraph">
<p>The <code>router</code> is an arbitary function, that must match the call to the router
itself.  So if we call the route as <code>basic_router(path, arg1, arg2)</code> the <code>router</code>
function will be called with <code>router(arg1, arg2)</code>.</p>
</div>
<div class="sect4">
<h5 id="_template_parameters_26">4.2.64.1. Template parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>unary_predicate</code></dt>
<dd>
<p>Functor that recieves <code>std::string path</code> as an argument and returns true if
this route should be selected.</p>
</dd>
<dt class="hdlist1"><code>route_function_type</code></dt>
<dd>
<p>Functor of the route destination function.</p>
</dd>
<dt class="hdlist1"><code>typename&#8230;&#8203; arguments</code></dt>
<dd>
<p>List of argument type to be passed onto the route destination function.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_see_also_27">4.2.64.2. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#regex_router"><code>regex_router</code></a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="regex_router">4.2.65. <code>regex_router</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/regex_router.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Router based on regular expressions.  It is implemented as a vector of
<code>pairs&lt;regex,router&gt;</code>.  Where <code>regex</code> is a std::regex that tests a specific path
received by a connection, and if matches, calls the <code>router</code> function with
an arbitary number of arguments.</p>
</div>
<div class="paragraph">
<p>The <code>router</code> is an arbitary function, that must match the call to the router
itself.  So if we call the route as <code>basic_router(path, arg1, arg2)</code> the <code>router</code>
function will be called with <code>router(arg1, arg2)</code>.</p>
</div>
<div class="sect4">
<h5 id="_template_parameters_27">4.2.65.1. Template parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>route_function_type</code></dt>
<dd>
<p>Functor of the route destination function.</p>
</dd>
<dt class="hdlist1"><code>typename&#8230;&#8203; arguments</code></dt>
<dd>
<p>List of argument type to be passed onto the route destination function.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_see_also_28">4.2.65.2. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#basic_router"><code>basic_router</code></a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a>. Useful to avoid the gotchas of ASIO composed operations. See <a href="http://sourceforge.net/p/asio/mailman/message/32259256/" class="bare">http://sourceforge.net/p/asio/mailman/message/32259256/</a> for more information.
</div>
<div class="footnote" id="_footnote_2">
<a href="#_footnoteref_2">2</a>. See an example at <a href="http://sourceforge.net/p/axiomq/code/ci/master/tree/include/axiomq/basic_queue_socket.hpp" class="bare">http://sourceforge.net/p/axiomq/code/ci/master/tree/include/axiomq/basic_queue_socket.hpp</a>.
</div>
<div class="footnote" id="_footnote_3">
<a href="#_footnoteref_3">3</a>. for tests
</div>
<div class="footnote" id="_footnote_4">
<a href="#_footnoteref_4">4</a>. Used in the core library.
</div>
<div class="footnote" id="_footnote_5">
<a href="#_footnoteref_5">5</a>. For tests.
</div>
<div class="footnote" id="_footnote_6">
<a href="#_footnoteref_6">6</a>. For the examples and tests.
</div>
<div class="footnote" id="_footnote_7">
<a href="#_footnoteref_7">7</a>. For the <code>file_server</code>.
</div>
<div class="footnote" id="_footnote_8">
<a href="#_footnoteref_8">8</a>. For the documentation.
</div>
<div class="footnote" id="_footnote_9">
<a href="#_footnoteref_9">9</a>. Like <a href="https://sourceforge.net/p/axiomq/code/ci/master/tree/include/axiomq/basic_queue_socket.hpp">axiomq&#8217;s <code>basic_queue_socket</code></a>
</div>
<div class="footnote" id="_footnote_10">
<a href="#_footnoteref_10">10</a>. Defined in RFC 7231, section 7.1.1.1.
</div>
<div class="footnote" id="_footnote_11">
<a href="#_footnoteref_11">11</a>. Defined in RFC 7232.
</div>
<div class="footnote" id="_footnote_12">
<a href="#_footnoteref_12">12</a>. Defined in RFC 7232.
</div>
<div class="footnote" id="_footnote_13">
<a href="#_footnoteref_13">13</a>. Defined in RFC 7231, section 5.1.1.
</div>
<div class="footnote" id="_footnote_14">
<a href="#_footnoteref_14">14</a>. objects with contiguous storage of bytes.
</div>
<div class="footnote" id="_footnote_15">
<a href="#_footnoteref_15">15</a>. The C++11 update gives extra guarantees about preserving the insertion ordering for elements with equivalent keys.
</div>
<div class="footnote" id="_footnote_16">
<a href="#_footnoteref_16">16</a>. Defined in the <a href="#message_concept"><code>Message</code> concept&#8217;s âdefinitionsâ section</a>.
</div>
<div class="footnote" id="_footnote_17">
<a href="#_footnoteref_17">17</a>. Defined in the <a href="#message_concept"><code>Message</code> concept&#8217;s âdefinitionsâ section</a>.
</div>
<div class="footnote" id="_footnote_18">
<a href="#_footnoteref_18">18</a>. Defined in RFC 7231, section  5.1.1.
</div>
<div class="footnote" id="_footnote_19">
<a href="#_footnoteref_19">19</a>. The  notification of the error <code>http_errc::out_of_order</code> has priority over  <code>http_errc::native_stream_unsupported</code> because these errors present a  programming logic error that always will happen (i.e. they aren&#8217;t tied to  specific runtime behaviour). If they aren&#8217;t fixed, the program won&#8217;t work  either way.
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-06-10 13:31:21 -03
</div>
</div>
</body>
</html>